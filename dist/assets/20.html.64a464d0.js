import{_ as l,r as c,o as r,c as u,a as n,b as a,w as o,e as s,d as t}from"./app.cc04f0ba.js";const d={},k={href:"https://github.com/cubxxw/iam",target:"_blank",rel:"noopener noreferrer"},m=s("\u{1F525} \u5F00\u6E90\u5730\u5740"),v=n("h1",{id:"\u7B2C20\u8282-\u63A7\u5236\u6D41-\u4E0A-\u901A\u8FC7iam-apiserver\u8BBE\u8BA1-\u770Bweb\u670D\u52A1\u7684\u6784\u5EFA",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C20\u8282-\u63A7\u5236\u6D41-\u4E0A-\u901A\u8FC7iam-apiserver\u8BBE\u8BA1-\u770Bweb\u670D\u52A1\u7684\u6784\u5EFA","aria-hidden":"true"},"#"),s(" \u7B2C20\u8282 \u63A7\u5236\u6D41\uFF08\u4E0A\uFF09\uFF1A\u901A\u8FC7iam-apiserver\u8BBE\u8BA1\uFF0C\u770BWeb\u670D\u52A1\u7684\u6784\u5EFA")],-1),b=n("br",null,null,-1),g=n("div",null,[n("a",{href:"19.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"21.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),h=n("br",null,null,-1),_=s("\u2764\uFE0F\u{1F495}\u{1F495}During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:"),f={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},q=s("http://nsddd.top"),T=n("hr",null,null,-1),C={class:"table-of-contents"},y=s("\u5F00\u59CB"),I=s("iam-apiserver\u670D\u52A1\u4ECB\u7ECD"),S=s("iam-apiserver\u529F\u80FD\u4ECB\u7ECD"),x=s("iam-apiserver\u4F7F\u7528\u65B9\u6CD5\u4ECB\u7ECD"),P=s("iam-apiserver\u4EE3\u7801\u5B9E\u73B0"),R=s("iam-apiserver\u914D\u7F6E\u5904\u7406"),w=s("iam-apiserver\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1"),A=s("iam-apiserver \u7684REST API\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B"),E=s("iam-apiserver\u4EE3\u7801\u67B6\u6784"),O=s("\u603B\u7ED3"),H=s("END \u94FE\u63A5"),D=t('<p>[TOC]</p><h2 id="\u5F00\u59CB" tabindex="-1"><a class="header-anchor" href="#\u5F00\u59CB" aria-hidden="true">#</a> \u5F00\u59CB</h2><p>\u524D\u9762\u6211\u4EEC\u8BB2\u4E86\u5F88\u591A\u5173\u4E8E\u5E94\u7528\u6784\u5EFA\u7684\u5185\u5BB9\uFF0C\u4F60\u4E00\u5B9A\u8FEB\u4E0D\u53CA\u5F85\u5730\u60F3\u770B\u4E0BIAM\u9879\u76EE\u7684\u5E94\u7528\u662F\u5982\u4F55\u6784\u5EFA\u7684\u3002\u90A3\u4E48\u63A5\u4E0B\u6765\uFF0C\u6211\u5C31\u8BB2\u89E3\u4E0BIAM\u5E94\u7528\u7684\u6E90\u7801\u3002</p><p>\u5728\u8BB2\u89E3\u8FC7\u7A0B\u4E2D\uFF0C\u6211\u4E0D\u4F1A\u53BB\u8BB2\u89E3\u5177\u4F53\u5982\u4F55Code\uFF0C\u4F46\u4F1A\u8BB2\u89E3\u4E00\u4E9B\u6784\u5EFA\u8FC7\u7A0B\u4E2D\u7684\u91CD\u70B9\u3001\u96BE\u70B9\uFF0C\u4EE5\u53CACode\u80CC\u540E\u7684\u8BBE\u8BA1\u601D\u8DEF\u3001\u60F3\u6CD5\u3002\u6211\u76F8\u4FE1\u8FD9\u662F\u5BF9\u4F60\u66F4\u6709\u5E2E\u52A9\u7684\u3002</p><p>IAM\u9879\u76EE\u6709\u5F88\u591A\u7EC4\u4EF6\uFF0C\u8FD9\u4E00\u8BB2\uFF0C\u6211\u5148\u6765\u4ECB\u7ECD\u4E0BIAM\u9879\u76EE\u7684\u95E8\u9762\u670D\u52A1\uFF1Aiam-apiserver\uFF08\u7BA1\u7406\u6D41\u670D\u52A1\uFF09\u3002\u6211\u4F1A\u5148\u7ED9\u4F60\u4ECB\u7ECD\u4E0B<code>iam-apiserver</code>\u7684\u529F\u80FD\u548C\u4F7F\u7528\u65B9\u6CD5\uFF0C\u518D\u4ECB\u7ECD\u4E0Biam-apiserver\u7684\u4EE3\u7801\u5B9E\u73B0\u3002</p><h2 id="iam-apiserver\u670D\u52A1\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u670D\u52A1\u4ECB\u7ECD" aria-hidden="true">#</a> iam-apiserver\u670D\u52A1\u4ECB\u7ECD</h2><p>iam-apiserver\u662F\u4E00\u4E2AWeb\u670D\u52A1\uFF0C\u901A\u8FC7\u4E00\u4E2A\u540D\u4E3Aiam-apiserver\u7684\u8FDB\u7A0B\uFF0C\u5BF9\u5916\u63D0\u4F9BRESTful API\u63A5\u53E3\uFF0C\u5B8C\u6210\u7528\u6237\u3001\u5BC6\u94A5\u3001\u7B56\u7565\u4E09\u79CDREST\u8D44\u6E90\u7684\u589E\u5220\u6539\u67E5\u3002\u63A5\u4E0B\u6765\uFF0C\u6211\u4ECE\u529F\u80FD\u548C\u4F7F\u7528\u65B9\u6CD5\u4E24\u4E2A\u65B9\u9762\u6765\u5177\u4F53\u4ECB\u7ECD\u4E0B\u3002</p><h3 id="iam-apiserver\u529F\u80FD\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u529F\u80FD\u4ECB\u7ECD" aria-hidden="true">#</a> iam-apiserver\u529F\u80FD\u4ECB\u7ECD</h3><p>\u8FD9\u91CC\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7iam-apiserver\u63D0\u4F9B\u7684RESTful API\u63A5\u53E3\uFF0C\u6765\u770B\u4E0Biam-apiserver\u5177\u4F53\u63D0\u4F9B\u7684\u529F\u80FD\u3002iam-apiserver\u63D0\u4F9B\u7684RESTful API\u63A5\u53E3\u53EF\u4EE5\u5206\u4E3A\u56DB\u7C7B\uFF0C\u5177\u4F53\u5982\u4E0B\uFF1A</p><p><strong>\u8BA4\u8BC1\u76F8\u5173\u63A5\u53E3</strong></p><p><img src="http://sm.nsddd.top/sm202302271737291.jpeg" alt="\u56FE\u7247"></p><p><strong>\u7528\u6237\u76F8\u5173\u63A5\u53E3</strong></p>',12),j={href:"https://static001.geekbang.org/resource/image/60/24/60f8a05f4cb43cbac84c0fb12c40c824.jpg?wh=1920x1314",target:"_blank",rel:"noopener noreferrer"},L=n("img",{src:"http://sm.nsddd.top/sm202302271738769.jpeg",alt:"\u56FE\u7247"},null,-1),U=t(`<p><strong>\u5BC6\u94A5\u76F8\u5173\u63A5\u53E3</strong></p><p><img src="http://sm.nsddd.top/sm202302271737321.jpeg" alt="\u56FE\u7247"></p><p><strong>\u7B56\u7565\u76F8\u5173\u63A5\u53E3</strong></p><p><img src="http://sm.nsddd.top/sm202302271738302.jpeg" alt="\u56FE\u7247"></p><h3 id="iam-apiserver\u4F7F\u7528\u65B9\u6CD5\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u4F7F\u7528\u65B9\u6CD5\u4ECB\u7ECD" aria-hidden="true">#</a> iam-apiserver\u4F7F\u7528\u65B9\u6CD5\u4ECB\u7ECD</h3><p>\u4E0A\u9762\u6211\u4ECB\u7ECD\u4E86iam-apiserver\u7684\u529F\u80FD\uFF0C\u63A5\u4E0B\u6765\u5C31\u4ECB\u7ECD\u4E0B\u5982\u4F55\u4F7F\u7528\u8FD9\u4E9B\u529F\u80FD\u3002</p><p>\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u4E0D\u540C\u7684\u5BA2\u6237\u7AEF\u6765\u8BBF\u95EE <code>iam-apiserver</code>\uFF0C\u4F8B\u5982\u524D\u7AEF\u3001API\u8C03\u7528\u3001SDK\u3001iamctl\u7B49\u3002\u8FD9\u4E9B\u5BA2\u6237\u7AEF\u6700\u7EC8\u90FD\u4F1A\u6267\u884CHTTP\u8BF7\u6C42\uFF0C\u8C03\u7528 <code>iam-apiserver</code> \u63D0\u4F9B\u7684RESTful API\u63A5\u53E3\u3002\u6240\u4EE5\uFF0C\u6211\u4EEC\u9996\u5148\u9700\u8981\u6709\u4E00\u4E2A\u987A\u624B\u7684REST API\u5BA2\u6237\u7AEF\u5DE5\u5177\u6765\u6267\u884CHTTP\u8BF7\u6C42\uFF0C\u5B8C\u6210\u5F00\u53D1\u6D4B\u8BD5\u3002</p><p>\u56E0\u4E3A\u4E0D\u540C\u7684\u5F00\u53D1\u8005\u6267\u884CHTTP\u8BF7\u6C42\u7684\u65B9\u5F0F\u3001\u4E60\u60EF\u4E0D\u540C\uFF0C\u4E3A\u4E86\u65B9\u4FBF\u8BB2\u89E3\uFF0C\u8FD9\u91CC\u6211\u7EDF\u4E00\u901A\u8FC7cURL\u5DE5\u5177\u6765\u6267\u884CHTTP\u8BF7\u6C42\u3002\u63A5\u4E0B\u6765\u5148\u4ECB\u7ECD\u4E0BcURL\u5DE5\u5177\u3002</p><p>\u6807\u51C6\u7684Linux\u53D1\u884C\u7248\u90FD\u5B89\u88C5\u4E86cURL\u5DE5\u5177\u3002cURL\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u5B8C\u6210RESTful API\u7684\u8C03\u7528\u573A\u666F\uFF0C\u6BD4\u5982\u8BBE\u7F6EHeader\u3001\u6307\u5B9AHTTP\u8BF7\u6C42\u65B9\u6CD5\u3001\u6307\u5B9AHTTP\u6D88\u606F\u4F53\u3001\u6307\u5B9A\u6743\u9650\u8BA4\u8BC1\u4FE1\u606F\u7B49\u3002\u901A\u8FC7<code>-v</code>\u9009\u9879\uFF0C\u4E5F\u80FD\u8F93\u51FAREST\u8BF7\u6C42\u7684\u6240\u6709\u8FD4\u56DE\u4FE1\u606F\u3002cURL\u529F\u80FD\u5F88\u5F3A\u5927\uFF0C\u6709\u5F88\u591A\u53C2\u6570\uFF0C\u8FD9\u91CC\u5217\u51FAcURL\u5DE5\u5177\u5E38\u7528\u7684\u53C2\u6570\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-X/--request <span class="token punctuation">[</span>GET<span class="token operator">|</span>POST<span class="token operator">|</span>PUT<span class="token operator">|</span>DELETE<span class="token operator">|</span>\u2026<span class="token punctuation">]</span>  \u6307\u5B9A\u8BF7\u6C42\u7684 HTTP \u65B9\u6CD5
-H/--header                           \u6307\u5B9A\u8BF7\u6C42\u7684 HTTP Header
-d/--data                             \u6307\u5B9A\u8BF7\u6C42\u7684 HTTP \u6D88\u606F\u4F53\uFF08Body\uFF09
-v/--verbose                          \u8F93\u51FA\u8BE6\u7EC6\u7684\u8FD4\u56DE\u4FE1\u606F
-u/--user                             \u6307\u5B9A\u8D26\u53F7\u3001\u5BC6\u7801
-b/--cookie                           \u8BFB\u53D6 cookie
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6B64\u5916\uFF0C\u5982\u679C\u4F60\u60F3\u4F7F\u7528\u5E26UI\u754C\u9762\u7684\u5DE5\u5177\uFF0C\u8FD9\u91CC\u6211\u63A8\u8350\u4F60\u4F7F\u7528 <code>Insomnia</code> \u3002</p><p><code>Insomnia</code>\u662F\u4E00\u4E2A\u8DE8\u5E73\u53F0\u7684REST API\u5BA2\u6237\u7AEF\uFF0C\u4E0E <code>Postman</code>\u3001<code>Apifox</code>\u662F\u4E00\u7C7B\u5DE5\u5177\uFF0C\u7528\u4E8E\u63A5\u53E3\u7BA1\u7406\u3001\u6D4B\u8BD5\u3002<code>Insomnia</code>\u529F\u80FD\u5F3A\u5927\uFF0C\u652F\u6301\u4EE5\u4E0B\u529F\u80FD\uFF1A</p><ul><li>\u53D1\u9001HTTP\u8BF7\u6C42\uFF1B</li><li>\u521B\u5EFA\u5DE5\u4F5C\u533A\u6216\u6587\u4EF6\u5939\uFF1B</li><li>\u5BFC\u5165\u548C\u5BFC\u51FA\u6570\u636E\uFF1B</li><li>\u5BFC\u51FAcURL\u683C\u5F0F\u7684HTTP\u8BF7\u6C42\u547D\u4EE4\uFF1B</li><li>\u652F\u6301\u7F16\u5199swagger\u6587\u6863\uFF1B</li><li>\u5FEB\u901F\u5207\u6362\u8BF7\u6C42\uFF1B</li><li>URL\u7F16\u7801\u548C\u89E3\u7801\u3002</li><li>\u2026</li></ul><p><code>Insomnia</code>\u754C\u9762\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/sm202302271744432.png" alt="\u56FE\u7247"></p><p>\u5F53\u7136\u4E86\uFF0C\u4E5F\u6709\u5F88\u591A\u5176\u4ED6\u4F18\u79C0\u7684\u5E26UI\u754C\u9762\u7684REST API\u5BA2\u6237\u7AEF\uFF0C\u4F8B\u5982 Postman\u3001Apifox\u7B49\uFF0C\u4F60\u53EF\u4EE5\u6839\u636E\u9700\u8981\u81EA\u884C\u9009\u62E9\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u7528\u5BF9secret\u8D44\u6E90\u7684CURD\u64CD\u4F5C\uFF0C\u6765\u7ED9\u4F60\u6F14\u793A\u4E0B <strong>\u5982\u4F55\u4F7F\u7528iam-apiserver\u7684\u529F\u80FD</strong>\u3002\u4F60\u9700\u8981\u6267\u884C6\u6B65\u64CD\u4F5C\u3002</p><ol><li>\u767B\u5F55<code>iam-apiserver</code>\uFF0C\u83B7\u53D6token\u3002</li><li>\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A<code>secret0</code>\u7684secret\u3002</li><li>\u83B7\u53D6<code>secret0</code>\u7684\u8BE6\u7EC6\u4FE1\u606F\u3002</li><li>\u66F4\u65B0<code>secret0</code>\u7684\u63CF\u8FF0\u3002</li><li>\u83B7\u53D6<code>secret</code>\u5217\u8868\u3002</li><li>\u5220\u9664<code>secret0</code>\u3002</li></ol><p><strong>\u767B\u5F55iam-apiserver\uFF0C\u83B7\u53D6token\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-XPOST</span> -H<span class="token string">&quot;Authorization: Basic <span class="token variable"><span class="token variable">\`</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">&#39;admin:Admin@2021&#39;</span><span class="token operator">|</span>base64<span class="token variable">\`</span></span>&quot;</span> http://127.0.0.1:8080/login <span class="token operator">|</span> jq <span class="token parameter variable">-r</span> .token
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJpYW0uYXBpLm1hcm1vdGVkdS5jb20iLCJleHAiOjE2MzUwNTk4NDIsImlkZW50aXR5IjoiYWRtaW4iLCJpc3MiOiJpYW0tYXBpc2VydmVyIiwib3JpZ19pYXQiOjE2MjcyODM4NDIsInN1YiI6ImFkbWluIn0.gTS0n-7njLtpCJ7mvSnct2p3TxNTUQaduNXxqqLwGfI
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u91CC\uFF0C\u4E3A\u4E86\u4FBF\u4E8E\u4F7F\u7528\uFF0C\u6211\u4EEC\u5C06token\u8BBE\u7F6E\u4E3A\u73AF\u5883\u53D8\u91CF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">TOKEN</span><span class="token operator">=</span>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJpYW0uYXBpLm1hcm1vdGVkdS5jb20iLCJleHAiOjE2MzUwNTk4NDIsImlkZW50aXR5IjoiYWRtaW4iLCJpc3MiOiJpYW0tYXBpc2VydmVyIiwib3JpZ19pYXQiOjE2MjcyODM4NDIsInN1YiI6ImFkbWluIn0.gTS0n-7njLtpCJ7mvSnct2p3TxNTUQaduNXxqqLwGfI
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3Asecret0\u7684secret\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-XPOST</span> <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> -H<span class="token string">&quot;Authorization: Bearer <span class="token variable">\${TOKEN}</span>&quot;</span> -d<span class="token string">&#39;{&quot;metadata&quot;:{&quot;name&quot;:&quot;secret0&quot;},&quot;expires&quot;:0,&quot;description&quot;:&quot;admin secret&quot;}&#39;</span> http://iam.api.marmotedu.com:8080/v1/secrets
* About to connect<span class="token punctuation">(</span><span class="token punctuation">)</span> to iam.api.marmotedu.com port <span class="token number">8080</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
*   Trying <span class="token number">127.0</span>.0.1<span class="token punctuation">..</span>.
* Connected to iam.api.marmotedu.com <span class="token punctuation">(</span><span class="token number">127.0</span>.0.1<span class="token punctuation">)</span> port <span class="token number">8080</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
<span class="token operator">&gt;</span> POST /v1/secrets HTTP/1.1
<span class="token operator">&gt;</span> User-Agent: curl/7.29.0
<span class="token operator">&gt;</span> Host: iam.api.marmotedu.com:8080
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span> Content-Type: application/json
<span class="token operator">&gt;</span> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJpYW0uYXBpLm1hcm1vdGVkdS5jb20iLCJleHAiOjE2MzUwNTk4NDIsImlkZW50aXR5IjoiYWRtaW4iLCJpc3MiOiJpYW0tYXBpc2VydmVyIiwib3JpZ19pYXQiOjE2MjcyODM4NDIsInN1YiI6ImFkbWluIn0.gTS0n-7njLtpCJ7mvSnct2p3TxNTUQaduNXxqqLwGfI
<span class="token operator">&gt;</span> Content-Length: <span class="token number">72</span>
<span class="token operator">&gt;</span> 
* upload completely sent off: <span class="token number">72</span> out of <span class="token number">72</span> bytes
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">&lt;</span> Content-Type: application/json<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">&lt;</span> X-Request-Id: ff825bea-53de-4020-8e68-4e87574bd1ba
<span class="token operator">&lt;</span> Date: Mon, <span class="token number">26</span> Jul <span class="token number">2021</span> 07:20:26 GMT
<span class="token operator">&lt;</span> Content-Length: <span class="token number">313</span>
<span class="token operator">&lt;</span> 
* Connection <span class="token comment">#0 to host iam.api.marmotedu.com left intact</span>
<span class="token punctuation">{</span><span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:60,<span class="token string">&quot;instanceID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret-jedr3e&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret0&quot;</span>,<span class="token string">&quot;createdAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26.885+08:00&quot;</span>,<span class="token string">&quot;updatedAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26.907+08:00&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;secretID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;U6CxKs0YVWyOp5GrluychYIRxDmMDFd1mOOD&quot;</span>,<span class="token string">&quot;secretKey&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fubNIn8jLA55ktuuTpXM8Iw5ogdR2mlf&quot;</span>,<span class="token string">&quot;expires&quot;</span>:0,<span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin secret&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u8BF7\u6C42\u8FD4\u56DE\u5934\u4E2D\u8FD4\u56DE\u4E86<code>X-Request-Id</code> Header\uFF0C<code>X-Request-Id</code>\u552F\u4E00\u6807\u8BC6\u8FD9\u6B21\u8BF7\u6C42\u3002\u5982\u679C\u8FD9\u6B21\u8BF7\u6C42\u5931\u8D25\uFF0C\u5C31\u53EF\u4EE5\u5C06<code>X-Request-Id</code>\u63D0\u4F9B\u7ED9\u8FD0\u7EF4\u6216\u8005\u5F00\u53D1\uFF0C\u901A\u8FC7<code>X-Request-Id</code>\u5B9A\u4F4D\u51FA\u5931\u8D25\u7684\u8BF7\u6C42\uFF0C\u8FDB\u884C\u6392\u969C\u3002\u53E6\u5916<code>X-Request-Id</code>\u5728\u5FAE\u670D\u52A1\u573A\u666F\u4E2D\uFF0C\u4E5F\u53EF\u4EE5\u900F\u4F20\u7ED9\u5176\u4ED6\u670D\u52A1\uFF0C\u4ECE\u800C\u5B9E\u73B0\u8BF7\u6C42\u8C03\u7528\u94FE\u3002</p><p><strong>\u83B7\u53D6secret0\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-XGET</span> -H<span class="token string">&quot;Authorization: Bearer <span class="token variable">\${TOKEN}</span>&quot;</span> http://iam.api.marmotedu.com:8080/v1/secrets/secret0
<span class="token punctuation">{</span><span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:60,<span class="token string">&quot;instanceID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret-jedr3e&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret0&quot;</span>,<span class="token string">&quot;createdAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26+08:00&quot;</span>,<span class="token string">&quot;updatedAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26+08:00&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;secretID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;U6CxKs0YVWyOp5GrluychYIRxDmMDFd1mOOD&quot;</span>,<span class="token string">&quot;secretKey&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fubNIn8jLA55ktuuTpXM8Iw5ogdR2mlf&quot;</span>,<span class="token string">&quot;expires&quot;</span>:0,<span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin secret&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u66F4\u65B0secret0\u7684\u63CF\u8FF0\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-XPUT</span> -H<span class="token string">&quot;Authorization: Bearer $&quot;</span> -d<span class="token string">&#39;{&quot;metadata&quot;:{&quot;name&quot;:&quot;secret&quot;},&quot;expires&quot;:0,&quot;description&quot;:&quot;admin secret(modify)&quot;}&#39;</span> http://iam.api.marmotedu.com:8080/v1/secrets/secret0<span class="token punctuation">{</span><span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:60,<span class="token string">&quot;instanceID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret-jedr3e&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret0&quot;</span>,<span class="token string">&quot;createdAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26+08:00&quot;</span>,<span class="token string">&quot;updatedAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:23:35.878+08:00&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;secretID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;U6CxKs0YVWyOp5GrluychYIRxDmMDFd1mOOD&quot;</span>,<span class="token string">&quot;secretKey&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fubNIn8jLA55ktuuTpXM8Iw5ogdR2mlf&quot;</span>,<span class="token string">&quot;expires&quot;</span>:0,<span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin secret(modify)&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u83B7\u53D6secret\u5217\u8868\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-XGET</span> -H<span class="token string">&quot;Authorization: Bearer <span class="token variable">\${TOKEN}</span>&quot;</span> http://iam.api.marmotedu.com:8080/v1/secrets
<span class="token punctuation">{</span><span class="token string">&quot;totalCount&quot;</span>:1,<span class="token string">&quot;items&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">&quot;metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span>:60,<span class="token string">&quot;instanceID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret-jedr3e&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;secret0&quot;</span>,<span class="token string">&quot;createdAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:20:26+08:00&quot;</span>,<span class="token string">&quot;updatedAt&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2021-07-26T15:23:35+08:00&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;username&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin&quot;</span>,<span class="token string">&quot;secretID&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;U6CxKs0YVWyOp5GrluychYIRxDmMDFd1mOOD&quot;</span>,<span class="token string">&quot;secretKey&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;fubNIn8jLA55ktuuTpXM8Iw5ogdR2mlf&quot;</span>,<span class="token string">&quot;expires&quot;</span>:0,<span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;admin secret(modify)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5220\u9664secret0\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ curl -XDELETE -H&quot;Authorization: Bearer $&quot; http://iam.api.marmotedu.com:8080/v1/secrets/secret0null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,33),M=s("\u4E0A\u9762\uFF0C\u6211\u7ED9\u4F60\u6F14\u793A\u4E86\u5BC6\u94A5\u7684\u4F7F\u7528\u65B9\u6CD5\u3002\u7528\u6237\u548C\u7B56\u7565\u8D44\u6E90\u7C7B\u578B\u7684\u4F7F\u7528\u65B9\u6CD5\u8DDF\u5BC6\u94A5\u7C7B\u4F3C\u3002\u8BE6\u7EC6\u7684\u4F7F\u7528\u65B9\u6CD5\u4F60\u53EF\u4EE5\u53C2\u8003 "),W={href:"https://github.com/marmotedu/iam/blob/v1.0.6/scripts/install/test.sh",target:"_blank",rel:"noopener noreferrer"},G=s("test.sh"),N=s(" \u811A\u672C\uFF0C\u8BE5\u811A\u672C\u662F\u7528\u6765\u6D4B\u8BD5IAM\u5E94\u7528\u7684\uFF0C\u91CC\u9762\u5305\u542B\u4E86\u5404\u4E2A\u63A5\u53E3\u7684\u8BF7\u6C42\u65B9\u6CD5\u3002"),X=t(`<p>\u8FD9\u91CC\uFF0C\u6211\u8FD8\u60F3\u987A\u4FBF\u4ECB\u7ECD\u4E0B<strong>\u5982\u4F55\u6D4B\u8BD5IAM\u5E94\u7528\u4E2D\u7684\u5404\u4E2A\u90E8\u5206</strong>\u3002\u786E\u4FDDiam-apiserver\u3001iam-authz-server\u3001iam-pump\u7B49\u670D\u52A1\u6B63\u5E38\u8FD0\u884C\u540E\uFF0C\u8FDB\u5165\u5230IAM\u9879\u76EE\u7684\u6839\u76EE\u5F55\uFF0C\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ ./scripts/install/test.sh iam::test::test <span class="token comment"># \u6D4B\u8BD5\u6574\u4E2AIAM\u5E94\u7528\u662F\u5426\u6B63\u5E38\u8FD0\u884C</span>
$ ./scripts/install/test.sh iam::test::login <span class="token comment"># \u6D4B\u8BD5\u767B\u9646\u63A5\u53E3\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
$ ./scripts/install/test.sh iam::test::user <span class="token comment"># \u6D4B\u8BD5\u7528\u6237\u63A5\u53E3\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
$ ./scripts/install/test.sh iam::test::secret <span class="token comment"># \u6D4B\u8BD5\u5BC6\u94A5\u63A5\u53E3\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
$ ./scripts/install/test.sh iam::test::policy <span class="token comment"># \u6D4B\u8BD5\u7B56\u7565\u63A5\u53E3\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
$ ./scripts/install/test.sh iam::test::apiserver <span class="token comment"># \u6D4B\u8BD5iam-apiserver\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C</span>
$ ./scripts/install/test.sh iam::test::authz <span class="token comment"># \u6D4B\u8BD5authz\u63A5\u53E3\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u8BBF\u95EE</span>
$ ./scripts/install/test.sh iam::test::authzserver <span class="token comment"># \u6D4B\u8BD5iam-authz-server\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C</span>
$ ./scripts/install/test.sh iam::test::pump <span class="token comment"># \u6D4B\u8BD5iam-pump\u662F\u5426\u6B63\u5E38\u8FD0\u884C</span>
$ ./scripts/install/test.sh iam::test::iamctl <span class="token comment"># \u6D4B\u8BD5iamctl\u5DE5\u5177\u662F\u5426\u53EF\u4EE5\u6B63\u5E38\u4F7F\u7528</span>
$ ./scripts/install/test.sh iam::test::man <span class="token comment"># \u6D4B\u8BD5man\u6587\u4EF6\u662F\u5426\u6B63\u786E\u5B89\u88C5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6240\u4EE5\uFF0C\u6BCF\u6B21\u53D1\u5E03\u5B8Ciam-apiserver\u540E\uFF0C\u4F60\u53EF\u4EE5\u6267\u884C\u4EE5\u4E0B\u547D\u4EE4\u6765\u5B8C\u6210iam-apiserver\u7684\u5192\u70DF\u6D4B\u8BD5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">IAM_APISERVER_HOST</span><span class="token operator">=</span><span class="token number">127.0</span>.0.1 <span class="token comment"># iam-apiserver\u90E8\u7F72\u670D\u52A1\u5668\u7684IP\u5730\u5740</span>
$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">IAM_APISERVER_INSECURE_BIND_PORT</span><span class="token operator">=</span><span class="token number">8080</span> <span class="token comment"># iam-apiserver HTTP\u670D\u52A1\u7684\u76D1\u542C\u7AEF\u53E3</span>
$ ./scripts/install/test.sh iam::test::apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="iam-apiserver\u4EE3\u7801\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a> iam-apiserver\u4EE3\u7801\u5B9E\u73B0</h2><p>\u4E0A\u9762\uFF0C\u6211\u4ECB\u7ECD\u4E86iam-apiserver\u7684\u529F\u80FD\u548C\u4F7F\u7528\u65B9\u6CD5\uFF0C\u8FD9\u91CC\u6211\u4EEC\u518D\u6765\u770B\u4E0Biam-apiserver\u5177\u4F53\u7684\u4EE3\u7801\u5B9E\u73B0\u3002\u6211\u4F1A\u4ECE\u914D\u7F6E\u5904\u7406\u3001\u542F\u52A8\u6D41\u7A0B\u3001\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B\u3001\u4EE3\u7801\u67B6\u67844\u4E2A\u65B9\u9762\u6765\u8BB2\u89E3\u3002</p><h3 id="iam-apiserver\u914D\u7F6E\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u914D\u7F6E\u5904\u7406" aria-hidden="true">#</a> iam-apiserver\u914D\u7F6E\u5904\u7406</h3>`,7),J=s("iam-apiserver\u670D\u52A1\u7684main\u51FD\u6570\u4F4D\u4E8E"),B={href:"https://github.com/marmotedu/iam/blob/v1.0.4/cmd/iam-apiserver/apiserver.go#L18",target:"_blank",rel:"noopener noreferrer"},Y=s("apiserver.go"),F=s("\u6587\u4EF6\u4E2D\uFF0C\u4F60\u53EF\u4EE5\u8DDF\u8BFB\u4EE3\u7801\uFF0C\u4E86\u89E3iam-apiserver\u7684\u4EE3\u7801\u5B9E\u73B0\u3002\u8FD9\u91CC\uFF0C\u6211\u6765\u4ECB\u7ECD\u4E0Biam-apiserver\u670D\u52A1\u7684\u4E00\u4E9B\u8BBE\u8BA1\u601D\u60F3\u3002"),$=n("p",null,"\u9996\u5148\uFF0C\u6765\u770B\u4E0Biam-apiserver\u4E2D\u76843\u79CD\u914D\u7F6E\uFF1AOptions\u914D\u7F6E\u3001\u5E94\u7528\u914D\u7F6E\u548C HTTP/GRPC\u670D\u52A1\u914D\u7F6E\u3002",-1),V=n("ul",null,[n("li",null,"**Options\u914D\u7F6E\uFF1A**\u7528\u6765\u6784\u5EFA\u547D\u4EE4\u884C\u53C2\u6570\uFF0C\u5B83\u7684\u503C\u6765\u81EA\u4E8E\u547D\u4EE4\u884C\u9009\u9879\u6216\u8005\u914D\u7F6E\u6587\u4EF6\uFF08\u4E5F\u53EF\u80FD\u662F\u4E8C\u8005Merge\u540E\u7684\u914D\u7F6E\uFF09\u3002Options\u53EF\u4EE5\u7528\u6765\u6784\u5EFA\u5E94\u7528\u6846\u67B6\uFF0COptions\u914D\u7F6E\u4E5F\u662F\u5E94\u7528\u914D\u7F6E\u7684\u8F93\u5165\u3002"),n("li",null,"**\u5E94\u7528****\u914D\u7F6E\uFF1A**iam-apiserver\u7EC4\u4EF6\u4E2D\u9700\u8981\u7684\u4E00\u5207\u914D\u7F6E\u3002\u6709\u5F88\u591A\u5730\u65B9\u9700\u8981\u914D\u7F6E\uFF0C\u4F8B\u5982\uFF0C\u542F\u52A8HTTP/GRPC\u9700\u8981\u914D\u7F6E\u76D1\u542C\u5730\u5740\u548C\u7AEF\u53E3\uFF0C\u521D\u59CB\u5316\u6570\u636E\u5E93\u9700\u8981\u914D\u7F6E\u6570\u636E\u5E93\u5730\u5740\u3001\u7528\u6237\u540D\u3001\u5BC6\u7801\u7B49\u3002"),n("li",null,"**HTTP/GRPC\u670D\u52A1\u914D\u7F6E\uFF1A**\u542F\u52A8HTTP\u670D\u52A1\u6216\u8005GRPC\u670D\u52A1\u9700\u8981\u7684\u914D\u7F6E\u3002")],-1),z=n("p",null,"\u8FD9\u4E09\u79CD\u914D\u7F6E\u7684\u5173\u7CFB\u5982\u4E0B\u56FE\uFF1A",-1),K=n("p",null,[n("img",{src:"http://sm.nsddd.top/sm202302282136791.jpeg",alt:"img"})],-1),Q=n("p",null,"Options\u914D\u7F6E\u63A5\u7BA1\u547D\u4EE4\u884C\u9009\u9879\uFF0C\u5E94\u7528\u914D\u7F6E\u63A5\u7BA1\u6574\u4E2A\u5E94\u7528\u7684\u914D\u7F6E\uFF0CHTTP/GRPC\u670D\u52A1\u914D\u7F6E\u63A5\u7BA1\u8DDFHTTP/GRPC\u670D\u52A1\u76F8\u5173\u7684\u914D\u7F6E\u3002\u8FD93\u79CD\u914D\u7F6E\u72EC\u7ACB\u5F00\u6765\uFF0C\u53EF\u4EE5\u89E3\u8026\u547D\u4EE4\u884C\u9009\u9879\u3001\u5E94\u7528\u548C\u5E94\u7528\u5185\u7684\u670D\u52A1\uFF0C\u4F7F\u5F97\u8FD93\u4E2A\u90E8\u5206\u53EF\u4EE5\u72EC\u7ACB\u6269\u5C55\uFF0C\u53C8\u4E0D\u76F8\u4E92\u5F71\u54CD\u3002",-1),Z=n("p",null,"iam-apiserver\u6839\u636EOptions\u914D\u7F6E\u6765\u6784\u5EFA\u547D\u4EE4\u884C\u53C2\u6570\u548C\u5E94\u7528\u914D\u7F6E\u3002",-1),nn=s("\u6211\u4EEC\u901A\u8FC7"),sn=n("code",null,"github.com/marmotedu/iam/pkg/app",-1),an=s("\u5305\u7684"),en={href:"https://github.com/marmotedu/iam/blob/v1.0.4/pkg/app/app.go#L199",target:"_blank",rel:"noopener noreferrer"},tn=s("buildCommand"),on=s("\u65B9\u6CD5\u6765\u6784\u5EFA\u547D\u4EE4\u884C\u53C2\u6570\u3002\u8FD9\u91CC\u7684\u6838\u5FC3\u662F\uFF0C\u901A\u8FC7"),pn={href:"https://github.com/marmotedu/iam/blob/v1.0.4/pkg/app/app.go#L157",target:"_blank",rel:"noopener noreferrer"},cn=s("NewApp"),ln=s("\u51FD\u6570\u6784\u5EFAApplication\u5B9E\u4F8B\u65F6\uFF0C\u4F20\u5165\u7684"),rn={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/options/options.go#L19",target:"_blank",rel:"noopener noreferrer"},un=s("Options"),dn=s("\u5B9E\u73B0\u4E86"),kn=n("code",null,"Flags() (fss cliflag.NamedFlagSets)",-1),mn=s("\u65B9\u6CD5\uFF0C\u901A\u8FC7buildCommand\u65B9\u6CD5\u4E2D\u7684\u4EE5\u4E0B\u4EE3\u7801\uFF0C\u5C06option\u7684Flag\u6DFB\u52A0\u5230cobra\u5B9E\u4F8B\u7684FlagSet\u4E2D\uFF1A"),vn=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">if</span> a<span class="token punctuation">.</span>options <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    namedFlagSets <span class="token operator">=</span> a<span class="token punctuation">.</span>options<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fs <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> namedFlagSets<span class="token punctuation">.</span>FlagSets <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">AddFlagSet</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

          <span class="token operator">...</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),bn=s("\u901A\u8FC7"),gn={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/config/config.go#L16",target:"_blank",rel:"noopener noreferrer"},hn=s("CreateConfigFromOptions"),_n=s("\u51FD\u6570\u6765\u6784\u5EFA\u5E94\u7528\u914D\u7F6E\uFF1A"),fn=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>cfg<span class="token punctuation">,</span> err <span class="token operator">:=</span> config<span class="token punctuation">.</span><span class="token function">CreateConfigFromOptions</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>                      
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>                                               
    <span class="token keyword">return</span> err                                                
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6839\u636E\u5E94\u7528\u914D\u7F6E\u6765\u6784\u5EFAHTTP/GRPC\u670D\u52A1\u914D\u7F6E\u3002\u4F8B\u5982\uFF0C\u4EE5\u4E0B\u4EE3\u7801\u6839\u636E\u5E94\u7528\u914D\u7F6E\uFF0C\u6784\u5EFA\u4E86HTTP\u670D\u52A1\u5668\u7684Address\u53C2\u6570\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>InsecureServingOptions<span class="token punctuation">)</span> <span class="token function">ApplyTo</span><span class="token punctuation">(</span>c <span class="token operator">*</span>server<span class="token punctuation">.</span>Config<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>InsecureServing <span class="token operator">=</span> <span class="token operator">&amp;</span>server<span class="token punctuation">.</span>InsecureServingInfo<span class="token punctuation">{</span>
        Address<span class="token punctuation">:</span> net<span class="token punctuation">.</span><span class="token function">JoinHostPort</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>BindAddress<span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>BindPort<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D\uFF0C<code>c *server.Config</code>\u662FHTTP\u670D\u52A1\u5668\u7684\u914D\u7F6E\uFF0C<code>s *InsecureServingOptions</code>\u662F\u5E94\u7528\u914D\u7F6E\u3002</p><h3 id="iam-apiserver\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1" aria-hidden="true">#</a> iam-apiserver\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1</h3><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u6765\u8BE6\u7EC6\u770B\u4E0Biam-apiserver\u7684\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1\u3002\u542F\u52A8\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p>`,6),qn={href:"https://static001.geekbang.org/resource/image/8a/c7/8a94938bc087ed96d0ec87261db292c7.jpg?wh=4770x1487",target:"_blank",rel:"noopener noreferrer"},Tn=n("img",{src:"https://static001.geekbang.org/resource/image/8a/c7/8a94938bc087ed96d0ec87261db292c7.jpg?wh=4770x1487",alt:"img"},null,-1),Cn=n("p",null,[s("**\u9996\u5148\uFF0C**\u901A\u8FC7"),n("code",null,"opts := options.NewOptions()"),s("\u521B\u5EFA\u5E26\u6709\u9ED8\u8BA4\u503C\u7684Options\u7C7B\u578B\u53D8\u91CFopts\u3002opts\u53D8\u91CF\u4F5C\u4E3A"),n("code",null,"github.com/marmotedu/iam/pkg/app"),s("\u5305\u7684"),n("code",null,"NewApp"),s("\u51FD\u6570\u7684\u8F93\u5165\u53C2\u6570\uFF0C\u6700\u7EC8\u5728App\u6846\u67B6\u4E2D\uFF0C\u88AB\u6765\u81EA\u4E8E\u547D\u4EE4\u884C\u53C2\u6570\u6216\u914D\u7F6E\u6587\u4EF6\u7684\u914D\u7F6E\uFF08\u4E5F\u53EF\u80FD\u662F\u4E8C\u8005Merge\u540E\u7684\u914D\u7F6E\uFF09\u6240\u586B\u5145\uFF0Copts\u53D8\u91CF\u4E2D\u5404\u4E2A\u5B57\u6BB5\u7684\u503C\u4F1A\u7528\u6765\u521B\u5EFA\u5E94\u7528\u914D\u7F6E\u3002")],-1),yn=s("**\u63A5\u7740\uFF0C**\u4F1A\u6CE8\u518C"),In={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/apiserver.go#L36",target:"_blank",rel:"noopener noreferrer"},Sn=s("run"),xn=s("\u51FD\u6570\u5230App\u6846\u67B6\u4E2D\u3002run\u51FD\u6570\u662Fiam-apiserver\u7684\u542F\u52A8\u51FD\u6570\uFF0C\u91CC\u9762\u5C01\u88C5\u4E86\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684\u542F\u52A8\u903B\u8F91\u3002run\u51FD\u6570\u4E2D\uFF0C\u9996\u5148\u4F1A\u521D\u59CB\u5316\u65E5\u5FD7\u5305\uFF0C\u8FD9\u6837\u6211\u4EEC\u5C31\u53EF\u4EE5\u6839\u636E\u9700\u8981\uFF0C\u5728\u540E\u9762\u7684\u4EE3\u7801\u4E2D\u968F\u65F6\u8BB0\u5F55\u65E5\u5FD7\u4E86\u3002"),Pn=t(`<p>**\u7136\u540E\uFF0C**\u4F1A\u521B\u5EFA\u5E94\u7528\u914D\u7F6E\u3002\u5E94\u7528\u914D\u7F6E\u548COptions\u914D\u7F6E\u5176\u5B9E\u662F\u5B8C\u5168\u72EC\u7ACB\u7684\uFF0C\u4E8C\u8005\u53EF\u80FD\u5B8C\u5168\u4E0D\u540C\uFF0C\u4F46\u5728iam-apiserver\u4E2D\uFF0C\u4E8C\u8005\u914D\u7F6E\u9879\u662F\u76F8\u540C\u7684\u3002</p><p>**\u4E4B\u540E\uFF0C**\u6839\u636E\u5E94\u7528\u914D\u7F6E\uFF0C\u521B\u5EFAHTTP/GRPC\u670D\u52A1\u5668\u6240\u4F7F\u7528\u7684\u914D\u7F6E\u3002\u5728\u521B\u5EFA\u914D\u7F6E\u540E\uFF0C\u4F1A\u5148\u5206\u522B\u8FDB\u884C\u914D\u7F6E\u8865\u5168\uFF0C\u518D\u4F7F\u7528\u8865\u5168\u540E\u7684\u914D\u7F6E\u521B\u5EFAWeb\u670D\u52A1\u5B9E\u4F8B\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>genericServer<span class="token punctuation">,</span> err <span class="token operator">:=</span> genericConfig<span class="token punctuation">.</span><span class="token function">Complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
extraServer<span class="token punctuation">,</span> err <span class="token operator">:=</span> extraConfig<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
<span class="token operator">...</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>ExtraConfig<span class="token punctuation">)</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>completedExtraConfig <span class="token punctuation">{</span>
    <span class="token keyword">if</span> c<span class="token punctuation">.</span>Addr <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span>Addr <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1:8081&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">&amp;</span>completedExtraConfig<span class="token punctuation">{</span>c<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u4EE3\u7801\u4E2D\uFF0C\u9996\u5148\u8C03\u7528<code>Complete</code>/<code>complete</code>\u51FD\u6570\u8865\u5168\u914D\u7F6E\uFF0C\u518D\u57FA\u4E8E\u8865\u5168\u540E\u7684\u914D\u7F6E\uFF0CNew\u4E00\u4E2AHTTP/GRPC\u670D\u52A1\u5B9E\u4F8B\u3002</p><p>\u8FD9\u91CC\u6709\u4E2A\u8BBE\u8BA1\u6280\u5DE7\uFF1A<code>complete</code>\u51FD\u6570\u8FD4\u56DE\u7684\u662F\u4E00\u4E2A<code>*completedExtraConfig</code>\u7C7B\u578B\u7684\u5B9E\u4F8B\uFF0C\u5728\u521B\u5EFAGRPC\u5B9E\u4F8B\u65F6\uFF0C\u662F\u8C03\u7528<code>completedExtraConfig</code>\u7ED3\u6784\u4F53\u63D0\u4F9B\u7684<code>New</code>\u65B9\u6CD5\uFF0C\u8FD9\u79CD\u8BBE\u8BA1\u65B9\u6CD5\u53EF\u4EE5\u786E\u4FDD\u6211\u4EEC\u521B\u5EFA\u7684GRPC\u5B9E\u4F8B\u4E00\u5B9A\u662F\u57FA\u4E8Ecomplete\u4E4B\u540E\u7684\u914D\u7F6E\uFF08completed\uFF09\u3002</p><p>\u5728\u5B9E\u9645\u7684Go\u9879\u76EE\u5F00\u53D1\u4E2D\uFF0C\u6211\u4EEC\u9700\u8981\u63D0\u4F9B\u4E00\u79CD\u673A\u5236\u6765\u5904\u7406\u6216\u8865\u5168\u914D\u7F6E\uFF0C\u8FD9\u5728Go\u9879\u76EE\u5F00\u53D1\u4E2D\u662F\u4E00\u4E2A\u975E\u5E38\u6709\u7528\u7684\u6B65\u9AA4\u3002</p><p>**\u6700\u540E\uFF0C**\u8C03\u7528<code>PrepareRun</code>\u65B9\u6CD5\uFF0C\u8FDB\u884CHTTP/GRPC\u670D\u52A1\u5668\u542F\u52A8\u524D\u7684\u51C6\u5907\u3002\u5728\u51C6\u5907\u51FD\u6570\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u505A\u5404\u79CD\u521D\u59CB\u5316\u64CD\u4F5C\uFF0C\u4F8B\u5982\u521D\u59CB\u5316\u6570\u636E\u5E93\uFF0C\u5B89\u88C5\u4E1A\u52A1\u76F8\u5173\u7684Gin\u4E2D\u95F4\u4EF6\u3001RESTful API\u8DEF\u7531\u7B49\u3002</p><p>\u5B8C\u6210HTTP/GRPC\u670D\u52A1\u5668\u542F\u52A8\u524D\u7684\u51C6\u5907\u4E4B\u540E\uFF0C\u8C03\u7528<code>Run</code>\u65B9\u6CD5\u542F\u52A8HTTP/GRPC\u670D\u52A1\u3002\u5728<code>Run</code>\u65B9\u6CD5\u4E2D\uFF0C\u5206\u522B\u542F\u52A8\u4E86GRPC\u548CHTTP\u670D\u52A1\u3002</p><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6574\u4E2Aiam-apiserver\u7684\u8F6F\u4EF6\u6846\u67B6\u662F\u6BD4\u8F83\u6E05\u6670\u7684\u3002</p><p>\u670D\u52A1\u542F\u52A8\u540E\uFF0C\u5C31\u53EF\u4EE5\u5904\u7406\u8BF7\u6C42\u4E86\u3002\u6240\u4EE5\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u518D\u6765\u770B\u4E0Biam-apiserver\u7684RESTAPI\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B\u3002</p><h3 id="iam-apiserver-\u7684rest-api\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#iam-apiserver-\u7684rest-api\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B" aria-hidden="true">#</a> iam-apiserver \u7684REST API\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B</h3><p>iam-apiserver\u7684\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B\u4E5F\u662F\u6E05\u6670\u3001\u89C4\u8303\u7684\uFF0C\u5177\u4F53\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/sm202302282203119.jpeg" alt="img"></p><p>\u7ED3\u5408\u4E0A\u9762\u8FD9\u5F20\u56FE\uFF0C\u6211\u4EEC\u6765\u770B\u4E0Biam-apiserver \u7684REST API\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B\uFF0C\u6765\u5E2E\u4F60\u66F4\u597D\u5730\u7406\u89E3iam-apiserver\u662F\u5982\u4F55\u5904\u7406HTTP\u8BF7\u6C42\u7684\u3002</p><p>**\u9996\u5148\uFF0C**\u6211\u4EEC\u901A\u8FC7API\u8C03\u7528\uFF08<code>&lt;HTTP Method&gt; + &lt;HTTP Request Path&gt;</code>\uFF09\u8BF7\u6C42iam-apiserver\u63D0\u4F9B\u7684RESTful API\u63A5\u53E3\u3002</p><p>**\u63A5\u7740\uFF0C**Gin Web\u6846\u67B6\u63A5\u6536\u5230HTTP\u8BF7\u6C42\u4E4B\u540E\uFF0C\u4F1A\u901A\u8FC7\u8BA4\u8BC1\u4E2D\u95F4\u4EF6\u5B8C\u6210\u8BF7\u6C42\u7684\u8BA4\u8BC1\uFF0Ciam-apiserver\u63D0\u4F9B\u4E86Basic\u8BA4\u8BC1\u548CBearer\u8BA4\u8BC1\u4E24\u79CD\u8BA4\u8BC1\u65B9\u5F0F\u3002</p><p>**\u8BA4\u8BC1****\u901A\u8FC7\u540E\uFF0C**\u8BF7\u6C42\u4F1A\u88AB\u6211\u4EEC\u52A0\u8F7D\u7684\u4E00\u7CFB\u5217\u4E2D\u95F4\u4EF6\u6240\u5904\u7406\uFF0C\u4F8B\u5982\u8DE8\u57DF\u3001RequestID\u3001Dump\u7B49\u4E2D\u95F4\u4EF6\u3002</p><p>**\u6700\u540E\uFF0C**\u6839\u636E<code>&lt;HTTP Method&gt; + &lt;HTTP Request Path&gt;</code>\u8FDB\u884C\u8DEF\u7531\u5339\u914D\u3002</p>`,18),Rn=s("\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u5047\u8BBE\u6211\u4EEC\u8BF7\u6C42\u7684RESTful API\u662F"),wn=n("code",null,"POST + /v1/secrets",-1),An=s("\uFF0CGin Web\u6846\u67B6\u4F1A\u6839\u636EHTTP Method\u548CHTTP Request Path\uFF0C\u67E5\u627E\u6CE8\u518C\u7684Controllers\uFF0C\u6700\u7EC8\u5339\u914D\u5230"),En={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/controller/v1/secret/create.go",target:"_blank",rel:"noopener noreferrer"},On=s("secretController.Create"),Hn=s("Controller\u3002\u5728Create Controller\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u4F9D\u6B21\u6267\u884C\u8BF7\u6C42\u53C2\u6570\u89E3\u6790\u3001\u8BF7\u6C42\u53C2\u6570\u6821\u9A8C\u3001\u8C03\u7528\u4E1A\u52A1\u5C42\u7684\u65B9\u6CD5\u521B\u5EFASecret\u3001\u5904\u7406\u4E1A\u52A1\u5C42\u7684\u8FD4\u56DE\u7ED3\u679C\uFF0C\u6700\u540E\u8FD4\u56DE\u6700\u7EC8\u7684HTTP\u8BF7\u6C42\u7ED3\u679C\u3002"),Dn=t('<h3 id="iam-apiserver\u4EE3\u7801\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#iam-apiserver\u4EE3\u7801\u67B6\u6784" aria-hidden="true">#</a> iam-apiserver\u4EE3\u7801\u67B6\u6784</h3><p>iam-apiserver\u4EE3\u7801\u8BBE\u8BA1\u9075\u5FAA\u7B80\u6D01\u67B6\u6784\u8BBE\u8BA1\uFF0C\u4E00\u4E2A\u7B80\u6D01\u67B6\u6784\u5177\u6709\u4EE5\u4E0B5\u4E2A\u7279\u6027\uFF1A</p><ul><li>**\u72EC\u7ACB\u4E8E\u6846\u67B6\uFF1A**\u8BE5\u67B6\u6784\u4E0D\u4F1A\u4F9D\u8D56\u4E8E\u67D0\u4E9B\u529F\u80FD\u5F3A\u5927\u7684\u8F6F\u4EF6\u5E93\u5B58\u5728\u3002\u8FD9\u53EF\u4EE5\u8BA9\u4F60\u4F7F\u7528\u8FD9\u6837\u7684\u6846\u67B6\u4F5C\u4E3A\u5DE5\u5177\uFF0C\u800C\u4E0D\u662F\u8BA9\u4F60\u7684\u7CFB\u7EDF\u9677\u5165\u5230\u6846\u67B6\u7684\u7EA6\u675F\u4E2D\u3002</li><li>**\u53EF\u6D4B\u8BD5\u6027\uFF1A**\u4E1A\u52A1\u89C4\u5219\u53EF\u4EE5\u5728\u6CA1\u6709UI\u3001\u6570\u636E\u5E93\u3001Web\u670D\u52A1\u6216\u5176\u4ED6\u5916\u90E8\u5143\u7D20\u7684\u60C5\u51B5\u4E0B\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u5728\u5B9E\u9645\u7684\u5F00\u53D1\u4E2D\uFF0C\u6211\u4EEC\u901A\u8FC7Mock\u6765\u89E3\u8026\u8FD9\u4E9B\u4F9D\u8D56\u3002</li><li>**\u72EC\u7ACB\u4E8EUI \uFF1A**\u5728\u65E0\u9700\u6539\u53D8\u7CFB\u7EDF\u5176\u4ED6\u90E8\u5206\u7684\u60C5\u51B5\u4E0B\uFF0CUI\u53EF\u4EE5\u8F7B\u677E\u5730\u6539\u53D8\u3002\u4F8B\u5982\uFF0C\u5728\u6CA1\u6709\u6539\u53D8\u4E1A\u52A1\u89C4\u5219\u7684\u60C5\u51B5\u4E0B\uFF0CWeb UI\u53EF\u4EE5\u66FF\u6362\u4E3A\u63A7\u5236\u53F0UI\u3002</li><li>**\u72EC\u7ACB\u4E8E\u6570\u636E\u5E93\uFF1A**\u4F60\u53EF\u4EE5\u7528Mongo\u3001Oracle\u3001Etcd\u6216\u8005\u5176\u4ED6\u6570\u636E\u5E93\u6765\u66FF\u6362MariaDB\uFF0C\u4F60\u7684\u4E1A\u52A1\u89C4\u5219\u4E0D\u8981\u7ED1\u5B9A\u5230\u6570\u636E\u5E93\u3002</li><li>**\u72EC\u7ACB\u4E8E\u5916\u90E8\u5A92\u4ECB\uFF1A**\u5B9E\u9645\u4E0A\uFF0C\u4F60\u7684\u4E1A\u52A1\u89C4\u5219\u53EF\u4EE5\u7B80\u5355\u5230\u6839\u672C\u4E0D\u53BB\u4E86\u89E3\u5916\u90E8\u4E16\u754C\u3002</li></ul><p>\u6240\u4EE5\uFF0C\u57FA\u4E8E\u8FD9\u4E9B\u7EA6\u675F\uFF0C\u6BCF\u4E00\u5C42\u90FD\u5FC5\u987B\u662F\u72EC\u7ACB\u7684\u548C\u53EF\u6D4B\u8BD5\u7684\u3002iam-apiserver\u4EE3\u7801\u67B6\u6784\u5206\u4E3A4\u5C42\uFF1A\u6A21\u578B\u5C42\uFF08Models\uFF09\u3001\u63A7\u5236\u5C42\uFF08Controller\uFF09\u3001\u4E1A\u52A1\u5C42 \uFF08Service\uFF09\u3001\u4ED3\u5E93\u5C42\uFF08Repository\uFF09\u3002\u4ECE\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u5230\u4ED3\u5E93\u5C42\uFF0C\u4ECE\u5DE6\u5230\u53F3\u5C42\u7EA7\u4F9D\u6B21\u52A0\u6DF1\u3002\u6A21\u578B\u5C42\u72EC\u7ACB\u4E8E\u5176\u4ED6\u5C42\uFF0C\u53EF\u4F9B\u5176\u4ED6\u5C42\u5F15\u7528\u3002\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/sm202302282203289.jpeg" alt="img"></p><p>\u5C42\u4E0E\u5C42\u4E4B\u95F4\u5BFC\u5165\u5305\u65F6\uFF0C\u90FD\u6709\u4E25\u683C\u7684\u5BFC\u5165\u5173\u7CFB\uFF0C\u8FD9\u53EF\u4EE5\u9632\u6B62\u5305\u7684\u5FAA\u73AF\u5BFC\u5165\u95EE\u9898\u3002\u5BFC\u5165\u5173\u7CFB\u5982\u4E0B\uFF1A</p><ul><li>\u6A21\u578B\u5C42\u7684\u5305\u53EF\u4EE5\u88AB\u4ED3\u5E93\u5C42\u3001\u4E1A\u52A1\u5C42\u548C\u63A7\u5236\u5C42\u5BFC\u5165\uFF1B</li><li>\u63A7\u5236\u5C42\u80FD\u591F\u5BFC\u5165\u4E1A\u52A1\u5C42\u548C\u4ED3\u5E93\u5C42\u7684\u5305\u3002\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\uFF0C\u5982\u679C\u6CA1\u6709\u7279\u6B8A\u9700\u6C42\uFF0C\u63A7\u5236\u5C42\u8981\u907F\u514D\u5BFC\u5165\u4ED3\u5E93\u5C42\u7684\u5305\uFF0C\u63A7\u5236\u5C42\u9700\u8981\u5B8C\u6210\u7684\u4E1A\u52A1\u529F\u80FD\u90FD\u901A\u8FC7\u4E1A\u52A1\u5C42\u6765\u5B8C\u6210\u3002\u8FD9\u6837\u53EF\u4EE5\u4F7F\u4EE3\u7801\u903B\u8F91\u66F4\u52A0\u6E05\u6670\u3001\u89C4\u8303\u3002</li><li>\u4E1A\u52A1\u5C42\u80FD\u591F\u5BFC\u5165\u4ED3\u5E93\u5C42\u7684\u5305\u3002</li></ul><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u6765\u8BE6\u7EC6\u770B\u4E0B\u6BCF\u4E00\u5C42\u6240\u5B8C\u6210\u7684\u529F\u80FD\uFF0C\u4EE5\u53CA\u5176\u4E2D\u7684\u4E00\u4E9B\u6CE8\u610F\u70B9\u3002</p><p><strong>\u6A21\u578B\u5C42\uFF08Models\uFF09</strong></p>',9),jn=s("\u6A21\u578B\u5C42\u5728\u6709\u4E9B\u8F6F\u4EF6\u67B6\u6784\u4E2D\u4E5F\u53EB\u505A\u5B9E\u4F53\u5C42\uFF08Entities\uFF09\uFF0C\u6A21\u578B\u4F1A\u5728\u6BCF\u4E00\u5C42\u4E2D\u4F7F\u7528\uFF0C\u5728\u8FD9\u4E00\u5C42\u4E2D\u5B58\u50A8\u5BF9\u8C61\u7684\u7ED3\u6784\u548C\u5B83\u7684\u65B9\u6CD5\u3002IAM\u9879\u76EE\u6A21\u578B\u5C42\u4E2D\u7684\u6A21\u578B\u5B58\u653E\u5728"),Ln={href:"https://github.com/marmotedu/api/tree/master/apiserver/v1",target:"_blank",rel:"noopener noreferrer"},Un=s("github.com/marmotedu/api/apiserver/v1"),Mn=t("\u76EE\u5F55\u4E0B\uFF0C\u5B9A\u4E49\u4E86<code>User</code>\u3001<code>UserList</code>\u3001<code>Secret</code>\u3001<code>SecretList</code>\u3001<code>Policy</code>\u3001<code>PolicyList</code>\u3001<code>AuthzPolicy</code>\u6A21\u578B\u53CA\u5176\u65B9\u6CD5\u3002\u4F8B\u5982\uFF1A",15),Wn=t('<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Secret <span class="token keyword">struct</span> <span class="token punctuation">{</span>\n  <span class="token comment">// May add TypeMeta in the future.</span>\n  <span class="token comment">// metav1.TypeMeta `json:&quot;,inline&quot;`</span>\n\n  <span class="token comment">// Standard object&#39;s metadata.</span>\n  metav1<span class="token punctuation">.</span>ObjectMeta <span class="token string">`       json:&quot;metadata,omitempty&quot;`</span>\n  Username          <span class="token builtin">string</span> <span class="token string">`json:&quot;username&quot;           gorm:&quot;column:username&quot;  validate:&quot;omitempty&quot;`</span>\n  SecretID          <span class="token builtin">string</span> <span class="token string">`json:&quot;secretID&quot;           gorm:&quot;column:secretID&quot;  validate:&quot;omitempty&quot;`</span>\n  SecretKey         <span class="token builtin">string</span> <span class="token string">`json:&quot;secretKey&quot;          gorm:&quot;column:secretKey&quot; validate:&quot;omitempty&quot;`</span>\n\n  <span class="token comment">// Required: true</span>\n  Expires     <span class="token builtin">int64</span>  <span class="token string">`json:&quot;expires&quot;     gorm:&quot;column:expires&quot;     validate:&quot;omitempty&quot;`</span>\n  Description <span class="token builtin">string</span> <span class="token string">`json:&quot;description&quot; gorm:&quot;column:description&quot; validate:&quot;description&quot;`</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E4B\u6240\u4EE5\u5C06\u6A21\u578B\u5C42\u7684\u6A21\u578B\u5B58\u653E\u5728<code>github.com/marmotedu/api</code>\u9879\u76EE\u4E2D\uFF0C\u800C\u4E0D\u662F<code>github.com/marmotedu/iam</code>\u9879\u76EE\u4E2D\uFF0C\u662F\u4E3A\u4E86\u8BA9\u8FD9\u4E9B\u6A21\u578B\u80FD\u591F\u88AB\u5176\u4ED6\u9879\u76EE\u4F7F\u7528\u3002\u4F8B\u5982\uFF0Ciam\u7684\u6A21\u578B\u53EF\u4EE5\u88AB<code>github.com/marmotedu/shippy</code>\u5E94\u7528\u5BFC\u5165\u3002\u540C\u6837\uFF0Cshippy\u5E94\u7528\u7684\u6A21\u578B\u4E5F\u53EF\u4EE5\u88ABiam\u9879\u76EE\u5BFC\u5165\uFF0C\u5BFC\u5165\u5173\u7CFB\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/sm202302282204303.jpeg" alt="img"></p><p>\u4E0A\u9762\u7684\u4F9D\u8D56\u5173\u7CFB\u90FD\u662F\u5355\u5411\u7684\uFF0C\u4F9D\u8D56\u5173\u7CFB\u6E05\u6670\uFF0C\u4E0D\u5B58\u5728\u5FAA\u73AF\u4F9D\u8D56\u7684\u60C5\u51B5\u3002</p><p>\u8981\u589E\u52A0shippy\u7684\u6A21\u578B\u5B9A\u4E49\uFF0C\u53EA\u9700\u8981\u5728api\u76EE\u5F55\u4E0B\u521B\u5EFA\u65B0\u7684\u76EE\u5F55\u5373\u53EF\u3002\u4F8B\u5982\uFF0Cshippy\u5E94\u7528\u4E2D\u6709\u4E00\u4E2Avessel\u670D\u52A1\uFF0C\u5176\u6A21\u578B\u6240\u5728\u7684\u5305\u53EF\u4EE5\u4E3A<code>github.com/marmotedu/api/vessel</code>\u3002</p><p>\u53E6\u5916\uFF0C\u8FD9\u91CC\u7684\u6A21\u578B\u65E2\u53EF\u4EE5\u4F5C\u4E3A\u6570\u636E\u5E93\u6A21\u578B\uFF0C\u53C8\u53EF\u4EE5\u4F5C\u4E3AAPI\u63A5\u53E3\u7684\u8BF7\u6C42\u6A21\u578B\uFF08\u5165\u53C2\u3001\u51FA\u53C2\uFF09\u3002\u5982\u679C\u6211\u4EEC\u80FD\u591F\u786E\u4FDD<strong>\u521B\u5EFA\u8D44\u6E90\u65F6\u7684\u5C5E\u6027</strong>\u3001<strong>\u8D44\u6E90\u4FDD\u5B58\u5728\u6570\u636E\u5E93\u4E2D\u7684\u5C5E\u6027</strong>\u3001<strong>\u8FD4\u56DE\u8D44\u6E90\u7684\u5C5E\u6027</strong>\u4E09\u8005\u4E00\u81F4\uFF0C\u5C31\u53EF\u4EE5\u4F7F\u7528\u540C\u4E00\u4E2A\u6A21\u578B\u3002\u901A\u8FC7\u4F7F\u7528\u540C\u4E00\u4E2A\u6A21\u578B\uFF0C\u53EF\u4EE5\u4F7F\u6211\u4EEC\u7684\u4EE3\u7801\u66F4\u52A0\u7B80\u6D01\u3001\u6613\u7EF4\u62A4\uFF0C\u5E76\u80FD\u63D0\u9AD8\u5F00\u53D1\u6548\u7387\u3002\u5982\u679C\u8FD9\u4E09\u4E2A\u5C5E\u6027\u6709\u5DEE\u5F02\uFF0C\u4F60\u53EF\u4EE5\u53E6\u5916\u65B0\u5EFA\u6A21\u578B\u6765\u9002\u914D\u3002</p><p><strong>\u4ED3\u5E93\u5C42\uFF08Repository)</strong></p><p>\u4ED3\u5E93\u5C42\u7528\u6765\u8DDF\u6570\u636E\u5E93/\u7B2C\u4E09\u65B9\u670D\u52A1\u8FDB\u884CCURD\u4EA4\u4E92\uFF0C\u4F5C\u4E3A\u5E94\u7528\u7A0B\u5E8F\u7684\u6570\u636E\u5F15\u64CE\u8FDB\u884C\u5E94\u7528\u6570\u636E\u7684\u8F93\u5165\u548C\u8F93\u51FA\u3002\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\uFF0C\u4ED3\u5E93\u5C42\u4EC5\u5BF9\u6570\u636E\u5E93/\u7B2C\u4E09\u65B9\u670D\u52A1\u6267\u884CCRUD\u64CD\u4F5C\uFF0C\u4E0D\u5C01\u88C5\u4EFB\u4F55\u4E1A\u52A1\u903B\u8F91\u3002</p><p>\u4ED3\u5E93\u5C42\u4E5F\u8D1F\u8D23\u9009\u62E9\u5E94\u7528\u4E2D\u5C06\u8981\u4F7F\u7528\u4EC0\u4E48\u6837\u7684\u6570\u636E\u5E93\uFF0C\u53EF\u4EE5\u662FMySQL\u3001MongoDB\u3001MariaDB\u3001Etcd\u7B49\u3002\u65E0\u8BBA\u4F7F\u7528\u54EA\u79CD\u6570\u636E\u5E93\uFF0C\u90FD\u8981\u5728\u8FD9\u5C42\u51B3\u5B9A\u3002\u4ED3\u5E93\u5C42\u4F9D\u8D56\u4E8E\u8FDE\u63A5\u6570\u636E\u5E93\u6216\u5176\u4ED6\u7B2C\u4E09\u65B9\u670D\u52A1\uFF08\u5982\u679C\u5B58\u5728\u7684\u8BDD\uFF09\u3002</p><p>\u8FD9\u4E00\u5C42\u4E5F\u4F1A\u8D77\u5230\u6570\u636E\u8F6C\u6362\u7684\u4F5C\u7528\uFF1A\u5C06\u4ECE\u6570\u636E\u5E93/\u5FAE\u670D\u52A1\u4E2D\u83B7\u53D6\u7684\u6570\u636E\u8F6C\u6362\u4E3A\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u80FD\u8BC6\u522B\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u5C06\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u7684\u6570\u636E\u683C\u5F0F\u8F6C\u6362\u4E3A\u6570\u636E\u5E93\u6216\u5FAE\u670D\u52A1\u80FD\u8BC6\u522B\u7684\u6570\u636E\u683C\u5F0F\u3002</p>',10),Gn=s("iam-apiserver\u7684\u4ED3\u5E93\u5C42\u4F4D\u4E8E"),Nn={href:"https://github.com/marmotedu/iam/tree/v1.0.3/internal/apiserver/store/mysql",target:"_blank",rel:"noopener noreferrer"},Xn=s("internal/apiserver/store/mysql"),Jn=s("\u76EE\u5F55\u4E0B\uFF0C\u91CC\u9762\u7684\u65B9\u6CD5\u7528\u6765\u8DDFMariaDB\u8FDB\u884C\u4EA4\u4E92\uFF0C\u5B8C\u6210CURD\u64CD\u4F5C\uFF0C\u4F8B\u5982\uFF0C\u4ECE\u6570\u636E\u5E93\u4E2D\u83B7\u53D6\u5BC6\u94A5\uFF1A"),Bn=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>secrets<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> username<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>GetOptions<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    secret <span class="token operator">:=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">{</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> s<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;username = ? and name= ?&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>secret<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> gorm<span class="token punctuation">.</span>ErrRecordNotFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrSecretNotFound<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrDatabase<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> secret<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u4E1A\u52A1\u5C42 (Service)</strong></p><p>\u4E1A\u52A1\u5C42\u4E3B\u8981\u7528\u6765\u5B8C\u6210\u4E1A\u52A1\u903B\u8F91\u5904\u7406\uFF0C\u6211\u4EEC\u53EF\u4EE5\u628A\u6240\u6709\u7684\u4E1A\u52A1\u903B\u8F91\u5904\u7406\u4EE3\u7801\u653E\u5728\u4E1A\u52A1\u5C42\u3002\u4E1A\u52A1\u5C42\u4F1A\u5904\u7406\u6765\u81EA\u63A7\u5236\u5C42\u7684\u8BF7\u6C42\uFF0C\u5E76\u6839\u636E\u9700\u8981\u8BF7\u6C42\u4ED3\u5E93\u5C42\u5B8C\u6210\u6570\u636E\u7684CURD\u64CD\u4F5C\u3002\u4E1A\u52A1\u5C42\u529F\u80FD\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p>`,3),Yn={href:"https://static001.geekbang.org/resource/image/61/b6/6103c58d837fd81769977bc3c947ffb6.jpg?wh=1796x1236",target:"_blank",rel:"noopener noreferrer"},Fn=n("img",{src:"http://sm.nsddd.top/sm202302282204294.jpeg",alt:"img"},null,-1),$n=s("iam-apiserver\u7684\u4E1A\u52A1\u5C42\u4F4D\u4E8E"),Vn={href:"https://github.com/marmotedu/iam/tree/v1.0.3/internal/apiserver/service",target:"_blank",rel:"noopener noreferrer"},zn=s("internal/apiserver/service"),Kn=s("\u76EE\u5F55\u4E0B\u3002\u4E0B\u9762\u662Fiam-apiserver\u4E1A\u52A1\u5C42\u4E2D\uFF0C\u7528\u6765\u521B\u5EFA\u5BC6\u94A5\u7684\u51FD\u6570\uFF1A"),Qn=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>secretService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> secret <span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrDatabase<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u4E1A\u52A1\u5C42\u6700\u7EC8\u8BF7\u6C42\u4ED3\u5E93\u5C42\u7684<code>s.store</code>\u7684<code>Create</code>\u65B9\u6CD5\uFF0C\u5C06\u5BC6\u94A5\u4FE1\u606F\u4FDD\u5B58\u5728MariaDB\u6570\u636E\u5E93\u4E2D\u3002</p><p><strong>\u63A7\u5236\u5C42\uFF08Controller\uFF09</strong></p><p>\u63A7\u5236\u5C42\u63A5\u6536HTTP\u8BF7\u6C42\uFF0C\u5E76\u8FDB\u884C\u53C2\u6570\u89E3\u6790\u3001\u53C2\u6570\u6821\u9A8C\u3001\u903B\u8F91\u5206\u53D1\u5904\u7406\u3001\u8BF7\u6C42\u8FD4\u56DE\u8FD9\u4E9B\u64CD\u4F5C\u3002\u63A7\u5236\u5C42\u4F1A\u5C06\u903B\u8F91\u5206\u53D1\u7ED9\u4E1A\u52A1\u5C42\uFF0C\u4E1A\u52A1\u5C42\u5904\u7406\u540E\u8FD4\u56DE\uFF0C\u8FD4\u56DE\u6570\u636E\u5728\u63A7\u5236\u5C42\u4E2D\u88AB\u6574\u5408\u518D\u52A0\u5DE5\uFF0C\u6700\u7EC8\u8FD4\u56DE\u7ED9\u8BF7\u6C42\u65B9\u3002\u63A7\u5236\u5C42\u76F8\u5F53\u4E8E\u5B9E\u73B0\u4E86\u4E1A\u52A1\u8DEF\u7531\u7684\u529F\u80FD\u3002\u5177\u4F53\u6D41\u7A0B\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/sm202302282206659.jpeg" alt="img"></p><p>\u8FD9\u91CC\u6211\u6709\u4E2A\u5EFA\u8BAE\uFF0C\u4E0D\u8981\u5728\u63A7\u5236\u5C42\u5199\u590D\u6742\u7684\u4EE3\u7801\uFF0C\u5982\u679C\u9700\u8981\uFF0C\u8BF7\u5C06\u8FD9\u4E9B\u4EE3\u7801\u5206\u53D1\u5230\u4E1A\u52A1\u5C42\u6216\u5176\u4ED6\u5305\u4E2D\u3002</p>`,6),Zn=s("iam-apiserver\u7684\u63A7\u5236\u5C42\u4F4D\u4E8E"),ns={href:"https://github.com/marmotedu/iam/tree/v1.0.3/internal/apiserver/controller",target:"_blank",rel:"noopener noreferrer"},ss=s("internal/apiserver/controller"),as=s("\u76EE\u5F55\u4E0B\u3002\u4E0B\u9762\u662Fiam-apiserver\u63A7\u5236\u5C42\u4E2D\u521B\u5EFA\u5BC6\u94A5\u7684\u4EE3\u7801\uFF1A"),es=t(`<div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SecretHandler<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">L</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;create secret function called.&quot;</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> r v1<span class="token punctuation">.</span>Secret

  <span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrBind<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> errs <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">len</span><span class="token punctuation">(</span>errs<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrValidation<span class="token punctuation">,</span> errs<span class="token punctuation">.</span><span class="token function">ToAggregate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>middleware<span class="token punctuation">.</span>UsernameKey<span class="token punctuation">)</span>

  secrets<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> username<span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">{</span>
    Offset<span class="token punctuation">:</span> pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Limit<span class="token punctuation">:</span>  pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrDatabase<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> secrets<span class="token punctuation">.</span>TotalCount <span class="token operator">&gt;=</span> maxSecretCount <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrReachMaxCount<span class="token punctuation">,</span> <span class="token string">&quot;secret count: %d&quot;</span><span class="token punctuation">,</span> secrets<span class="token punctuation">.</span>TotalCount<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// must reassign username</span>
  r<span class="token punctuation">.</span>Username <span class="token operator">=</span> username

  <span class="token keyword">if</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>r<span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u4E0A\u9762\u7684\u4EE3\u7801\u5B8C\u6210\u4E86\u4EE5\u4E0B\u64CD\u4F5C\uFF1A</strong></p><ol><li>\u89E3\u6790HTTP\u8BF7\u6C42\u53C2\u6570\u3002</li><li>\u8FDB\u884C\u53C2\u6570\u9A8C\u8BC1\uFF0C\u8FD9\u91CC\u53EF\u4EE5\u6DFB\u52A0\u4E00\u4E9B\u4E1A\u52A1\u6027\u8D28\u7684\u53C2\u6570\u6821\u9A8C\uFF0C\u4F8B\u5982\uFF1A<code>secrets.TotalCount &gt;= maxSecretCount</code>\u3002</li><li>\u8C03\u7528\u4E1A\u52A1\u5C42<code>s.srv</code>\u7684<code>Create</code>\u65B9\u6CD5\uFF0C\u5B8C\u6210\u5BC6\u94A5\u7684\u521B\u5EFA\u3002</li><li>\u8FD4\u56DEHTTP\u8BF7\u6C42\u53C2\u6570\u3002</li></ol><p>\u4E0A\u9762\uFF0C\u6211\u4EEC\u4ECB\u7ECD\u4E86iam-apiserver\u91C7\u7528\u76844\u5C42\u7ED3\u6784\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u518D\u770B\u770B<strong>\u6BCF\u4E00\u5C42\u4E4B\u95F4\u662F\u5982\u4F55\u901A\u4FE1\u7684</strong>\u3002</p><p>\u9664\u4E86\u6A21\u578B\u5C42\uFF0C\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u3001\u4ED3\u5E93\u5C42\u4E4B\u95F4\u90FD\u662F\u901A\u8FC7\u63A5\u53E3\u8FDB\u884C\u901A\u4FE1\u7684\u3002\u901A\u8FC7\u63A5\u53E3\u901A\u4FE1\uFF0C\u4E00\u65B9\u9762\u53EF\u4EE5\u4F7F\u76F8\u540C\u7684\u529F\u80FD\u652F\u6301\u4E0D\u540C\u7684\u5B9E\u73B0\uFF08\u4E5F\u5C31\u662F\u8BF4\u5177\u6709\u63D2\u4EF6\u5316\u80FD\u529B\uFF09\uFF0C\u53E6\u4E00\u65B9\u9762\u4E5F\u4F7F\u5F97\u6BCF\u4E00\u5C42\u7684\u4EE3\u7801\u53D8\u5F97\u53EF\u6D4B\u8BD5\u3002</p><p>\u8FD9\u91CC\uFF0C\u6211\u7528\u521B\u5EFA\u5BC6\u94A5API\u8BF7\u6C42\u7684\u4F8B\u5B50\uFF0C\u6765\u7ED9\u4F60\u8BB2\u89E3\u4E0B\u5C42\u4E0E\u5C42\u4E4B\u95F4\u662F\u5982\u4F55\u8FDB\u884C\u901A\u4FE1\u7684\u3002</p><p><strong>\u9996\u5148\uFF0C\u6765\u770B\u4E0B\u63A7\u5236\u5C42\u5982\u4F55\u8DDF\u4E1A\u52A1\u5C42\u8FDB\u884C\u901A\u4FE1\u3002</strong></p><p>\u5BF9\u5BC6\u94A5\u7684\u8BF7\u6C42\u5904\u7406\u90FD\u662F\u901A\u8FC7SecretController\u63D0\u4F9B\u7684\u65B9\u6CD5\u6765\u5904\u7406\u7684\uFF0C\u521B\u5EFA\u5BC6\u94A5\u8C03\u7528\u7684\u662F\u5B83\u7684<code>Create</code>\u65B9\u6CD5\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SecretController<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>srv<span class="token punctuation">.</span><span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token operator">&amp;</span>r<span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    core<span class="token punctuation">.</span><span class="token function">WriteResponse</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> err<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728<code>Create</code>\u65B9\u6CD5\u4E2D\uFF0C\u8C03\u7528\u4E86<code>s.srv.Secrets().Create()</code>\u6765\u521B\u5EFA\u5BC6\u94A5\uFF0C<code>s.srv</code>\u662F\u4E00\u4E2A\u63A5\u53E3\u7C7B\u578B\uFF0C\u5B9A\u4E49\u5982\u4E0B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
<span class="token keyword">type</span> Service <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> UserSrv
    <span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> SecretSrv
    <span class="token function">Policies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PolicySrv
<span class="token punctuation">}</span>

<span class="token keyword">type</span> SecretSrv <span class="token keyword">interface</span> <span class="token punctuation">{</span>                                                             
    <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> secret <span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span>    
    <span class="token function">Update</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> secret <span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>UpdateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span>            
    <span class="token function">Delete</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> username<span class="token punctuation">,</span> secretID <span class="token builtin">string</span><span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>DeleteOptions<span class="token punctuation">)</span> <span class="token builtin">error</span>                        
    <span class="token function">DeleteCollection</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> username <span class="token builtin">string</span><span class="token punctuation">,</span> secretIDs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>DeleteOptions<span class="token punctuation">)</span> <span class="token builtin">error</span>    
    <span class="token function">Get</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> username<span class="token punctuation">,</span> secretID <span class="token builtin">string</span><span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>GetOptions<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>    
    <span class="token function">List</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> username <span class="token builtin">string</span><span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>v1<span class="token punctuation">.</span>SecretList<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>    
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u63A7\u5236\u5C42\u901A\u8FC7\u4E1A\u52A1\u5C42\u63D0\u4F9B\u7684<code>Service</code>\u63A5\u53E3\u7C7B\u578B\uFF0C\u5265\u79BB\u4E86\u4E1A\u52A1\u5C42\u7684\u5177\u4F53\u5B9E\u73B0\u3002\u4E1A\u52A1\u5C42\u7684Service\u63A5\u53E3\u7C7B\u578B\u63D0\u4F9B\u4E86<code>Secrets()</code>\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u8FD4\u56DE\u4E86\u4E00\u4E2A\u5B9E\u73B0\u4E86<code>SecretSrv</code>\u63A5\u53E3\u7684\u5B9E\u4F8B\u3002\u5728\u63A7\u5236\u5C42\u4E2D\uFF0C\u901A\u8FC7\u8C03\u7528\u8BE5\u5B9E\u4F8B\u7684<code>Create(ctx context.Context, secret *v1.Secret, opts metav1.CreateOptions) error</code>\u65B9\u6CD5\u6765\u5B8C\u6210\u5BC6\u94A5\u7684\u521B\u5EFA\u3002\u81F3\u4E8E\u4E1A\u52A1\u5C42\u662F\u5982\u4F55\u521B\u5EFA\u5BC6\u94A5\u7684\uFF0C\u63A7\u5236\u5C42\u4E0D\u9700\u8981\u77E5\u9053\uFF0C\u4E5F\u5C31\u662F\u8BF4\u521B\u5EFA\u5BC6\u94A5\u53EF\u4EE5\u6709\u591A\u79CD\u5B9E\u73B0\u3002</p><p>\u8FD9\u91CC\u4F7F\u7528\u5230\u4E86\u8BBE\u8BA1\u6A21\u5F0F\u4E2D\u7684<strong>\u5DE5\u5382\u65B9\u6CD5\u6A21\u5F0F</strong>\u3002<code>Service</code>\u662F\u5DE5\u5382\u63A5\u53E3\uFF0C\u91CC\u9762\u5305\u542B\u4E86\u4E00\u7CFB\u5217\u521B\u5EFA\u5177\u4F53\u4E1A\u52A1\u5C42\u5BF9\u8C61\u7684\u5DE5\u5382\u51FD\u6570\uFF1A<code>Users()</code>\u3001<code>Secrets()</code>\u3001<code>Policies()</code>\u3002\u901A\u8FC7\u5DE5\u5382\u65B9\u6CD5\u6A21\u5F0F\uFF0C\u4E0D\u4EC5\u9690\u85CF\u4E86\u4E1A\u52A1\u5C42\u5BF9\u8C61\u7684\u521B\u5EFA\u7EC6\u8282\uFF0C\u800C\u4E14\u8FD8\u53EF\u4EE5\u5F88\u65B9\u4FBF\u5730\u5728<code>Service</code>\u5DE5\u5382\u63A5\u53E3\u5B9E\u73B0\u65B9\u6CD5\u4E2D\u6DFB\u52A0\u65B0\u7684\u4E1A\u52A1\u5C42\u5BF9\u8C61\u3002</p><p>\u4F8B\u5982\uFF0C\u6211\u4EEC\u60F3\u65B0\u589E\u4E00\u4E2A<code>Template</code>\u4E1A\u52A1\u5C42\u5BF9\u8C61\uFF0C\u7528\u6765\u5728iam-apiserver\u4E2D\u9884\u7F6E\u4E00\u4E9B\u7B56\u7565\u6A21\u677F\uFF0C\u53EF\u4EE5\u8FD9\u4E48\u6765\u52A0\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>
<span class="token keyword">type</span> Service <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Users</span><span class="token punctuation">(</span><span class="token punctuation">)</span> UserSrv
    <span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> SecretSrv
    <span class="token function">Policies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> PolicySrv
    <span class="token function">Templates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> TemplateSrv
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>service<span class="token punctuation">)</span> <span class="token function">Templates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> TemplateSrv <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">newTemplates</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u63A5\u4E0B\u6765\uFF0C\u65B0\u5EFA\u4E00\u4E2A<code>template.go</code>\u6587\u4EF6\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> TemplateSrv <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> template <span class="token operator">*</span>v1<span class="token punctuation">.</span>Template<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span>
    <span class="token comment">// Other methods</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> templateService <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    store store<span class="token punctuation">.</span>Factory
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token boolean">_</span> TemplateSrv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>templateService<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">newTemplates</span><span class="token punctuation">(</span>srv <span class="token operator">*</span>service<span class="token punctuation">)</span> <span class="token operator">*</span>TemplateService <span class="token punctuation">{</span>
    <span class="token comment">// more create logic</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>templateService<span class="token punctuation">{</span>store<span class="token punctuation">:</span> srv<span class="token punctuation">.</span>store<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>templateService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> template <span class="token operator">*</span>v1<span class="token punctuation">.</span>Template<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// normal code</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6211\u4EEC\u901A\u8FC7\u4EE5\u4E0B\u4E09\u6B65\u65B0\u589E\u4E86\u4E00\u4E2A\u4E1A\u52A1\u5C42\u5BF9\u8C61\uFF1A</p><ol><li>\u5728<code>Service</code>\u63A5\u53E3\u5B9A\u4E49\u4E2D\uFF0C\u65B0\u589E\u4E86\u4E00\u4E2A\u5165\u53E3\uFF1A<code>Templates() TemplateSrv</code>\u3002</li><li>\u5728<code>service.go</code>\u6587\u4EF6\u4E2D\uFF0C\u65B0\u589E\u4E86\u4E00\u4E2A\u51FD\u6570\uFF1A<code>Templates()</code>\u3002</li><li>\u65B0\u5EFA\u4E86<code>template.go</code>\u6587\u4EF6\uFF0C\u5728<code>template.go</code>\u4E2D\u5B9A\u4E49\u4E86templateService\u7ED3\u6784\u4F53\uFF0C\u5E76\u4E3A\u5B83\u5B9E\u73B0\u4E86<code>TemplateSrv</code>\u63A5\u53E3\u3002</li></ol><p>\u53EF\u4EE5\u770B\u5230\uFF0C\u6211\u4EEC\u65B0\u589E\u7684Template\u4E1A\u52A1\u5BF9\u8C61\u7684\u4EE3\u7801\u51E0\u4E4E\u90FD\u95ED\u73AF\u5728<code>template.go</code>\u6587\u4EF6\u4E2D\u3002\u5BF9\u5DF2\u6709\u7684<code>Service</code>\u5DE5\u5382\u63A5\u53E3\u7684\u521B\u5EFA\u65B9\u6CD5\uFF0C\u9664\u4E86\u65B0\u589E\u4E00\u4E2A\u5DE5\u5382\u65B9\u6CD5<code>Templates() TemplateSrv</code>\u5916\uFF0C\u6CA1\u6709\u5176\u4ED6\u4EFB\u4F55\u5165\u4FB5\u3002\u8FD9\u6837\u505A\u53EF\u4EE5\u907F\u514D\u5F71\u54CD\u5DF2\u6709\u4E1A\u52A1\u3002</p><p>\u5728\u5B9E\u9645\u9879\u76EE\u5F00\u53D1\u4E2D\uFF0C\u4F60\u4E5F\u6709\u53EF\u80FD\u4F1A\u60F3\u5230\u4E0B\u9762\u8FD9\u79CD\u9519\u8BEF\u7684\u521B\u5EFA\u65B9\u5F0F\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// \u9519\u8BEF\u65B9\u6CD5\u4E00</span>
<span class="token keyword">type</span> Service <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    UserSrv
    SecretSrv
    PolicySrv
    TemplateSrv
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7684\u521B\u5EFA\u65B9\u5F0F\u4E2D\uFF0C\u6211\u4EEC\u5982\u679C\u60F3\u521B\u5EFAUser\u548CSecret\uFF0C\u90A3\u53EA\u80FD\u5B9A\u4E49\u4E24\u4E2A\u4E0D\u540C\u7684\u65B9\u6CD5\uFF1ACreateUser\u548C CreateSecret\uFF0C\u8FDC\u6CA1\u6709\u5728User\u548CSecret\u5404\u81EA\u7684\u57DF\u4E2D\u63D0\u4F9B\u540C\u540D\u7684Create\u65B9\u6CD5\u6765\u5F97\u4F18\u96C5\u3002</p>`,23),ts=s("IAM\u9879\u76EE\u4E2D\u8FD8\u6709\u5176\u4ED6\u5730\u65B9\u4E5F\u4F7F\u7528\u4E86\u5DE5\u5382\u65B9\u6CD5\u6A21\u5F0F\uFF0C\u4F8B\u5982"),os={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/store/store.go#L12",target:"_blank",rel:"noopener noreferrer"},ps=s("Factory"),cs=s("\u5DE5\u5382\u63A5\u53E3\u3002"),is=t(`<p><strong>\u518D\u6765\u770B\u4E0B\u4E1A\u52A1\u5C42\u548C\u4ED3\u5E93\u5C42\u662F\u5982\u4F55\u901A\u4FE1\u7684\u3002</strong></p><p>\u4E1A\u52A1\u5C42\u548C\u4ED3\u5E93\u5C42\u4E5F\u662F\u901A\u8FC7\u63A5\u53E3\u6765\u901A\u4FE1\u7684\u3002\u4F8B\u5982\uFF0C\u5728\u4E1A\u52A1\u5C42\u4E2D\u521B\u5EFA\u5BC6\u94A5\u7684\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>secretService<span class="token punctuation">)</span> <span class="token function">Create</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> secret <span class="token operator">*</span>v1<span class="token punctuation">.</span>Secret<span class="token punctuation">,</span> opts metav1<span class="token punctuation">.</span>CreateOptions<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">Secrets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">WithCode</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>ErrDatabase<span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Create</code>\u65B9\u6CD5\u4E2D\u8C03\u7528\u4E86<code>s.store.Secrets().Create()</code>\u65B9\u6CD5\u6765\u5C06\u5BC6\u94A5\u4FDD\u5B58\u5230\u6570\u636E\u5E93\u4E2D\u3002<code>s.store</code>\u662F\u4E00\u4E2A\u63A5\u53E3\u7C7B\u578B\uFF0C\u5B9A\u4E49\u5982\u4E0B\uFF1A</p><div class="language-gp ext-gp line-numbers-mode"><pre class="language-gp"><code>type Factory interface {
    Users() UserStore
    Secrets() SecretStore
    Policies() PolicyStore
    Close() error
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E1A\u52A1\u5C42\u4E0E\u4ED3\u5E93\u5C42\u7684\u901A\u4FE1\u5B9E\u73B0\uFF0C\u548C\u63A7\u5236\u5C42\u4E0E\u4E1A\u52A1\u5C42\u7684\u901A\u4FE1\u5B9E\u73B0\u7C7B\u4F3C\uFF0C\u6240\u4EE5\u8FD9\u91CC\u4E0D\u518D\u8BE6\u7EC6\u4ECB\u7ECD\u3002</p><p>\u5230\u8FD9\u91CC\u6211\u4EEC\u77E5\u9053\u4E86\uFF0C\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u548C\u4ED3\u5E93\u5C42\u4E4B\u95F4\u662F\u901A\u8FC7\u63A5\u53E3\u6765\u901A\u4FE1\u7684\u3002\u901A\u8FC7\u63A5\u53E3\u901A\u4FE1\u6709\u4E00\u4E2A\u597D\u5904\uFF0C\u5C31\u662F\u53EF\u4EE5\u8BA9\u5404\u5C42\u53D8\u5F97\u53EF\u6D4B\u3002\u90A3\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u5C31\u6765\u770B\u4E0B<strong>\u5982\u4F55\u6D4B\u8BD5\u5404\u5C42\u7684\u4EE3\u7801</strong>\u3002\u56E0\u4E3A<strong>\u7B2C38\u8BB2</strong>\u548C<strong>\u7B2C39\u8BB2</strong>\u4F1A\u8BE6\u7EC6\u4ECB\u7ECD\u5982\u4F55\u6D4B\u8BD5Go\u4EE3\u7801\uFF0C\u6240\u4EE5\u8FD9\u91CC\u53EA\u4ECB\u7ECD\u4E0B\u6D4B\u8BD5\u601D\u8DEF\u3002</p><ol><li>\u6A21\u578B\u5C42</li></ol><p>\u56E0\u4E3A\u6A21\u578B\u5C42\u4E0D\u4F9D\u8D56\u5176\u4ED6\u4EFB\u4F55\u5C42\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u6D4B\u8BD5\u5176\u4E2D\u5B9A\u4E49\u7684\u7ED3\u6784\u53CA\u5176\u51FD\u6570\u548C\u65B9\u6CD5\u5373\u53EF\u3002</p><ol><li>\u63A7\u5236\u5C42</li></ol>`,10),ls=s("\u63A7\u5236\u5C42\u4F9D\u8D56\u4E8E\u4E1A\u52A1\u5C42\uFF0C\u610F\u5473\u7740\u8BE5\u5C42\u9700\u8981\u4E1A\u52A1\u5C42\u6765\u652F\u6301\u6D4B\u8BD5\u3002\u4F60\u53EF\u4EE5\u901A\u8FC7"),rs={href:"https://github.com/golang/mock",target:"_blank",rel:"noopener noreferrer"},us=s("golang/mock"),ds=s("\u6765mock\u4E1A\u52A1\u5C42\uFF0C\u6D4B\u8BD5\u7528\u4F8B\u53EF\u53C2\u8003"),ks={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/controller/v1/user/create_test.go#L19",target:"_blank",rel:"noopener noreferrer"},ms=s("TestUserController_Create"),vs=s("\u3002"),bs=n("ol",null,[n("li",null,"\u4E1A\u52A1\u5C42")],-1),gs=n("p",null,"\u56E0\u4E3A\u8BE5\u5C42\u4F9D\u8D56\u4E8E\u4ED3\u5E93\u5C42\uFF0C\u610F\u5473\u7740\u8BE5\u5C42\u9700\u8981\u4ED3\u5E93\u5C42\u6765\u652F\u6301\u6D4B\u8BD5\u3002\u6211\u4EEC\u6709\u4E24\u79CD\u65B9\u6CD5\u6765\u6A21\u62DF\u4ED3\u5E93\u5C42\uFF1A",-1),hs=n("ul",null,[n("li",null,[s("\u901A\u8FC7"),n("code",null,"golang/mock"),s("\u6765mock\u4ED3\u5E93\u5C42\u3002")]),n("li",null,"\u81EA\u5DF1\u5F00\u53D1\u4E00\u4E2Afake\u4ED3\u5E93\u5C42\u3002")],-1),_s=s("\u4F7F\u7528"),fs=n("code",null,"golang/mock",-1),qs=s("\u7684\u6D4B\u8BD5\u7528\u4F8B\uFF0C\u4F60\u53EF\u4EE5\u53C2\u8003"),Ts={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/service/v1/secret_test.go#L19",target:"_blank",rel:"noopener noreferrer"},Cs=s("Test_secretService_Create"),ys=s("\u3002"),Is=s("fake\u7684\u4ED3\u5E93\u5C42\u53EF\u4EE5\u53C2\u8003"),Ss={href:"https://github.com/marmotedu/iam/tree/v1.0.4/internal/apiserver/store/fake",target:"_blank",rel:"noopener noreferrer"},xs=s("fake"),Ps=s("\uFF0C\u4F7F\u7528\u8BE5fake\u4ED3\u5E93\u5C42\u8FDB\u884C\u6D4B\u8BD5\u7684\u6D4B\u8BD5\u7528\u4F8B\u4E3A"),Rs={href:"https://github.com/marmotedu/iam/blob/v1.0.4/internal/apiserver/service/v1/user_test.go#L76",target:"_blank",rel:"noopener noreferrer"},ws=s(" Test_userService_List"),As=s("\u3002"),Es=n("ol",null,[n("li",null,"\u4ED3\u5E93\u5C42")],-1),Os=s("\u4ED3\u5E93\u5C42\u4F9D\u8D56\u4E8E\u6570\u636E\u5E93\uFF0C\u5982\u679C\u8C03\u7528\u4E86\u5176\u4ED6\u5FAE\u670D\u52A1\uFF0C\u90A3\u8FD8\u4F1A\u4F9D\u8D56\u7B2C\u4E09\u65B9\u670D\u52A1\u3002\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7"),Hs={href:"https://github.com/DATA-DOG/go-sqlmock",target:"_blank",rel:"noopener noreferrer"},Ds=s("sqlmock"),js=s("\u6765\u6A21\u62DF\u6570\u636E\u5E93\u8FDE\u63A5\uFF0C\u901A\u8FC7"),Ls={href:"https://github.com/jarcoal/httpmock",target:"_blank",rel:"noopener noreferrer"},Us=s("httpmock"),Ms=s("\u6765\u6A21\u62DFHTTP\u8BF7\u6C42\u3002"),Ws=t('<h2 id="\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a> \u603B\u7ED3</h2><p>\u8FD9\u4E00\u8BB2\uFF0C\u6211\u4E3B\u8981\u4ECB\u7ECD\u4E86iam-apiserver\u7684\u529F\u80FD\u548C\u4F7F\u7528\u65B9\u6CD5\uFF0C\u4EE5\u53CA\u5B83\u7684\u4EE3\u7801\u5B9E\u73B0\u3002iam-apiserver\u662F\u4E00\u4E2AWeb\u670D\u52A1\uFF0C\u63D0\u4F9B\u4E86REST API\u6765\u5B8C\u6210\u7528\u6237\u3001\u5BC6\u94A5\u3001\u7B56\u7565\u4E09\u79CDREST\u8D44\u6E90\u7684\u589E\u5220\u6539\u67E5\u3002\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7cURL\u3001Insomnia\u7B49\u5DE5\u5177\uFF0C\u6765\u5B8C\u6210REST API\u8BF7\u6C42\u3002</p><p>iam-apiserver\u5305\u542B\u4E863\u79CD\u914D\u7F6E\uFF1AOptions\u914D\u7F6E\u3001\u5E94\u7528\u914D\u7F6E\u3001HTTP/GRPC\u670D\u52A1\u914D\u7F6E\u3002\u8FD9\u4E09\u79CD\u914D\u7F6E\u5206\u522B\u7528\u6765\u6784\u5EFA\u547D\u4EE4\u884C\u53C2\u6570\u3001\u5E94\u7528\u548CHTTP/GRPC\u670D\u52A1\u3002</p><p>iam-apiserver\u5728\u542F\u52A8\u65F6\uFF0C\u4F1A\u5148\u6784\u5EFA\u5E94\u7528\u6846\u67B6\uFF0C\u63A5\u7740\u4F1A\u8BBE\u7F6E\u5E94\u7528\u9009\u9879\uFF0C\u7136\u540E\u5BF9\u5E94\u7528\u8FDB\u884C\u521D\u59CB\u5316\uFF0C\u6700\u540E\u521B\u5EFAHTTP/GRPC\u670D\u52A1\u7684\u914D\u7F6E\u548C\u5B9E\u4F8B\uFF0C\u6700\u7EC8\u542F\u52A8HTTP/GRPC\u670D\u52A1\u3002</p><p>\u670D\u52A1\u542F\u52A8\u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u63A5\u6536HTTP\u8BF7\u6C42\u4E86\u3002\u4E00\u4E2AHTTP\u8BF7\u6C42\u4F1A\u5148\u8FDB\u884C\u8BA4\u8BC1\uFF0C\u63A5\u7740\u4F1A\u88AB\u6CE8\u518C\u7684\u4E2D\u95F4\u4EF6\u5904\u7406\uFF0C\u7136\u540E\uFF0C\u4F1A\u6839\u636E<code>(HTTP Method, HTTP Request Path)</code>\u5339\u914D\u5230\u5904\u7406\u51FD\u6570\u3002\u5728\u5904\u7406\u51FD\u6570\u4E2D\uFF0C\u4F1A\u89E3\u6790\u8BF7\u6C42\u53C2\u6570\u3001\u6821\u9A8C\u53C2\u6570\u3001\u8C03\u7528\u4E1A\u52A1\u903B\u8F91\u5904\u7406\u51FD\u6570\uFF0C\u6700\u7EC8\u8FD4\u56DE\u8BF7\u6C42\u7ED3\u679C\u3002</p><p>iam-apiserver\u91C7\u7528\u4E86\u7B80\u6D01\u67B6\u6784\uFF0C\u6574\u4E2A\u5E94\u7528\u5206\u4E3A4\u5C42\uFF1A\u6A21\u578B\u5C42\u3001\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u548C\u4ED3\u5E93\u5C42\u3002\u6A21\u578B\u5C42\u5B58\u50A8\u5BF9\u8C61\u7684\u7ED3\u6784\u548C\u5B83\u7684\u65B9\u6CD5\uFF1B\u4ED3\u5E93\u5C42\u7528\u6765\u8DDF\u6570\u636E\u5E93/\u7B2C\u4E09\u65B9\u670D\u52A1\u8FDB\u884CCURD\u4EA4\u4E92\uFF1B\u4E1A\u52A1\u5C42\u4E3B\u8981\u7528\u6765\u5B8C\u6210\u4E1A\u52A1\u903B\u8F91\u5904\u7406\uFF1B\u63A7\u5236\u5C42\u63A5\u6536HTTP\u8BF7\u6C42\uFF0C\u5E76\u8FDB\u884C\u53C2\u6570\u89E3\u6790\u3001\u53C2\u6570\u6821\u9A8C\u3001\u903B\u8F91\u5206\u53D1\u5904\u7406\u3001\u8BF7\u6C42\u8FD4\u56DE\u64CD\u4F5C\u3002\u63A7\u5236\u5C42\u3001\u4E1A\u52A1\u5C42\u3001\u4ED3\u5E93\u5C42\u4E4B\u95F4\u901A\u8FC7\u63A5\u53E3\u901A\u4FE1\uFF0C\u901A\u8FC7\u63A5\u53E3\u901A\u4FE1\u53EF\u4EE5\u4F7F\u76F8\u540C\u7684\u529F\u80FD\u652F\u6301\u4E0D\u540C\u7684\u5B9E\u73B0\uFF0C\u5E76\u4F7F\u6BCF\u4E00\u5C42\u7684\u4EE3\u7801\u53D8\u5F97\u53EF\u6D4B\u8BD5\u3002</p><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="19.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="21.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>',8),Gs=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),Ns={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},Xs=n("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),Js=s(")"),Bs=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),Ys={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},Fs=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function $s(Vs,zs){const e=c("ExternalLinkIcon"),p=c("router-link"),i=c("RouterLink");return r(),u("div",null,[n("ul",null,[n("li",null,[n("a",k,[m,a(e)])])]),v,b,g,h,n("blockquote",null,[n("p",null,[_,n("a",f,[q,a(e)])])]),T,n("nav",C,[n("ul",null,[n("li",null,[a(p,{to:"#\u5F00\u59CB"},{default:o(()=>[y]),_:1})]),n("li",null,[a(p,{to:"#iam-apiserver\u670D\u52A1\u4ECB\u7ECD"},{default:o(()=>[I]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#iam-apiserver\u529F\u80FD\u4ECB\u7ECD"},{default:o(()=>[S]),_:1})]),n("li",null,[a(p,{to:"#iam-apiserver\u4F7F\u7528\u65B9\u6CD5\u4ECB\u7ECD"},{default:o(()=>[x]),_:1})])])]),n("li",null,[a(p,{to:"#iam-apiserver\u4EE3\u7801\u5B9E\u73B0"},{default:o(()=>[P]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#iam-apiserver\u914D\u7F6E\u5904\u7406"},{default:o(()=>[R]),_:1})]),n("li",null,[a(p,{to:"#iam-apiserver\u542F\u52A8\u6D41\u7A0B\u8BBE\u8BA1"},{default:o(()=>[w]),_:1})]),n("li",null,[a(p,{to:"#iam-apiserver-\u7684rest-api\u8BF7\u6C42\u5904\u7406\u6D41\u7A0B"},{default:o(()=>[A]),_:1})]),n("li",null,[a(p,{to:"#iam-apiserver\u4EE3\u7801\u67B6\u6784"},{default:o(()=>[E]),_:1})])])]),n("li",null,[a(p,{to:"#\u603B\u7ED3"},{default:o(()=>[O]),_:1})]),n("li",null,[a(p,{to:"#end-\u94FE\u63A5"},{default:o(()=>[H]),_:1})])])]),D,n("p",null,[n("a",j,[L,a(e)])]),U,n("p",null,[M,n("a",W,[G,a(e)]),N]),X,n("p",null,[J,n("a",B,[Y,a(e)]),F]),$,V,z,K,Q,Z,n("p",null,[nn,sn,an,n("a",en,[tn,a(e)]),on,n("a",pn,[cn,a(e)]),ln,n("a",rn,[un,a(e)]),dn,kn,mn]),vn,n("p",null,[bn,n("a",gn,[hn,a(e)]),_n]),fn,n("p",null,[n("a",qn,[Tn,a(e)])]),Cn,n("p",null,[yn,n("a",In,[Sn,a(e)]),xn]),Pn,n("p",null,[Rn,wn,An,n("a",En,[On,a(e)]),Hn]),Dn,n("p",null,[jn,n("a",Ln,[Un,a(e)]),Mn]),Wn,n("p",null,[Gn,n("a",Nn,[Xn,a(e)]),Jn]),Bn,n("p",null,[n("a",Yn,[Fn,a(e)])]),n("p",null,[$n,n("a",Vn,[zn,a(e)]),Kn]),Qn,n("p",null,[Zn,n("a",ns,[ss,a(e)]),as]),es,n("p",null,[ts,n("a",os,[ps,a(e)]),cs]),is,n("p",null,[ls,n("a",rs,[us,a(e)]),ds,n("a",ks,[ms,a(e)]),vs]),bs,gs,hs,n("p",null,[_s,fs,qs,n("a",Ts,[Cs,a(e)]),ys]),n("p",null,[Is,n("a",Ss,[xs,a(e)]),Ps,n("a",Rs,[ws,a(e)]),As]),Es,n("p",null,[Os,n("a",Hs,[Ds,a(e)]),js,n("a",Ls,[Us,a(e)]),Ms]),Ws,n("ul",null,[n("li",null,[n("p",null,[a(i,{to:"/projects/"},{default:o(()=>[Gs]),_:1})])]),n("li",null,[n("p",null,[n("a",Ns,[Xs,a(e)]),Js])]),n("li",null,[n("p",null,[Bs,n("a",Ys,[Fs,a(e)])])])])])}const Qs=l(d,[["render",$s],["__file","20.html.vue"]]);export{Qs as default};
