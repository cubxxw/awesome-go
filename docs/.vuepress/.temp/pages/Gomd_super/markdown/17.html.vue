<template><div><h1 id="åŸå­æ“ä½œ-atomicåŒ…" tabindex="-1"><a class="header-anchor" href="#åŸå­æ“ä½œ-atomicåŒ…" aria-hidden="true">#</a> åŸå­æ“ä½œ(atomicåŒ…)</h1>
<nav class="table-of-contents"><ul><li><router-link to="#_1-1-1-åŸå­æ“ä½œ">1.1.1. åŸå­æ“ä½œ</router-link></li><li><router-link to="#_1-1-2-atomicåŒ…">1.1.2. atomicåŒ…</router-link></li><li><router-link to="#_1-1-3-ç¤ºä¾‹">1.1.3. ç¤ºä¾‹</router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<p>[toc]</p>
<h3 id="_1-1-1-åŸå­æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_1-1-1-åŸå­æ“ä½œ" aria-hidden="true">#</a> 1.1.1. åŸå­æ“ä½œ</h3>
<p>ä»£ç ä¸­çš„åŠ é”æ“ä½œå› ä¸ºæ¶‰åŠå†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¼šæ¯”è¾ƒè€—æ—¶ã€ä»£ä»·æ¯”è¾ƒé«˜ã€‚é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åŸå­æ“ä½œæ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œå› ä¸ºåŸå­æ“ä½œæ˜¯Goè¯­è¨€æä¾›çš„æ–¹æ³•å®ƒåœ¨ç”¨æˆ·æ€å°±å¯ä»¥å®Œæˆï¼Œå› æ­¤æ€§èƒ½æ¯”åŠ é”æ“ä½œæ›´å¥½ã€‚Goè¯­è¨€ä¸­åŸå­æ“ä½œç”±å†…ç½®çš„æ ‡å‡†åº“sync/atomicæä¾›ã€‚</p>
<h3 id="_1-1-2-atomicåŒ…" tabindex="-1"><a class="header-anchor" href="#_1-1-2-atomicåŒ…" aria-hidden="true">#</a> 1.1.2. atomicåŒ…</h3>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>func LoadInt32(addr *int32) (val int32) func LoadInt64(addr <code v-pre>*int64</code>) (val int64)<br>func LoadUint32(addr<code v-pre>*uint32</code>) (val uint32)<br>func LoadUint64(addr<code v-pre>*uint64</code>) (val uint64)<br>func LoadUintptr(addr<code v-pre>*uintptr</code>) (val uintptr)<br>func LoadPointer(addr<code v-pre>*unsafe.Pointer</code>) (val unsafe.Pointer)</td>
<td>è¯»å–æ“ä½œ</td>
</tr>
<tr>
<td>func StoreInt32(addr <code v-pre>*int32</code>, val int32) func StoreInt64(addr <code v-pre>*int64</code>, val int64) func StoreUint32(addr <code v-pre>*uint32</code>, val uint32) func StoreUint64(addr <code v-pre>*uint64</code>, val uint64) func StoreUintptr(addr <code v-pre>*uintptr</code>, val uintptr) func StorePointer(addr <code v-pre>*unsafe.Pointer</code>, val unsafe.Pointer)</td>
<td>å†™å…¥æ“ä½œ</td>
</tr>
<tr>
<td>func AddInt32(addr <code v-pre>*int32</code>, delta int32) (new int32) func AddInt64(addr <code v-pre>*int64</code>, delta int64) (new int64) func AddUint32(addr <code v-pre>*uint32</code>, delta uint32) (new uint32) func AddUint64(addr <code v-pre>*uint64</code>, delta uint64) (new uint64) func AddUintptr(addr <code v-pre>*uintptr</code>, delta uintptr) (new uintptr)</td>
<td>ä¿®æ”¹æ“ä½œ</td>
</tr>
<tr>
<td>func SwapInt32(addr <code v-pre>*int32</code>, new int32) (old int32) func SwapInt64(addr <code v-pre>*int64</code>, new int64) (old int64) func SwapUint32(addr <code v-pre>*uint32</code>, new uint32) (old uint32) func SwapUint64(addr <code v-pre>*uint64</code>, new uint64) (old uint64) func SwapUintptr(addr <code v-pre>*uintptr</code>, new uintptr) (old uintptr) func SwapPointer(addr <code v-pre>*unsafe.Pointer</code>, new unsafe.Pointer) (old unsafe.Pointer)</td>
<td>äº¤æ¢æ“ä½œ</td>
</tr>
<tr>
<td>func CompareAndSwapInt32(addr <code v-pre>*int32</code>, old, new int32) (swapped bool) func CompareAndSwapInt64(addr <code v-pre>*int64</code>, old, new int64) (swapped bool) func CompareAndSwapUint32(addr <code v-pre>*uint32</code>, old, new uint32) (swapped bool) func CompareAndSwapUint64(addr <code v-pre>*uint64</code>, old, new uint64) (swapped bool) func CompareAndSwapUintptr(addr <code v-pre>*uintptr</code>, old, new uintptr) (swapped bool) func CompareAndSwapPointer(addr <code v-pre>*unsafe.Pointer</code>, old, new unsafe.Pointer) (swapped bool)</td>
<td>æ¯”è¾ƒå¹¶äº¤æ¢æ“ä½œ</td>
</tr>
</tbody>
</table>
<h3 id="_1-1-3-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_1-1-3-ç¤ºä¾‹" aria-hidden="true">#</a> 1.1.3. ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬å¡«å†™ä¸€ä¸ªç¤ºä¾‹æ¥æ¯”è¾ƒä¸‹äº’æ–¥é”å’ŒåŸå­æ“ä½œçš„æ€§èƒ½ã€‚</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">var</span> x <span class="token builtin">int64</span>
<span class="token keyword">var</span> l sync<span class="token punctuation">.</span>Mutex
<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup

<span class="token comment">// æ™®é€šç‰ˆåŠ å‡½æ•°</span>
<span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// x = x + 1</span>
    x<span class="token operator">++</span> <span class="token comment">// ç­‰ä»·äºä¸Šé¢çš„æ“ä½œ</span>
    wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// äº’æ–¥é”ç‰ˆåŠ å‡½æ•°</span>
<span class="token keyword">func</span> <span class="token function">mutexAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    l<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    x<span class="token operator">++</span>
    l<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// åŸå­æ“ä½œç‰ˆåŠ å‡½æ•°</span>
<span class="token keyword">func</span> <span class="token function">atomicAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">// go add()       // æ™®é€šç‰ˆaddå‡½æ•° ä¸æ˜¯å¹¶å‘å®‰å…¨çš„</span>
        <span class="token comment">// go mutexAdd()  // åŠ é”ç‰ˆaddå‡½æ•° æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä½†æ˜¯åŠ é”æ€§èƒ½å¼€é”€å¤§</span>
        <span class="token keyword">go</span> <span class="token function">atomicAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åŸå­æ“ä½œç‰ˆaddå‡½æ•° æ˜¯å¹¶å‘å®‰å…¨ï¼Œæ€§èƒ½ä¼˜äºåŠ é”ç‰ˆ</span>
    <span class="token punctuation">}</span>
    wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    end <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>end<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>atomicåŒ…æä¾›äº†åº•å±‚çš„åŸå­çº§å†…å­˜æ“ä½œï¼Œå¯¹äºåŒæ­¥ç®—æ³•çš„å®ç°å¾ˆæœ‰ç”¨ã€‚è¿™äº›å‡½æ•°å¿…é¡»è°¨æ…åœ°ä¿è¯æ­£ç¡®ä½¿ç”¨ã€‚é™¤äº†æŸäº›ç‰¹æ®Šçš„åº•å±‚åº”ç”¨ï¼Œä½¿ç”¨é€šé“æˆ–è€…syncåŒ…çš„å‡½æ•°/ç±»å‹å®ç°åŒæ­¥æ›´å¥½ã€‚</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '16.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '18.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/Gomd_super/">â“‚ï¸å›åˆ°é¦–é¡µğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


