<template><div><ul>
<li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">ğŸ”¥ å¼€æºåœ°å€<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬42èŠ‚-æœåŠ¡ç¼–æ’-ä¸‹-åŸºäºhelmçš„æœåŠ¡ç¼–æ’éƒ¨ç½²å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#ç¬¬42èŠ‚-æœåŠ¡ç¼–æ’-ä¸‹-åŸºäºhelmçš„æœåŠ¡ç¼–æ’éƒ¨ç½²å®æˆ˜" aria-hidden="true">#</a> ç¬¬42èŠ‚ æœåŠ¡ç¼–æ’ï¼ˆä¸‹ï¼‰ï¼šåŸºäºHelmçš„æœåŠ¡ç¼–æ’éƒ¨ç½²å®æˆ˜</h1>
<br>
<div><a href = '41.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '43.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<nav class="table-of-contents"><ul><li><router-link to="#åˆ¶ä½œiam-chartåŒ…">åˆ¶ä½œIAM ChartåŒ…</router-link></li><li><router-link to="#iam-chartéƒ¨ç½²">IAM Chartéƒ¨ç½²</router-link></li><li><router-link to="#iamåº”ç”¨å¤šç¯å¢ƒéƒ¨ç½²">IAMåº”ç”¨å¤šç¯å¢ƒéƒ¨ç½²</router-link></li><li><router-link to="#æ€»ç»“">æ€»ç»“</router-link></li><li><router-link to="#è¯¾åç»ƒä¹ ">è¯¾åç»ƒä¹ </router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<p>[TOC]</p>
<p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»‹ç»äº† Helm çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶å¸¦ç€ä½ éƒ¨ç½²äº†ä¸€ä¸ªç®€å•çš„åº”ç”¨ã€‚æŒæ¡Helmçš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å®æˆ˜ä¸‹ï¼Œä¸€èµ·é€šè¿‡Helméƒ¨ç½²ä¸€ä¸ªIAMåº”ç”¨ã€‚</p>
<p>é€šè¿‡Helméƒ¨ç½²IAMåº”ç”¨ï¼Œé¦–å…ˆéœ€è¦åˆ¶ä½œIAM ChartåŒ…ï¼Œç„¶åé€šè¿‡ChartåŒ…æ¥ä¸€é”®éƒ¨ç½²IAMåº”ç”¨ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†åº”ç”¨éƒ¨ç½²åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿä¼šç»™ä½ æ¼”ç¤ºä¸‹å¦‚ä½•åœ¨å¤šç¯å¢ƒä¸­éƒ¨ç½²IAMåº”ç”¨ã€‚</p>
<h2 id="åˆ¶ä½œiam-chartåŒ…" tabindex="-1"><a class="header-anchor" href="#åˆ¶ä½œiam-chartåŒ…" aria-hidden="true">#</a> åˆ¶ä½œIAM ChartåŒ…</h2>
<p>åœ¨éƒ¨ç½²IAMåº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ¶ä½œä¸€ä¸ªIAM ChartåŒ…ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾IAMé¡¹ç›®æºç æ ¹ç›®å½•ä¸º<code v-pre>$</code>ï¼Œè¿›å…¥ <code v-pre>$/deployments</code>ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºChartåŒ…ã€‚å…·ä½“åˆ›å»ºæµç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œä¸‹é¢æˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚</p>
<p>**ç¬¬ä¸€æ­¥ï¼Œ**åˆ›å»ºä¸€ä¸ªæ¨¡æ¿Chartã€‚</p>
<p>Chartæ˜¯ä¸€ä¸ªç»„ç»‡åœ¨æ–‡ä»¶ç›®å½•ä¸­çš„é›†åˆï¼Œç›®å½•åç§°å°±æ˜¯Chartåç§°ï¼ˆæ²¡æœ‰ç‰ˆæœ¬ä¿¡æ¯ï¼‰ã€‚ä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ª <a href="https://helm.sh/zh/docs/topics/charts" target="_blank" rel="noopener noreferrer">Chart å¼€å‘æŒ‡å—<ExternalLinkIcon/></a> ï¼Œå®ƒä»‹ç»äº†å¦‚ä½•å¼€å‘ä½ è‡ªå·±çš„Chartã€‚</p>
<p>ä¸è¿‡ï¼Œè¿™é‡Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code v-pre>helm create</code> å‘½ä»¤æ¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ¨¡æ¿Chartï¼Œå¹¶åŸºäºè¯¥Chartè¿›è¡Œä¿®æ”¹ï¼Œå¾—åˆ°ä½ è‡ªå·±çš„Chartã€‚åˆ›å»ºå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm create iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code v-pre>helm create iam</code>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code v-pre>iam</code>ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾çš„å°±æ˜¯Chartæ–‡ä»¶ã€‚Chartç›®å½•ç»“æ„åŠæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ tree <span class="token parameter variable">-FC</span> iam/
â”œâ”€â”€ charts/                            <span class="token comment"># [å¯é€‰]: è¯¥ç›®å½•ä¸­æ”¾ç½®å½“å‰Chartä¾èµ–çš„å…¶ä»–Chart</span>
â”œâ”€â”€ Chart.yaml                         <span class="token comment"># YAMLæ–‡ä»¶ï¼Œç”¨äºæè¿°Chartçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ç‰ˆæœ¬ç­‰</span>
â”œâ”€â”€ templates/                         <span class="token comment"># [å¯é€‰]: éƒ¨ç½²æ–‡ä»¶æ¨¡ç‰ˆç›®å½•ï¼Œæ¨¡ç‰ˆä½¿ç”¨çš„å€¼æ¥è‡ªvalues.yamlå’Œç”±Tilleræä¾›çš„å€¼</span>
â”‚   â”œâ”€â”€ deployment.yaml                <span class="token comment"># Kubernetes Deployment object</span>
â”‚   â”œâ”€â”€ _helpers.tpl                   <span class="token comment"># ç”¨äºä¿®æ”¹Kubernetes objceté…ç½®çš„æ¨¡æ¿</span>
â”‚   â”œâ”€â”€ hpa.yaml                       <span class="token comment"># Kubernetes HPA object</span>
â”‚   â”œâ”€â”€ ingress.yaml                   <span class="token comment"># Kubernetes Ingress object</span>
â”‚   â”œâ”€â”€ NOTES.txt                      <span class="token comment"># [å¯é€‰]: æ”¾ç½®Chartçš„ä½¿ç”¨æŒ‡å—</span>
â”‚   â”œâ”€â”€ serviceaccount.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ tests/                         <span class="token comment"># å®šä¹‰äº†ä¸€äº›æµ‹è¯•èµ„æº</span>
â”‚       â””â”€â”€ test-connection.yaml
â””â”€â”€ values.yaml                        <span class="token comment"># Chartçš„é»˜è®¤é…ç½®æ–‡ä»¶</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç›®å½•ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼š</p>
<ul>
<li>Chart.yaml æ–‡ä»¶</li>
<li>templatesç›®å½•</li>
</ul>
<p>ä¸‹é¢æˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚<strong>æˆ‘ä»¬å…ˆæ¥çœ‹Chart.yaml æ–‡ä»¶ã€‚</strong></p>
<p>Chart.yamlç”¨æ¥æè¿°Chartçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç§°ã€ç‰ˆæœ¬ç­‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> Chart API ç‰ˆæœ¬ ï¼ˆå¿…éœ€ï¼‰
<span class="token key atrule">name</span><span class="token punctuation">:</span> Chartåç§° ï¼ˆå¿…éœ€ï¼‰
<span class="token key atrule">version</span><span class="token punctuation">:</span> è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆå¿…éœ€ï¼‰
<span class="token key atrule">kubeVersion</span><span class="token punctuation">:</span> å…¼å®¹Kubernetesç‰ˆæœ¬çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">description</span><span class="token punctuation">:</span> å¯¹è¿™ä¸ªé¡¹ç›®çš„ä¸€å¥è¯æè¿°ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">type</span><span class="token punctuation">:</span> Chartç±»å‹ ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">keywords</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> å…³äºé¡¹ç›®çš„ä¸€ç»„å…³é”®å­—ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">home</span><span class="token punctuation">:</span> é¡¹ç›®homeé¡µé¢çš„URL ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">sources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> é¡¹ç›®æºç çš„URLåˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">dependencies</span><span class="token punctuation">:</span> <span class="token comment"># chart å¿…è¦æ¡ä»¶åˆ—è¡¨ ï¼ˆå¯é€‰ï¼‰</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Chartåç§° (nginx)
    <span class="token key atrule">version</span><span class="token punctuation">:</span> Chartç‰ˆæœ¬ ("1.2.3")
    <span class="token key atrule">repository</span><span class="token punctuation">:</span> ï¼ˆå¯é€‰ï¼‰ä»“åº“URL ("https<span class="token punctuation">:</span>//example.com/charts") æˆ–åˆ«å ("@repo<span class="token punctuation">-</span>name")
    <span class="token key atrule">condition</span><span class="token punctuation">:</span> ï¼ˆå¯é€‰ï¼‰ è§£æä¸ºå¸ƒå°”å€¼çš„YAMLè·¯å¾„ï¼Œç”¨äºå¯ç”¨/ç¦ç”¨Chart(e.g. subchart1.enabled )
    <span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token comment"># ï¼ˆå¯é€‰ï¼‰</span>
      <span class="token punctuation">-</span> ç”¨äºä¸€æ¬¡å¯ç”¨/ç¦ç”¨ ä¸€ç»„Chartçš„tag
    <span class="token key atrule">import-values</span><span class="token punctuation">:</span> <span class="token comment"># ï¼ˆå¯é€‰ï¼‰</span>
      <span class="token punctuation">-</span> ImportValue ä¿å­˜æºå€¼åˆ°å¯¼å…¥çˆ¶é”®çš„æ˜ å°„ã€‚æ¯é¡¹å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…ä¸€å¯¹å­/çˆ¶åˆ—è¡¨é¡¹
    <span class="token key atrule">alias</span><span class="token punctuation">:</span> ï¼ˆå¯é€‰ï¼‰ Chartä¸­ä½¿ç”¨çš„åˆ«åã€‚å½“ä½ è¦å¤šæ¬¡æ·»åŠ ç›¸åŒçš„Chartæ—¶ä¼šå¾ˆæœ‰ç”¨
<span class="token key atrule">maintainers</span><span class="token punctuation">:</span> <span class="token comment"># ï¼ˆå¯é€‰ï¼‰</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ç»´æŠ¤è€…åå­— ï¼ˆæ¯ä¸ªç»´æŠ¤è€…éƒ½éœ€è¦ï¼‰
    <span class="token key atrule">email</span><span class="token punctuation">:</span> ç»´æŠ¤è€…é‚®ç®± ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰
    <span class="token key atrule">url</span><span class="token punctuation">:</span> ç»´æŠ¤è€…URL ï¼ˆæ¯ä¸ªç»´æŠ¤è€…å¯é€‰ï¼‰
<span class="token key atrule">icon</span><span class="token punctuation">:</span> ç”¨ä½œiconçš„SVGæˆ–PNGå›¾ç‰‡URL ï¼ˆå¯é€‰ï¼‰
<span class="token key atrule">appVersion</span><span class="token punctuation">:</span> åŒ…å«çš„åº”ç”¨ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰ã€‚ä¸éœ€è¦æ˜¯è¯­ä¹‰åŒ–ï¼Œå»ºè®®ä½¿ç”¨å¼•å·
<span class="token key atrule">deprecated</span><span class="token punctuation">:</span> ä¸è¢«æ¨èçš„Chartï¼ˆå¯é€‰ï¼Œå¸ƒå°”å€¼ï¼‰
<span class="token key atrule">annotations</span><span class="token punctuation">:</span>
  <span class="token key atrule">example</span><span class="token punctuation">:</span> æŒ‰åç§°è¾“å…¥çš„æ‰¹æ³¨åˆ—è¡¨ ï¼ˆå¯é€‰ï¼‰.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**æˆ‘ä»¬å†æ¥çœ‹ä¸‹\\templatesç›®å½•\\è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<p>templatesç›®å½•ä¸­åŒ…å«äº†åº”ç”¨ä¸­å„ä¸ªKubernetesèµ„æºçš„YAMLæ ¼å¼èµ„æºå®šä¹‰æ¨¡æ¿ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> toYaml .Values.pump.service.http<span class="token punctuation">|</span> nindent 4 <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.pump.name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">sessionAffinity</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.serviceType <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>{}</code>ä¼šè¢«<code v-pre>deployments/iam/values.yaml</code>æ–‡ä»¶ä¸­<code v-pre>pump.name</code>çš„å€¼æ›¿æ¢ã€‚ä¸Šé¢çš„æ¨¡ç‰ˆè¯­æ³•æ‰©å±•äº† Go <code v-pre>text/template</code>åŒ…çš„è¯­æ³•ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token comment"># è¿™ç§æ–¹å¼å®šä¹‰çš„æ¨¡ç‰ˆï¼Œä¼šå»é™¤testæ¨¡ç‰ˆå°¾éƒ¨æ‰€æœ‰çš„ç©ºè¡Œ</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define "test"<span class="token punctuation">}</span><span class="token punctuation">}</span>
æ¨¡ç‰ˆå†…å®¹
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment"># å»é™¤testæ¨¡ç‰ˆå¤´éƒ¨çš„ç¬¬ä¸€ä¸ªç©ºè¡Œ</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> template "test" <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯ç”¨äºYAMLæ–‡ä»¶å‰ç½®ç©ºæ ¼çš„è¯­æ³•ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># è¿™ç§æ–¹å¼å®šä¹‰çš„æ¨¡ç‰ˆï¼Œä¼šå»é™¤testæ¨¡ç‰ˆå¤´éƒ¨å’Œå°¾éƒ¨æ‰€æœ‰çš„ç©ºè¡Œ</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>- define <span class="token string">"test"</span> -<span class="token punctuation">}</span><span class="token punctuation">}</span>
æ¨¡ç‰ˆå†…å®¹
<span class="token punctuation">{</span><span class="token punctuation">{</span>- end -<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment"># å¯ä»¥åœ¨testæ¨¡ç‰ˆæ¯ä¸€è¡Œçš„å¤´éƒ¨å¢åŠ 4ä¸ªç©ºæ ¼ï¼Œç”¨äºYAMLæ–‡ä»¶çš„å¯¹é½</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> include <span class="token string">"test"</span> <span class="token operator">|</span> indent <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œè¿™é‡Œæœ‰ä¸‰ç‚¹éœ€è¦ä½ æ³¨æ„ï¼š</p>
<ul>
<li>Chartåç§°å¿…é¡»æ˜¯å°å†™å­—æ¯å’Œæ•°å­—ï¼Œå•è¯ä¹‹é—´å¯ä»¥ä½¿ç”¨æ¨ªæ <code v-pre>-</code>åˆ†éš”ï¼ŒChartåç§°ä¸­ä¸èƒ½ç”¨å¤§å†™å­—æ¯ï¼Œä¹Ÿä¸èƒ½ç”¨ä¸‹åˆ’çº¿ï¼Œ<code v-pre>.</code>å·ä¹Ÿä¸è¡Œã€‚</li>
<li>å°½å¯èƒ½ä½¿ç”¨<a href="https://semver.org/" target="_blank" rel="noopener noreferrer">SemVer 2<ExternalLinkIcon/></a>æ¥è¡¨ç¤ºç‰ˆæœ¬å·ã€‚</li>
<li>YAML æ–‡ä»¶åº”è¯¥æŒ‰ç…§åŒç©ºæ ¼çš„å½¢å¼ç¼©è¿›(ä¸€å®šä¸è¦ä½¿ç”¨tabé”®)ã€‚</li>
</ul>
<p>ç¬¬äºŒæ­¥ï¼Œç¼–è¾‘ <code v-pre>iam</code> ç›®å½•ä¸‹çš„Chartæ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åŸºäº<code v-pre>helm create</code>ç”Ÿæˆçš„æ¨¡æ¿Chartæ¥æ„å»ºè‡ªå·±çš„ChartåŒ…ã€‚è¿™é‡Œæˆ‘ä»¬æ·»åŠ äº†åˆ›å»ºiam-apiserverã€iam-authz-serverã€iam-pumpã€iamctlæœåŠ¡éœ€è¦çš„YAMLæ ¼å¼çš„Kubernetesèµ„æºæ–‡ä»¶æ¨¡æ¿ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token function">ls</span> <span class="token parameter variable">-1</span> iam/templates/*.yaml
iam/templates/hpa.yaml                                   <span class="token comment"># Kubernetes HPAæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-apiserver-deployment.yaml              <span class="token comment"># iam-apiserveræœåŠ¡deploymentæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-apiserver-service.yaml                 <span class="token comment"># iam-apiserveræœåŠ¡serviceæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-authz-server-deployment.yaml           <span class="token comment"># iam-authz-serveræœåŠ¡deploymentæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-authz-server-service.yaml              <span class="token comment"># iam-authz-serveræœåŠ¡serviceæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iamctl-deployment.yaml                     <span class="token comment"># iamctlæœåŠ¡deploymentæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-pump-deployment.yaml                   <span class="token comment"># iam-pumpæœåŠ¡deploymentæ¨¡æ¿æ–‡ä»¶</span>
iam/templates/iam-pump-service.yaml                      <span class="token comment"># iam-pumpæœåŠ¡serviceæ¨¡æ¿æ–‡ä»¶</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¨¡æ¿çš„å…·ä½“å†…å®¹ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam/templates" target="_blank" rel="noopener noreferrer">deployments/iam/templates/<ExternalLinkIcon/></a>ã€‚</p>
<p>åœ¨ç¼–è¾‘ Chart æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code v-pre>helm lint</code> éªŒè¯æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm lint iam
<span class="token operator">==</span><span class="token operator">></span> Linting iam

<span class="token number">1</span> chart<span class="token punctuation">(</span>s<span class="token punctuation">)</span> linted, <span class="token number">0</span> chart<span class="token punctuation">(</span>s<span class="token punctuation">)</span> failed
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>0 chart(s) failed</code> è¯´æ˜å½“å‰Iam ChartåŒ…æ˜¯é€šè¿‡æ ¡éªŒçš„ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹Chartçš„é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰é…ç½®ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¼–è¾‘<code v-pre>deployments/iam/values.yaml</code>æ–‡ä»¶ï¼Œå®šåˆ¶è‡ªå·±çš„é…ç½®ã€‚å…·ä½“é…ç½®ä½ å¯ä»¥å‚è€ƒ<a href="https://github.com/marmotedu/iam/blob/v1.1.0/deployments/iam/values.yaml" target="_blank" rel="noopener noreferrer">deployments/iam/values.yaml<ExternalLinkIcon/></a>ã€‚</p>
<p>åœ¨ä¿®æ”¹ <code v-pre>values.yaml</code> æ–‡ä»¶æ—¶ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢è¿™äº›æœ€ä½³å®è·µã€‚</p>
<ul>
<li>å˜é‡åç§°ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œå•è¯æŒ‰é©¼å³°åŒºåˆ†ï¼Œä¾‹å¦‚<code v-pre>chickenNoodleSoup</code>ã€‚</li>
<li>ç»™æ‰€æœ‰å­—ç¬¦ä¸²ç±»å‹çš„å€¼åŠ ä¸Šå¼•å·ã€‚</li>
<li>ä¸ºäº†é¿å…æ•´æ•°è½¬æ¢é—®é¢˜ï¼Œå°†æ•´å‹å­˜å‚¨ä¸ºå­—ç¬¦ä¸²æ›´å¥½ï¼Œå¹¶ç”¨ <code v-pre>{{ int $value }}</code> åœ¨æ¨¡æ¿ä¸­å°†å­—ç¬¦ä¸²è½¬å›æ•´å‹ã€‚</li>
<li><code v-pre>values.yaml</code>ä¸­å®šä¹‰çš„æ¯ä¸ªå±æ€§éƒ½åº”è¯¥æ–‡æ¡£åŒ–ã€‚æ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥ä»¥å®ƒè¦æè¿°çš„å±æ€§å¼€å¤´ï¼Œå¹¶è‡³å°‘ç»™å‡ºä¸€å¥æè¿°ã€‚ä¾‹å¦‚ï¼š</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># serverHost is the host name for the webserver</span>
serverHost: example
<span class="token comment"># serverPort is the HTTP listener port for the webserver</span>
serverPort: <span class="token number">9191</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ‰€æœ‰çš„Helmå†…ç½®å˜é‡éƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä»¥ä¾¿ä¸ç”¨æˆ·å®šä¹‰çš„valueè¿›è¡ŒåŒºåˆ†ï¼Œä¾‹å¦‚<code v-pre>.Release.Name</code>ã€<code v-pre>.Capabilities.KubeVersion</code>ã€‚</p>
<p>ä¸ºäº†å®‰å…¨ï¼Œvalues.yamlä¸­åªé…ç½®Kubernetesèµ„æºç›¸å…³çš„é…ç½®é¡¹ï¼Œä¾‹å¦‚Deploymentå‰¯æœ¬æ•°ã€Serviceç«¯å£ç­‰ã€‚è‡³äºiam-apiserverã€iam-authz-serverã€iam-pumpã€iamctlç»„ä»¶çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åˆ›å»ºå•ç‹¬çš„ConfigMapï¼Œå¹¶åœ¨Deploymentä¸­å¼•ç”¨ã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œæ‰“åŒ…Chartï¼Œå¹¶ä¸Šä¼ åˆ°Chartä»“åº“ä¸­ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªå¯é€‰æ­¥éª¤ï¼Œå¯ä»¥æ ¹æ®ä½ çš„å®é™…éœ€è¦æ¥é€‰æ‹©ã€‚å¦‚æœæƒ³äº†è§£å…·ä½“æ“ä½œï¼Œä½ å¯ä»¥æŸ¥çœ‹ <a href="https://helm.sh/zh/docs/topics/chart_repository" target="_blank" rel="noopener noreferrer">Helm chart ä»“åº“<ExternalLinkIcon/></a>è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>æœ€åï¼ŒIAMåº”ç”¨çš„ChartåŒ…è§<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam" target="_blank" rel="noopener noreferrer">deployments/iam<ExternalLinkIcon/></a>ã€‚</p>
<h2 id="iam-chartéƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#iam-chartéƒ¨ç½²" aria-hidden="true">#</a> IAM Chartéƒ¨ç½²</h2>
<p>ä¸Šé¢ï¼Œæˆ‘ä»¬åˆ¶ä½œäº†IAMåº”ç”¨çš„ChartåŒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä½¿ç”¨è¿™ä¸ªChartåŒ…æ¥ä¸€é”®åˆ›å»ºIAMåº”ç”¨ã€‚IAM Chartéƒ¨ç½²ä¸€å…±åˆ†ä¸º10ä¸ªæ­¥éª¤ï¼Œä½ å¯ä»¥è·Ÿç€æˆ‘ä¸€æ­¥æ­¥æ“ä½œä¸‹ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œé…ç½®<code v-pre>scripts/install/environment.sh</code>ã€‚</p>
<p><code v-pre>scripts/install/environment.sh</code>æ–‡ä»¶ä¸­åŒ…å«äº†å„ç±»è‡ªå®šä¹‰é…ç½®ï¼Œä½ ä¸»è¦é…ç½®ä¸‹é¢è¿™äº›è·Ÿæ•°æ®åº“ç›¸å…³çš„å°±å¯ä»¥ï¼Œå…¶ä»–é…ç½®ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<ul>
<li>MariaDBé…ç½®ï¼šenvironment.shæ–‡ä»¶ä¸­ä»¥<code v-pre>MARIADB</code>å¼€å¤´çš„å˜é‡ã€‚</li>
<li>Redisé…ç½®ï¼šenvironment.shæ–‡ä»¶ä¸­ä»¥<code v-pre>REDIS_</code>å¼€å¤´çš„å˜é‡ã€‚</li>
<li>MongoDBé…ç½®ï¼šenvironment.shæ–‡ä»¶ä¸­ä»¥<code v-pre>MONGO_</code>å¼€å¤´çš„å˜é‡ã€‚</li>
</ul>
<p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºIAMåº”ç”¨çš„é…ç½®æ–‡ä»¶ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token variable">${IAM_ROOT}</span>
$ <span class="token function">make</span> gen.defaultconfigs <span class="token comment"># ç”Ÿæˆiam-apiserverã€iam-authz-serverã€iam-pumpã€iamctlç»„ä»¶çš„é»˜è®¤é…ç½®æ–‡ä»¶</span>
$ <span class="token function">make</span> gen.ca <span class="token comment"># ç”Ÿæˆ CA è¯ä¹¦</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤ä¼šå°†IAMçš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨ç›®å½•<code v-pre>$/_output/configs/</code>ä¸‹ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œåˆ›å»º <code v-pre>iam</code> å‘½åç©ºé—´ã€‚</p>
<p>æˆ‘ä»¬å°†IAMåº”ç”¨æ¶‰åŠåˆ°çš„å„ç±»èµ„æºéƒ½åˆ›å»ºåœ¨<code v-pre>iam</code>å‘½åç©ºé—´ä¸­ã€‚å°†IAMèµ„æºåˆ›å»ºåœ¨ç‹¬ç«‹çš„å‘½åç©ºé—´ä¸­ï¼Œä¸ä»…æ–¹ä¾¿ç»´æŠ¤ï¼Œè¿˜å¯ä»¥æœ‰æ•ˆé¿å…å½±å“å…¶ä»–Kubernetesèµ„æºã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl create namespace iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¬¬å››æ­¥ï¼Œå°†IAMå„æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œä»¥ConfigMapèµ„æºçš„å½¢å¼ä¿å­˜åœ¨Kubernetesé›†ç¾¤ä¸­ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create configmap iam --from-file<span class="token operator">=</span><span class="token variable">${IAM_ROOT}</span>/_output/configs/
$ kubectl <span class="token parameter variable">-n</span> iam get configmap iam
NAME   DATA   AGE
iam    <span class="token number">4</span>      13s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬äº”æ­¥ï¼Œå°†IAMå„æœåŠ¡ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶ï¼Œä»¥ConfigMapèµ„æºçš„å½¢å¼ä¿å­˜åœ¨Kubernetesé›†ç¾¤ä¸­ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create configmap iam-cert --from-file<span class="token operator">=</span><span class="token variable">${IAM_ROOT}</span>/_output/cert
$ kubectl <span class="token parameter variable">-n</span> iam get configmap iam-cert
NAME       DATA   AGE
iam-cert   <span class="token number">14</span>     12s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬å…­æ­¥ï¼Œåˆ›å»ºé•œåƒä»“åº“è®¿é—®å¯†é’¥ã€‚</p>
<p>åœ¨å‡†å¤‡é˜¶æ®µï¼Œæˆ‘ä»¬å¼€é€šäº†<a href="http://ccr.ccs.tencentyun.com/" target="_blank" rel="noopener noreferrer">è…¾è®¯äº‘é•œåƒä»“åº“æœåŠ¡<ExternalLinkIcon/></a>ï¼Œå¹¶åˆ›å»ºäº†ç”¨æˆ·<code v-pre>10000099``xxxx</code>ï¼Œå¯†ç ä¸º<code v-pre>iam59!z$</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºdocker-registry secretäº†ã€‚Kubernetesåœ¨ä¸‹è½½Dockeré•œåƒæ—¶ï¼Œéœ€è¦docker-registry secretæ¥è¿›è¡Œè®¤è¯ã€‚åˆ›å»ºå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam create secret docker-registry ccr-registry --docker-server<span class="token operator">=</span>ccr.ccs.tencentyun.com --docker-username<span class="token operator">=</span>10000099xxxx --docker-password<span class="token operator">=</span><span class="token string">'iam59!z$'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¬¬ä¸ƒæ­¥ï¼Œåˆ›å»ºDockeré•œåƒï¼Œå¹¶Pushåˆ°é•œåƒä»“åº“ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token function">make</span> push <span class="token assign-left variable">REGISTRY_PREFIX</span><span class="token operator">=</span>ccr.ccs.tencentyun.com/marmotedu <span class="token assign-left variable">VERSION</span><span class="token operator">=</span>v1.1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¬¬å…«æ­¥ï¼Œå®‰è£…IAM ChartåŒ…ã€‚</p>
<p>åœ¨<a href="https://time.geekbang.org/column/article/420940" target="_blank" rel="noopener noreferrer">49è®²<ExternalLinkIcon/></a>é‡Œï¼Œæˆ‘ä»‹ç»äº†4ç§å®‰è£…ChartåŒ…çš„æ–¹æ³•ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡æœªæ‰“åŒ…çš„IAM Chartè·¯å¾„æ¥å®‰è£…ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token variable">${IAM_ROOT}</span>
$ helm <span class="token parameter variable">-n</span> iam <span class="token function">install</span> iam deployments/iam
NAME: iam
LAST DEPLOYED: Sat Aug <span class="token number">21</span> <span class="token number">17</span>:46:56 <span class="token number">2021</span>
NAMESPACE: iam
STATUS: deployed
REVISION: <span class="token number">1</span>
TEST SUITE: None
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ <code v-pre>helm install</code> åï¼ŒKubernetesä¼šè‡ªåŠ¨éƒ¨ç½²åº”ç”¨ï¼Œç­‰åˆ°IAMåº”ç”¨çš„Podéƒ½å¤„åœ¨ <code v-pre>Running</code> çŠ¶æ€æ—¶ï¼Œè¯´æ˜IAMåº”ç”¨å·²ç»æˆåŠŸå®‰è£…ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam get pods<span class="token operator">|</span><span class="token function">grep</span> iam
iam-apiserver-cb4ff955-hs827        <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iam-authz-server-7fccc7db8d-chwnn   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iam-pump-78b57b4464-rrlbf           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
iamctl-59fdc4995-xrzhn              <span class="token number">1</span>/1     Running   <span class="token number">0</span>          66s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¹æ­¥ï¼Œæµ‹è¯•IAMåº”ç”¨ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡<code v-pre>helm install</code>åœ¨<code v-pre>iam</code>å‘½ä»¤ç©ºé—´ä¸‹åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•Deployment <code v-pre>iamctl</code>ã€‚ä½ å¯ä»¥ç™»é™†<code v-pre>iamctl</code> Deploymentæ‰€åˆ›å»ºå‡ºæ¥çš„Podï¼Œæ‰§è¡Œä¸€äº›è¿ç»´æ“ä½œå’Œå†’çƒŸæµ‹è¯•ã€‚ç™»é™†å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl <span class="token parameter variable">-n</span> iam <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> kubectl <span class="token parameter variable">-n</span> iam get pods <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>iamctl <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'/iamctl/{print $1}'</span> -- <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç™»é™†åˆ°<code v-pre>iamctl-xxxxxxxxxx-xxxxx</code> Podä¸­åï¼Œä½ å°±å¯ä»¥æ‰§è¡Œè¿ç»´æ“ä½œå’Œå†’çƒŸæµ‹è¯•äº†ã€‚</p>
<p>å…ˆæ¥çœ‹è¿ç»´æ“ä½œã€‚iamctlå·¥å…·ä»¥å­å‘½ä»¤çš„æ–¹å¼å¯¹å¤–æä¾›åŠŸèƒ½ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæä¾›çš„å„ç±»åŠŸèƒ½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://static001.geekbang.org/resource/image/69/y2/693f608aa571cbfd6e06c8cfdb242yy2.png?wh=1920x337" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/69/y2/693f608aa571cbfd6e06c8cfdb242yy2.png?wh=1920x337" alt="å›¾ç‰‡"><ExternalLinkIcon/></a></p>
<p>å†æ¥çœ‹å†’çƒŸæµ‹è¯•ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>
<span class="token comment"># cd /opt/iam/scripts/install</span>
<span class="token comment"># ./test.sh iam::test::smoke</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ<code v-pre>./test.sh iam::test::smoke</code>å‘½ä»¤æ‰“å°çš„è¾“å‡ºä¸­ï¼Œæœ€åä¸€è¡Œä¸º<code v-pre>congratulations, smoke test passed!</code>å­—ç¬¦ä¸²ï¼Œå°±è¯´æ˜IAMåº”ç”¨å®‰è£…æˆåŠŸã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://static001.geekbang.org/resource/image/9d/8c/9dcc557952b3586f7b37b065bf2bd58c.png?wh=1920x314" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/9d/8c/9dcc557952b3586f7b37b065bf2bd58c.png?wh=1920x314" alt="å›¾ç‰‡"><ExternalLinkIcon/></a></p>
<p>ç¬¬åæ­¥ï¼Œé”€æ¯EKSé›†ç¾¤çš„èµ„æºã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ kubectl delete namespace iam
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©æ˜¯å¦åˆ é™¤EKSé›†ç¾¤ï¼Œå¦‚æœä¸éœ€è¦äº†å°±å¯ä»¥é€‰æ‹©åˆ é™¤ã€‚</p>
<h2 id="iamåº”ç”¨å¤šç¯å¢ƒéƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#iamåº”ç”¨å¤šç¯å¢ƒéƒ¨ç½²" aria-hidden="true">#</a> IAMåº”ç”¨å¤šç¯å¢ƒéƒ¨ç½²</h2>
<p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†IAMåº”ç”¨éƒ¨ç½²åˆ°ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œä¸åŒç¯å¢ƒçš„é…ç½®æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆIAMé¡¹ç›®æ˜¯å¦‚ä½•è¿›è¡Œå¤šç¯å¢ƒéƒ¨ç½²çš„å‘¢ï¼Ÿ</p>
<p>IAMé¡¹ç›®åœ¨<a href="https://leeshengis.com/archives/421843" target="_blank" rel="noopener noreferrer">configs<ExternalLinkIcon/></a>ç›®å½•ä¸‹åˆ›å»ºäº†å¤šä¸ªHelm valuesæ–‡ä»¶ï¼ˆæ ¼å¼ä¸º<code v-pre>values--env.yaml</code>ï¼‰ï¼š</p>
<ul>
<li>values-test-env.yamlï¼Œæµ‹è¯•ç¯å¢ƒHelm valuesæ–‡ä»¶ã€‚</li>
<li>values-pre-env.yamlï¼Œé¢„å‘ç¯å¢ƒHelm valuesæ–‡ä»¶ã€‚</li>
<li>values-prod-env.yamlï¼Œç”Ÿäº§ç¯å¢ƒHelm valuesæ–‡ä»¶ã€‚</li>
</ul>
<p>åœ¨éƒ¨ç½²IAMåº”ç”¨æ—¶ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡ŒæŒ‡å®š<code v-pre>-f</code>å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm <span class="token parameter variable">-n</span> iam <span class="token function">install</span> <span class="token parameter variable">-f</span> configs/values-test-env.yaml iam deployments/iam <span class="token comment"># å®‰è£…åˆ°æµ‹è¯•ç¯å¢ƒã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2>
<p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬é€šè¿‡ <code v-pre>helm create iam</code> åˆ›å»ºäº†ä¸€ä¸ªæ¨¡æ¿Chartï¼Œå¹¶åŸºäºè¿™ä¸ªæ¨¡æ¿ChartåŒ…è¿›è¡Œäº†äºŒæ¬¡å¼€å‘ï¼Œæœ€ç»ˆåˆ›å»ºäº†IAMåº”ç”¨çš„Helm ChartåŒ…ï¼š<a href="https://github.com/marmotedu/iam/tree/v1.1.0/deployments/iam" target="_blank" rel="noopener noreferrer">deployments/iam<ExternalLinkIcon/></a>ã€‚</p>
<p>æœ‰äº†Helm ChartåŒ…ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ <code v-pre>helm -n iam install iam deployments/iam</code> å‘½ä»¤æ¥ä¸€é”®éƒ¨ç½²å¥½æ•´ä¸ªIAMåº”ç”¨ã€‚å½“IAMåº”ç”¨ä¸­çš„æ‰€æœ‰Podéƒ½å¤„åœ¨ <code v-pre>Running</code> çŠ¶æ€åï¼Œè¯´æ˜IAMåº”ç”¨è¢«æˆåŠŸéƒ¨ç½²ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç™»å½•iamctlå®¹å™¨ï¼Œæ‰§è¡Œ <code v-pre>test.sh iam::test::smoke</code> å‘½ä»¤ï¼Œæ¥å¯¹IAMåº”ç”¨è¿›è¡Œå†’çƒŸæµ‹è¯•ã€‚</p>
<h2 id="è¯¾åç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#è¯¾åç»ƒä¹ " aria-hidden="true">#</a> è¯¾åç»ƒä¹ </h2>
<ol>
<li>è¯•ç€åœ¨Helm Chartä¸­åŠ å…¥MariaDBã€MongoDBã€Redisæ¨¡æ¿ï¼Œé€šè¿‡Helmä¸€é”®éƒ¨ç½²å¥½æ•´ä¸ªIAMåº”ç”¨ã€‚</li>
<li>è¯•ç€é€šè¿‡ <code v-pre>helm</code> å‘½ä»¤å‡çº§ã€å›æ»šå’Œåˆ é™¤IAMåº”ç”¨ã€‚</li>
</ol>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '41.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '43.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/projects/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


