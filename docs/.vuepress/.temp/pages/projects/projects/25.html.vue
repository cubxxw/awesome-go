<template><div><ul>
<li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">ğŸ”¥ å¼€æºåœ°å€<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬25èŠ‚-sdk-è®¾è®¡-ä¸Š-å¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªä¼˜ç§€çš„-go-sdk" tabindex="-1"><a class="header-anchor" href="#ç¬¬25èŠ‚-sdk-è®¾è®¡-ä¸Š-å¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªä¼˜ç§€çš„-go-sdk" aria-hidden="true">#</a> ç¬¬25èŠ‚  SDK è®¾è®¡ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªä¼˜ç§€çš„ Go SDKï¼Ÿ</h1>
<br>
<div><a href = '24.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '26.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<nav class="table-of-contents"><ul><li><router-link to="#å¼€å§‹">å¼€å§‹</router-link></li><li><router-link to="#ä»€ä¹ˆæ˜¯sdk">ä»€ä¹ˆæ˜¯SDKï¼Ÿ</router-link></li><li><router-link to="#sdkè®¾è®¡æ–¹æ³•">SDKè®¾è®¡æ–¹æ³•</router-link><ul><li><router-link to="#å¦‚ä½•ç»™sdkå‘½å">å¦‚ä½•ç»™SDKå‘½åï¼Ÿ</router-link></li><li><router-link to="#sdkçš„ç›®å½•ç»“æ„">SDKçš„ç›®å½•ç»“æ„</router-link></li><li><router-link to="#sdkè®¾è®¡æ–¹æ³•-1">SDKè®¾è®¡æ–¹æ³•</router-link></li></ul></li><li><router-link to="#å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„sdkè®¾è®¡æ–¹å¼">å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼</router-link><ul><li><router-link to="#apiå±‚-åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹">APIå±‚ï¼šåˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹</router-link></li><li><router-link to="#åŸºç¡€å±‚-æ„å»ºå¹¶æ‰§è¡Œhttpè¯·æ±‚">åŸºç¡€å±‚ï¼šæ„å»ºå¹¶æ‰§è¡ŒHTTPè¯·æ±‚</router-link></li></ul></li><li><router-link to="#æ€»ç»“">æ€»ç»“</router-link></li><li><router-link to="#è¯¾åç»ƒä¹ ">è¯¾åç»ƒä¹ </router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<p>[TOC]</p>
<h2 id="å¼€å§‹" tabindex="-1"><a class="header-anchor" href="#å¼€å§‹" aria-hidden="true">#</a> å¼€å§‹</h2>
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚æ¥ä¸‹æ¥çš„ä¸¤è®²ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€ä¸ªä¼˜ç§€çš„Go SDKã€‚</p>
<p>åç«¯æœåŠ¡é€šè¿‡APIæ¥å£å¯¹å¤–æä¾›åº”ç”¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”¨æˆ·ç›´æ¥è°ƒç”¨APIæ¥å£ï¼Œéœ€è¦ç¼–å†™APIæ¥å£è°ƒç”¨çš„é€»è¾‘ï¼Œå¹¶ä¸”éœ€è¦æ„é€ å…¥å‚å’Œè§£æè¿”å›çš„æ•°æ®åŒ…ï¼Œä½¿ç”¨èµ·æ¥æ•ˆç‡ä½ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„å¼€å‘å·¥ä½œé‡ã€‚</p>
<p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šæä¾›å¯¹å¼€å‘è€…æ›´å‹å¥½çš„SDKåŒ…ï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚å¾ˆå¤šå¤§å‹æœåŠ¡åœ¨å‘å¸ƒæ—¶éƒ½ä¼šä¼´éšç€SDKçš„å‘å¸ƒï¼Œä¾‹å¦‚è…¾è®¯äº‘å¾ˆå¤šäº§å“éƒ½æä¾›äº†SDKï¼š</p>
<p><img src="http://sm.nsddd.top/sm202303042351165.png" alt="å›¾ç‰‡"></p>
<p>æ—¢ç„¶SDKå¦‚æ­¤é‡è¦ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Go SDKå‘¢ï¼Ÿè¿™ä¸€è®²æˆ‘å°±æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯sdk" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯sdk" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯SDKï¼Ÿ</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä»€ä¹ˆæ˜¯SDKã€‚</p>
<p>å¯¹äºSDKï¼ˆSoftware Development Kitï¼Œè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼‰ï¼Œä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„è§£é‡Šã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªGoåç«¯æœåŠ¡æ¥è¯´ï¼ŒSDKé€šå¸¸æ˜¯æŒ‡<strong>å°è£…äº†Goåç«¯æœåŠ¡APIæ¥å£çš„è½¯ä»¶åŒ…</strong>ï¼Œé‡Œé¢é€šå¸¸åŒ…å«äº†è·Ÿè½¯ä»¶ç›¸å…³çš„åº“ã€æ–‡æ¡£ã€ä½¿ç”¨ç¤ºä¾‹ã€å°è£…å¥½çš„APIæ¥å£å’Œå·¥å…·ã€‚</p>
<p>è°ƒç”¨SDKè·Ÿè°ƒç”¨æœ¬åœ°å‡½æ•°æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œæ‰€ä»¥å¯ä»¥æå¤§åœ°æå‡å¼€å‘è€…çš„å¼€å‘æ•ˆç‡å’Œä½“éªŒã€‚SDKå¯ä»¥ç”±æœåŠ¡æä¾›è€…æä¾›ï¼Œä¹Ÿå¯ä»¥ç”±å…¶ä»–ç»„ç»‡æˆ–ä¸ªäººæä¾›ã€‚ä¸ºäº†é¼“åŠ±å¼€å‘è€…ä½¿ç”¨å…¶ç³»ç»Ÿæˆ–è¯­è¨€ï¼ŒSDKé€šå¸¸éƒ½æ˜¯å…è´¹æä¾›çš„ã€‚</p>
<p>é€šå¸¸ï¼ŒæœåŠ¡æä¾›è€…ä¼šæä¾›ä¸åŒè¯­è¨€çš„SDKï¼Œæ¯”å¦‚é’ˆå¯¹Pythonå¼€å‘è€…ä¼šæä¾›Pythonç‰ˆçš„SDKï¼Œé’ˆå¯¹Goå¼€å‘è€…ä¼šæä¾›Goç‰ˆçš„SDKã€‚ä¸€äº›æ¯”è¾ƒä¸“ä¸šçš„å›¢é˜Ÿè¿˜ä¼šæœ‰SDKè‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥æ ¹æ®APIæ¥å£å®šä¹‰ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸åŒè¯­è¨€çš„SDKã€‚ä¾‹å¦‚ï¼ŒProtocol Buffersçš„ç¼–è¯‘å·¥å…·protocï¼Œå°±å¯ä»¥åŸºäºProtobufæ–‡ä»¶ç”ŸæˆC++ã€Pythonã€Javaã€JavaScriptã€PHPç­‰è¯­è¨€ç‰ˆæœ¬çš„SDKã€‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘è¿™äº›ä¸€çº¿å¤§å‚ï¼Œä¹Ÿå¯ä»¥åŸºäºAPIå®šä¹‰ï¼Œç”Ÿæˆä¸åŒç¼–ç¨‹è¯­è¨€çš„SDKã€‚</p>
<h2 id="sdkè®¾è®¡æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#sdkè®¾è®¡æ–¹æ³•" aria-hidden="true">#</a> SDKè®¾è®¡æ–¹æ³•</h2>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½è®¾è®¡ä¸€ä¸ªå¥½çš„SDKå‘¢ï¼Ÿå¯¹äºSDKï¼Œä¸åŒå›¢é˜Ÿä¼šæœ‰ä¸åŒçš„è®¾è®¡æ–¹å¼ï¼Œæˆ‘è°ƒç ”äº†ä¸€äº›ä¼˜ç§€SDKçš„å®ç°ï¼Œå‘ç°è¿™äº›SDKæœ‰ä¸€äº›å…±åŒç‚¹ã€‚æ ¹æ®æˆ‘çš„è°ƒç ”ç»“æœï¼Œç»“åˆæˆ‘åœ¨å®é™…å¼€å‘ä¸­çš„ç»éªŒï¼Œæˆ‘æ€»ç»“å‡ºäº†ä¸€å¥—SDKè®¾è®¡æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±åˆ†äº«ç»™ä½ ã€‚</p>
<h3 id="å¦‚ä½•ç»™sdkå‘½å" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ç»™sdkå‘½å" aria-hidden="true">#</a> å¦‚ä½•ç»™SDKå‘½åï¼Ÿ</h3>
<p>åœ¨è®²è®¾è®¡æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘å…ˆæ¥ä»‹ç»ä¸¤ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼šSDKçš„å‘½åæ–¹å¼å’ŒSDKçš„ç›®å½•ç»“æ„ã€‚</p>
<p>SDKçš„åå­—ç›®å‰æ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒï¼Œä½†æ¯”è¾ƒå¸¸è§çš„å‘½åæ–¹å¼æ˜¯ <code v-pre>xxx-sdk-go</code> / <code v-pre>xxx-sdk-python</code> / <code v-pre>xxx-sdk-java</code> ã€‚å…¶ä¸­ï¼Œ <code v-pre>xxx</code> å¯ä»¥æ˜¯é¡¹ç›®åæˆ–è€…ç»„ç»‡åï¼Œä¾‹å¦‚è…¾è®¯äº‘åœ¨GitHubä¸Šçš„ç»„ç»‡åä¸ºtencentcloudï¼Œé‚£å®ƒçš„SDKå‘½åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://sm.nsddd.top/sm202303042351918.png" alt="å›¾ç‰‡"></p>
<h3 id="sdkçš„ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#sdkçš„ç›®å½•ç»“æ„" aria-hidden="true">#</a> SDKçš„ç›®å½•ç»“æ„</h3>
<p>ä¸åŒé¡¹ç›®SDKçš„ç›®å½•ç»“æ„ä¹Ÿä¸ç›¸åŒï¼Œä½†ä¸€èˆ¬éœ€è¦åŒ…å«ä¸‹é¢è¿™äº›æ–‡ä»¶æˆ–ç›®å½•ã€‚ç›®å½•åå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†ç›®å½•åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>
<ul>
<li><strong>README.md</strong>ï¼šSDKçš„å¸®åŠ©æ–‡æ¡£ï¼Œé‡Œé¢åŒ…å«äº†å®‰è£…ã€é…ç½®å’Œä½¿ç”¨SDKçš„æ–¹æ³•ã€‚</li>
<li><strong>examples/sample/</strong>ï¼šSDKçš„ä½¿ç”¨ç¤ºä¾‹ã€‚</li>
<li><strong>sdk/</strong>ï¼šSDKå…±äº«çš„åŒ…ï¼Œé‡Œé¢å°è£…äº†æœ€åŸºç¡€çš„é€šä¿¡åŠŸèƒ½ã€‚å¦‚æœæ˜¯HTTPæœåŠ¡ï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäº <code v-pre>net/http</code> åŒ…è¿›è¡Œå°è£…ã€‚</li>
<li><strong>api</strong>ï¼šå¦‚æœ <code v-pre>xxx-sdk-go</code> åªæ˜¯ä¸ºæŸä¸€ä¸ªæœåŠ¡æä¾›SDKï¼Œå°±å¯ä»¥æŠŠè¯¥æœåŠ¡çš„æ‰€æœ‰APIæ¥å£å°è£…ä»£ç å­˜æ”¾åœ¨apiç›®å½•ä¸‹ã€‚</li>
<li><strong>services/{iam, tms}</strong> ï¼šå¦‚æœ <code v-pre>xxx-sdk-go</code> ä¸­ï¼Œ <code v-pre>xxx</code> æ˜¯ä¸€ä¸ªç»„ç»‡ï¼Œé‚£ä¹ˆè¿™ä¸ªSDKå¾ˆå¯èƒ½ä¼šé›†æˆè¯¥ç»„ç»‡ä¸­å¾ˆå¤šæœåŠ¡çš„APIï¼Œå°±å¯ä»¥æŠŠæŸç±»æœåŠ¡çš„APIæ¥å£å°è£…ä»£ç å­˜æ”¾åœ¨ <code v-pre>services/&lt;æœåŠ¡å&gt;</code>ä¸‹ï¼Œä¾‹å¦‚AWSçš„<a href="https://github.com/aws/aws-sdk-go/tree/main/service" target="_blank" rel="noopener noreferrer">Go SDK<ExternalLinkIcon/></a>ã€‚</li>
</ul>
<p>ä¸€ä¸ªå…¸å‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>
â”œâ”€â”€ examples            <span class="token comment"># ç¤ºä¾‹ä»£ç å­˜æ”¾ç›®å½•</span>
â”‚   â””â”€â”€ authz.go
â”œâ”€â”€ README.md           <span class="token comment"># SDKä½¿ç”¨æ–‡æ¡£</span>
â”œâ”€â”€ sdk                 <span class="token comment"># å…¬å…±åŒ…ï¼Œå°è£…äº†SDKé…ç½®ã€APIè¯·æ±‚ã€è®¤è¯ç­‰ä»£ç </span>
â”‚   â”œâ”€â”€ client.go
â”‚   â”œâ”€â”€ config.go
â”‚   â”œâ”€â”€ credential.go
â”‚   â””â”€â”€ <span class="token punctuation">..</span>.
â””â”€â”€ services            <span class="token comment"># APIå°è£…</span>
    â”œâ”€â”€ common
    â”‚   â””â”€â”€ model
    â”œâ”€â”€ iam             <span class="token comment"># iamæœåŠ¡çš„APIæ¥å£</span>
    â”‚   â”œâ”€â”€ authz.go
    â”‚   â”œâ”€â”€ client.go
    â”‚   â””â”€â”€ <span class="token punctuation">..</span>.
    â””â”€â”€ tms             <span class="token comment"># tmsæœåŠ¡çš„APIæ¥å£</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sdkè®¾è®¡æ–¹æ³•-1" tabindex="-1"><a class="header-anchor" href="#sdkè®¾è®¡æ–¹æ³•-1" aria-hidden="true">#</a> SDKè®¾è®¡æ–¹æ³•</h3>
<p>SDKçš„è®¾è®¡æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://static001.geekbang.org/resource/image/9f/ca/9fb7aa8d3da4210223e9b0c87943e8ca.jpg?wh=1920x841" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/9f/ca/9fb7aa8d3da4210223e9b0c87943e8ca.jpg?wh=1920x841" alt="å›¾ç‰‡"><ExternalLinkIcon/></a></p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Configé…ç½®åˆ›å»ºå®¢æˆ·ç«¯Clientï¼Œä¾‹å¦‚ <code v-pre>func NewClient(config sdk.Config) (Client, error)</code>ï¼Œé…ç½®ä¸­å¯ä»¥æŒ‡å®šä¸‹é¢çš„ä¿¡æ¯ã€‚</p>
<ul>
<li>æœåŠ¡çš„åç«¯åœ°å€ï¼šæœåŠ¡çš„åç«¯åœ°å€å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›ºåŒ–åœ¨SDKä¸­ï¼Œæ¨èåç«¯æœåŠ¡åœ°å€å¯é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ã€‚</li>
<li>è®¤è¯ä¿¡æ¯ï¼šæœ€å¸¸ç”¨çš„è®¤è¯æ–¹å¼æ˜¯é€šè¿‡å¯†é’¥è®¤è¯ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è®¤è¯ã€‚</li>
<li>å…¶ä»–é…ç½®ï¼šä¾‹å¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ã€ç¼“å­˜æ—¶é—´ç­‰ã€‚</li>
</ul>
<p>åˆ›å»ºçš„Clientæ˜¯ä¸€ä¸ªç»“æ„ä½“æˆ–è€…Go interfaceã€‚è¿™é‡Œæˆ‘å»ºè®®ä½ ä½¿ç”¨interfaceç±»å‹ï¼Œè¿™æ ·å¯ä»¥å°†å®šä¹‰å’Œå…·ä½“å®ç°è§£è€¦ã€‚Clientå…·æœ‰ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚ CreateUserã€DeleteUserç­‰ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªAPIæ¥å£ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªClientå®šä¹‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
<span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    client <span class="token operator">*</span>sdk<span class="token punctuation">.</span>Request
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Client<span class="token punctuation">)</span> <span class="token function">CreateUser</span><span class="token punctuation">(</span>req <span class="token operator">*</span>CreateUserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>CreateUserResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// normal code</span>
    resp <span class="token operator">:=</span> <span class="token operator">&amp;</span>CreateUserResponse<span class="token punctuation">{</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> c<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
    <span class="token keyword">return</span> resp<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒç”¨ <code v-pre>client.CreateUser(req)</code> ä¼šæ‰§è¡ŒHTTPè¯·æ±‚ï¼Œåœ¨ <code v-pre>req</code> ä¸­å¯ä»¥æŒ‡å®šHTTPè¯·æ±‚çš„æ–¹æ³•Methodã€è·¯å¾„Pathå’Œè¯·æ±‚Bodyã€‚ <code v-pre>CreateUser</code> å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨ <code v-pre>c.client.Send(req)</code> æ‰§è¡Œå…·ä½“çš„HTTPè¯·æ±‚ã€‚</p>
<p><code v-pre>c.client</code> æ˜¯ <code v-pre>*Request</code> ç±»å‹çš„å˜é‡ï¼Œ <code v-pre>*Request</code> ç±»å‹çš„å˜é‡å…·æœ‰ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„è¯·æ±‚å‚æ•° <code v-pre>req</code> å’Œ <code v-pre>config</code> é…ç½®æ„é€ å‡ºè¯·æ±‚è·¯å¾„ã€è®¤è¯å¤´å’Œè¯·æ±‚Bodyï¼Œå¹¶è°ƒç”¨ <code v-pre>net/http</code> åŒ…å®Œæˆæœ€ç»ˆçš„HTTPè¯·æ±‚ï¼Œæœ€åå°†è¿”å›ç»“æœUnmarshalåˆ°ä¼ å…¥çš„ <code v-pre>resp</code> ç»“æ„ä½“ä¸­ã€‚</p>
<p>æ ¹æ®æˆ‘çš„è°ƒç ”ï¼Œç›®å‰æœ‰ä¸¤ç§SDKè®¾è®¡æ–¹å¼å¯ä¾›å‚è€ƒï¼Œä¸€ç§æ˜¯å„å¤§å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼ï¼Œä¸€ç§æ˜¯Kubernetes client-goçš„è®¾è®¡æ–¹å¼ã€‚IAMé¡¹ç›®åˆ†åˆ«å®ç°äº†è¿™ä¸¤ç§SDKè®¾è®¡æ–¹å¼ï¼Œä½†æˆ‘è¿˜æ˜¯æ›´å€¾å‘äºå¯¹å¤–æä¾›client-goæ–¹å¼çš„SDKï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€è®²è¯¦ç»†ä»‹ç»å®ƒã€‚è¿™ä¸¤ç§è®¾è®¡æ–¹å¼çš„è®¾è®¡æ€è·¯è·Ÿä¸Šé¢ä»‹ç»çš„æ˜¯ä¸€è‡´çš„ã€‚</p>
<h2 id="å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„sdkè®¾è®¡æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„sdkè®¾è®¡æ–¹å¼" aria-hidden="true">#</a> å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼</h2>
<p>è¿™é‡Œï¼Œæˆ‘å…ˆæ¥ç®€å•ä»‹ç»ä¸‹å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ¨¡å¼ã€‚SDKæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://sm.nsddd.top/sm202303042351396.jpeg" alt="å›¾ç‰‡"></p>
<p>SDKæ¡†æ¶åˆ†ä¸ºä¸¤å±‚ï¼Œåˆ†åˆ«æ˜¯APIå±‚å’ŒåŸºç¡€å±‚ã€‚APIå±‚ä¸»è¦ç”¨æ¥æ„å»ºå®¢æˆ·ç«¯å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®¢æˆ·ç«¯å®ä¾‹æä¾›çš„æ–¹æ³•æ¥å®ŒæˆAPIè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªAPIæ¥å£ã€‚APIå±‚æœ€ç»ˆä¼šè°ƒç”¨åŸºç¡€å±‚æä¾›çš„èƒ½åŠ›ï¼Œæ¥å®ŒæˆREST APIè¯·æ±‚ã€‚åŸºç¡€å±‚é€šè¿‡ä¾æ¬¡æ‰§è¡Œæ„å»ºè¯·æ±‚å‚æ•°ï¼ˆBuilderï¼‰ã€ç­¾å‘å¹¶æ·»åŠ è®¤è¯å¤´ï¼ˆSignerï¼‰ã€æ‰§è¡ŒHTTPè¯·æ±‚ï¼ˆRequestï¼‰ä¸‰å¤§æ­¥éª¤ï¼Œæ¥å®Œæˆå…·ä½“çš„REST APIè¯·æ±‚ã€‚</p>
<p>ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£å…¬æœ‰äº‘SDKçš„è®¾è®¡æ–¹å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»“åˆä¸€äº›çœŸå®çš„ä»£ç ï¼Œç»™ä½ è®²è§£APIå±‚å’ŒåŸºç¡€å±‚çš„å…·ä½“è®¾è®¡ï¼ŒSDKä»£ç è§<a href="https://github.com/marmotedu/medu-sdk-go" target="_blank" rel="noopener noreferrer">medu-sdk-go<ExternalLinkIcon/></a>ã€‚</p>
<h3 id="apiå±‚-åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#apiå±‚-åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹" aria-hidden="true">#</a> APIå±‚ï¼šåˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹</h3>
<p>å®¢æˆ·ç«¯åœ¨ä½¿ç”¨æœåŠ¡Açš„SDKæ—¶ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®Configé…ç½®åˆ›å»ºä¸€ä¸ªæœåŠ¡Açš„å®¢æˆ·ç«¯Clientï¼ŒClientå®é™…ä¸Šæ˜¯ä¸€ä¸ªstructï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    sdk<span class="token punctuation">.</span>Client
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œéœ€è¦ä¼ å…¥è®¤è¯ï¼ˆä¾‹å¦‚å¯†é’¥ã€ç”¨æˆ·å/å¯†ç ï¼‰ã€åç«¯æœåŠ¡åœ°å€ç­‰é…ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/services/iam/authz/client.go#L24-L29" target="_blank" rel="noopener noreferrer">NewClientWithSecret<ExternalLinkIcon/></a>æ–¹æ³•æ¥æ„å»ºä¸€ä¸ªå¸¦å¯†é’¥å¯¹çš„å®¢æˆ·ç«¯ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewClientWithSecret</span><span class="token punctuation">(</span>secretID<span class="token punctuation">,</span> secretKey <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>client <span class="token operator">*</span>Client<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client <span class="token operator">=</span> <span class="token operator">&amp;</span>Client<span class="token punctuation">{</span><span class="token punctuation">}</span>
    config <span class="token operator">:=</span> sdk<span class="token punctuation">.</span><span class="token function">NewConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithEndpoint</span><span class="token punctuation">(</span>defaultEndpoint<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithSecret</span><span class="token punctuation">(</span>secretID<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">WithConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸Šé¢åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œä¼ å…¥çš„å¯†é’¥å¯¹æœ€ç»ˆä¼šåœ¨åŸºç¡€å±‚ä¸­è¢«ä½¿ç”¨ï¼Œç”¨æ¥ç­¾å‘JWT Tokenã€‚</p>
<p>Clientæœ‰å¤šä¸ªæ–¹æ³•ï¼ˆSenderï¼‰ï¼Œä¾‹å¦‚ Authzç­‰ï¼Œæ¯ä¸ªæ–¹æ³•ä»£è¡¨ä¸€ä¸ªAPIæ¥å£ã€‚Senderæ–¹æ³•ä¼šæ¥æ”¶AuthzRequestç­‰ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆä½œä¸ºè¾“å…¥å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code v-pre>client.Authz(req)</code> æ¥æ‰§è¡ŒREST APIè°ƒç”¨ã€‚å¯ä»¥åœ¨ <code v-pre>client.Authz</code> æ–¹æ³•ä¸­æ·»åŠ ä¸€äº›ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚<code v-pre>client.Authz</code> ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
<span class="token keyword">type</span> AuthzRequest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span>request<span class="token punctuation">.</span>BaseRequest
    Resource <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">`json:"resource"`</span>
    Action <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">`json:"action"`</span>
    Subject <span class="token operator">*</span><span class="token builtin">string</span> <span class="token string">`json:"subject"`</span>
    Context <span class="token operator">*</span>ladon<span class="token punctuation">.</span>Context
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Client<span class="token punctuation">)</span> <span class="token function">Authz</span><span class="token punctuation">(</span>req <span class="token operator">*</span>AuthzRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span>resp <span class="token operator">*</span>AuthzResponse<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> req <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        req <span class="token operator">=</span> <span class="token function">NewAuthzRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    resp <span class="token operator">=</span> <span class="token function">NewAuthzResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    err <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚ç»“æ„ä½“ä¸­çš„å­—æ®µéƒ½æ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œä½¿ç”¨æŒ‡é’ˆçš„å¥½å¤„æ˜¯å¯ä»¥åˆ¤æ–­å…¥å‚æ˜¯å¦æœ‰è¢«æŒ‡å®šï¼Œå¦‚æœ<code v-pre>req.Subject == nil</code> å°±è¯´æ˜ä¼ å‚ä¸­æ²¡æœ‰Subjectå‚æ•°ï¼Œå¦‚æœ<code v-pre>req.Subject != nil</code>å°±è¯´æ˜å‚æ•°ä¸­æœ‰ä¼ Subjectå‚æ•°ã€‚æ ¹æ®æŸä¸ªå‚æ•°æ˜¯å¦è¢«ä¼ å…¥ï¼Œæ‰§è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™åœ¨Go APIæ¥å£å¼€å‘ä¸­éå¸¸å¸¸è§ã€‚</p>
<p>å¦å¤–ï¼Œå› ä¸ºClienté€šè¿‡åŒ¿åçš„æ–¹å¼ç»§æ‰¿äº†åŸºç¡€å±‚ä¸­çš„<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L18-L24" target="_blank" rel="noopener noreferrer">Client<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  sdk<span class="token punctuation">.</span>Client
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥ï¼ŒAPIå±‚åˆ›å»ºçš„Clientæœ€ç»ˆå¯ä»¥ç›´æ¥è°ƒç”¨åŸºç¡€å±‚ä¸­çš„Clientæä¾›çš„<code v-pre>Send(req, resp)</code> æ–¹æ³•ï¼Œæ¥æ‰§è¡ŒRESTful APIè°ƒç”¨ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ <code v-pre>resp</code> ä¸­ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿å’ŒAPIå±‚çš„Clientè¿›è¡ŒåŒºåˆ†ï¼Œæˆ‘ä¸‹é¢ç»Ÿä¸€å°†åŸºç¡€å±‚ä¸­çš„Clientç§°ä¸º<strong>sdk.Client</strong>ã€‚</p>
<p>æœ€åï¼Œä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"fmt"</span>

  <span class="token string">"github.com/ory/ladon"</span>

  <span class="token string">"github.com/marmotedu/medu-sdk-go/sdk"</span>
  iam <span class="token string">"github.com/marmotedu/medu-sdk-go/services/iam/authz"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> iam<span class="token punctuation">.</span><span class="token function">NewClientWithSecret</span><span class="token punctuation">(</span><span class="token string">"XhbY3aCrfjdYcP1OFJRu9xcno8JzSbUIvGE2"</span><span class="token punctuation">,</span> <span class="token string">"bfJRvlFwsoW9L30DlG87BBW0arJamSeK"</span><span class="token punctuation">)</span>

  req <span class="token operator">:=</span> iam<span class="token punctuation">.</span><span class="token function">NewAuthzRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span>Resource <span class="token operator">=</span> sdk<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"resources:articles:ladon-introduction"</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span>Action <span class="token operator">=</span> sdk<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"delete"</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span>Subject <span class="token operator">=</span> sdk<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"users:peter"</span><span class="token punctuation">)</span>
  ctx <span class="token operator">:=</span> ladon<span class="token punctuation">.</span><span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">"remoteIPAddress"</span><span class="token punctuation">:</span> <span class="token string">"192.168.0.5"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span>Context <span class="token operator">=</span> <span class="token operator">&amp;</span>ctx

  resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Authz</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"err1"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"get response body: `%s`\n"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"allowed: %v\n"</span><span class="token punctuation">,</span> resp<span class="token punctuation">.</span>Allowed<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŸºç¡€å±‚-æ„å»ºå¹¶æ‰§è¡Œhttpè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€å±‚-æ„å»ºå¹¶æ‰§è¡Œhttpè¯·æ±‚" aria-hidden="true">#</a> åŸºç¡€å±‚ï¼šæ„å»ºå¹¶æ‰§è¡ŒHTTPè¯·æ±‚</h3>
<p>ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†å®¢æˆ·ç«¯å®ä¾‹ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„ <a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L61-L93" target="_blank" rel="noopener noreferrer">Send<ExternalLinkIcon/></a> æ–¹æ³•æ¥å®Œæˆæœ€ç»ˆçš„HTTPè¯·æ±‚ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹Sendæ–¹æ³•å…·ä½“æ˜¯å¦‚ä½•æ„å»ºHTTPè¯·æ±‚çš„ã€‚</p>
<p>sdk.Clienté€šè¿‡Sendæ–¹æ³•ï¼Œå®Œæˆæœ€ç»ˆçš„APIè°ƒç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Client<span class="token punctuation">)</span> <span class="token function">Send</span><span class="token punctuation">(</span>req request<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> resp response<span class="token punctuation">.</span>Response<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  method <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">GetMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  builder <span class="token operator">:=</span> <span class="token function">GetParameterBuilder</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Logger<span class="token punctuation">)</span>
  jsonReq<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
  encodedUrl<span class="token punctuation">,</span> err <span class="token operator">:=</span> builder<span class="token punctuation">.</span><span class="token function">BuildURL</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">GetURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> jsonReq<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  endPoint <span class="token operator">:=</span> c<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Endpoint
  <span class="token keyword">if</span> endPoint <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
    endPoint <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s/%s"</span><span class="token punctuation">,</span> defaultEndpoint<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ServiceName<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  reqUrl <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s://%s/%s%s"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Scheme<span class="token punctuation">,</span> endPoint<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">GetVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encodedUrl<span class="token punctuation">)</span>

  body<span class="token punctuation">,</span> err <span class="token operator">:=</span> builder<span class="token punctuation">.</span><span class="token function">BuildBody</span><span class="token punctuation">(</span>jsonReq<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  sign <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    signer <span class="token operator">:=</span> <span class="token function">NewSigner</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>signMethod<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Credential<span class="token punctuation">,</span> c<span class="token punctuation">.</span>Logger<span class="token punctuation">)</span>
    <span class="token boolean">_</span> <span class="token operator">=</span> signer<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>ServiceName<span class="token punctuation">,</span> r<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  rawResponse<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">doSend</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> reqUrl<span class="token punctuation">,</span> body<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">GetHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">ParseFromHttpResponse</span><span class="token punctuation">(</span>rawResponse<span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ä»£ç å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºå››ä¸ªæ­¥éª¤ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥ï¼ŒBuilderï¼šæ„å»ºè¯·æ±‚å‚æ•°ã€‚</strong></p>
<p>æ ¹æ®ä¼ å…¥çš„AuthzRequestå’Œå®¢æˆ·ç«¯é…ç½®Configï¼Œæ„é€ HTTPè¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚Bodyã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•æ„é€ HTTPè¯·æ±‚å‚æ•°ã€‚</p>
<ol>
<li>HTTPè¯·æ±‚è·¯å¾„æ„å»º</li>
</ol>
<p>åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/services/iam/authz/authz.go#L32-L42" target="_blank" rel="noopener noreferrer">NewAuthzRequest<ExternalLinkIcon/></a>å‡½æ•°åˆ›å»ºäº† <code v-pre>/v1/authz</code> REST APIæ¥å£è¯·æ±‚ç»“æ„ä½“AuthzRequestï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewAuthzRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>req <span class="token operator">*</span>AuthzRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    req <span class="token operator">=</span> <span class="token operator">&amp;</span>AuthzRequest<span class="token punctuation">{</span>    
        BaseRequest<span class="token punctuation">:</span> <span class="token operator">&amp;</span>request<span class="token punctuation">.</span>BaseRequest<span class="token punctuation">{</span>    
            URL<span class="token punctuation">:</span>     <span class="token string">"/authz"</span><span class="token punctuation">,</span>    
            Method<span class="token punctuation">:</span>  <span class="token string">"POST"</span><span class="token punctuation">,</span>    
            Header<span class="token punctuation">:</span>  <span class="token boolean">nil</span><span class="token punctuation">,</span>    
            Version<span class="token punctuation">:</span> <span class="token string">"v1"</span><span class="token punctuation">,</span>    
        <span class="token punctuation">}</span><span class="token punctuation">,</span>    
    <span class="token punctuation">}</span>    
    <span class="token keyword">return</span>                                
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ <code v-pre>req</code> ä¸­åŒ…å«äº†APIç‰ˆæœ¬ï¼ˆVersionï¼‰ã€APIè·¯å¾„ï¼ˆURLï¼‰å’Œè¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Sendæ–¹æ³•ä¸­ï¼Œæ„å»ºå‡ºè¯·æ±‚è·¯å¾„ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
endPoint <span class="token operator">:=</span> c<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Endpoint                                                 
<span class="token keyword">if</span> endPoint <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>                                                          
    endPoint <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s/%s"</span><span class="token punctuation">,</span> defaultEndpoint<span class="token punctuation">,</span> c<span class="token punctuation">.</span>ServiceName<span class="token punctuation">)</span>           
<span class="token punctuation">}</span>                                                                  
reqUrl <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s://%s/%s%s"</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Scheme<span class="token punctuation">,</span> endPoint<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">GetVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encodedUrl<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œc.Config.Scheme=http/httpsã€endPoint=iam.api.marmotedu.com:8080ã€req.GetVersion()=v1å’ŒencodedUrlï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒä»¬ç­‰äº/authzã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆæ„å»ºå‡ºçš„è¯·æ±‚è·¯å¾„ä¸º<code v-pre>http://iam.api.marmotedu.com:8080/v1/authz</code> ã€‚</p>
<p><strong>HTTPè¯·æ±‚Bodyæ„å»º</strong></p>
<p>åœ¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/parameter_builder.go#L68-L86" target="_blank" rel="noopener noreferrer">BuildBody<ExternalLinkIcon/></a>æ–¹æ³•ä¸­æ„å»ºè¯·æ±‚Bodyã€‚BuildBodyä¼šå°† <code v-pre>req</code> MarshalæˆJSONæ ¼å¼çš„stringã€‚HTTPè¯·æ±‚ä¼šä»¥è¯¥å­—ç¬¦ä¸²ä½œä¸ºBodyå‚æ•°ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼ŒSignerï¼šç­¾å‘å¹¶æ·»åŠ è®¤è¯å¤´ã€‚</strong></p>
<p>è®¿é—®IAMçš„APIæ¥å£éœ€è¦è¿›è¡Œè®¤è¯ï¼Œæ‰€ä»¥åœ¨å‘é€HTTPè¯·æ±‚ä¹‹å‰ï¼Œè¿˜éœ€è¦ç»™HTTPè¯·æ±‚æ·»åŠ è®¤è¯Headerã€‚</p>
<p>medu-sdk-go ä»£ç æä¾›äº†JWTå’ŒHMACä¸¤ç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆé‡‡ç”¨äº†JWTè®¤è¯æ–¹å¼ã€‚JWTè®¤è¯ç­¾å‘æ–¹æ³•ä¸º<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/signer.go#L108-L113" target="_blank" rel="noopener noreferrer">Sign<ExternalLinkIcon/></a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>v1 SignatureV1<span class="token punctuation">)</span> <span class="token function">Sign</span><span class="token punctuation">(</span>serviceName <span class="token builtin">string</span><span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> body io<span class="token punctuation">.</span>ReadSeeker<span class="token punctuation">)</span> http<span class="token punctuation">.</span>Header <span class="token punctuation">{</span>
  tokenString <span class="token operator">:=</span> auth<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>Credentials<span class="token punctuation">.</span>SecretID<span class="token punctuation">,</span> v1<span class="token punctuation">.</span>Credentials<span class="token punctuation">.</span>SecretKey<span class="token punctuation">,</span> <span class="token string">"medu-sdk-go"</span><span class="token punctuation">,</span> serviceName<span class="token operator">+</span><span class="token string">".marmotedu.com"</span><span class="token punctuation">)</span>
  r<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"Bearer %s"</span><span class="token punctuation">,</span> tokenString<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> r<span class="token punctuation">.</span>Header

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>auth.Sign</code> æ–¹æ³•æ ¹æ®SecretIDå’ŒSecretKeyç­¾å‘JWT Tokenã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L95-L112" target="_blank" rel="noopener noreferrer">doSend<ExternalLinkIcon/></a>æ–¹æ³•æ¥æ‰§è¡ŒHTTPè¯·æ±‚äº†ã€‚è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>rawResponse<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">doSend</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> reqUrl<span class="token punctuation">,</span> body<span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">GetHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>                                                               
    <span class="token keyword">return</span> err     
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼ å…¥äº†HTTPè¯·æ±‚æ–¹æ³• <code v-pre>method</code> ã€HTTPè¯·æ±‚URL <code v-pre>reqUrl</code> ã€HTTPè¯·æ±‚Body <code v-pre>body</code>ï¼Œä»¥åŠç”¨æ¥ç­¾å‘JWT Tokençš„ <code v-pre>sign</code> æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨ <code v-pre>NewAuthzRequest</code> åˆ›å»º <code v-pre>req</code> æ—¶ï¼ŒæŒ‡å®šäº†HTTP Methodï¼Œæ‰€ä»¥è¿™é‡Œçš„ <code v-pre>method := req.GetMethod()</code> ã€reqUrlå’Œè¯·æ±‚Bodyéƒ½æ˜¯é€šè¿‡Builderæ¥æ„å»ºçš„ã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥ï¼ŒRequestï¼šæ‰§è¡Œ HTTPè¯·æ±‚ã€‚</strong></p>
<p>è°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L95-L112" target="_blank" rel="noopener noreferrer">doSend<ExternalLinkIcon/></a>æ–¹æ³•æ‰§è¡ŒHTTPè¯·æ±‚ï¼ŒdoSendé€šè¿‡è°ƒç”¨ <code v-pre>net/http</code> åŒ…æä¾›çš„ <code v-pre>http.NewRequest</code> æ–¹æ³•æ¥å‘é€HTTPè¯·æ±‚ï¼Œæ‰§è¡Œå®ŒHTTPè¯·æ±‚åï¼Œä¼šè¿”å› <code v-pre>*http.Response</code> ç±»å‹çš„Responseã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Client<span class="token punctuation">)</span> <span class="token function">doSend</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> data <span class="token builtin">string</span><span class="token punctuation">,</span> header <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> sign SignFunc<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Client<span class="token punctuation">{</span>Timeout<span class="token punctuation">:</span> c<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Timeout<span class="token punctuation">}</span>

    req<span class="token punctuation">,</span> err <span class="token operator">:=</span> http<span class="token punctuation">.</span><span class="token function">NewRequest</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        c<span class="token punctuation">.</span>Logger<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    c<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> header<span class="token punctuation">)</span>

    err <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> client<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¬¬å››æ­¥ï¼Œå¤„ç† HTTPè¯·æ±‚è¿”å›ç»“æœã€‚</strong></p>
<p>è°ƒç”¨doSendæ–¹æ³•è¿”å› <code v-pre>*http.Response</code> ç±»å‹çš„Responseåï¼ŒSendæ–¹æ³•ä¼šè°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/response/response.go#L37-L52" target="_blank" rel="noopener noreferrer">ParseFromHttpResponse<ExternalLinkIcon/></a>å‡½æ•°æ¥å¤„ç†HTTP Responseï¼ŒParseFromHttpResponseå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ParseFromHttpResponse</span><span class="token punctuation">(</span>rawResponse <span class="token operator">*</span>http<span class="token punctuation">.</span>Response<span class="token punctuation">,</span> response Response<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> rawResponse<span class="token punctuation">.</span>Body<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  body<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>rawResponse<span class="token punctuation">.</span>Body<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> rawResponse<span class="token punctuation">.</span>StatusCode <span class="token operator">!=</span> <span class="token number">200</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"request fail with status: %s, with body: %s"</span><span class="token punctuation">,</span> rawResponse<span class="token punctuation">.</span>Status<span class="token punctuation">,</span> body<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> response<span class="token punctuation">.</span><span class="token function">ParseErrorFromHTTPResponse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ParseFromHttpResponseå‡½æ•°ä¸­ï¼Œä¼šå…ˆåˆ¤æ–­HTTP Responseä¸­çš„StatusCodeæ˜¯å¦ä¸º200ï¼Œå¦‚æœä¸æ˜¯200ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœæ˜¯200ï¼Œä¼šè°ƒç”¨ä¼ å…¥çš„respå˜é‡æä¾›çš„<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/response/response.go#L26-L35" target="_blank" rel="noopener noreferrer">ParseErrorFromHTTPResponse<ExternalLinkIcon/></a>æ–¹æ³•ï¼Œæ¥å°†HTTP Responseçš„Body Unmarshalåˆ°respå˜é‡ä¸­ã€‚
é€šè¿‡ä»¥ä¸Šå››æ­¥ï¼ŒSDKè°ƒç”¨æ–¹è°ƒç”¨äº†APIï¼Œå¹¶è·å¾—äº†APIçš„è¿”å›ç»“æœ <code v-pre>resp</code> ã€‚</p>
<p>ä¸‹é¢è¿™äº›å…¬æœ‰äº‘å‚å•†çš„SDKé‡‡ç”¨äº†æ­¤è®¾è®¡æ¨¡å¼ï¼š</p>
<ul>
<li>è…¾è®¯äº‘SDKï¼š<a href="https://github.com/TencentCloud/tencentcloud-sdk-go" target="_blank" rel="noopener noreferrer">tencentcloud-sdk-go<ExternalLinkIcon/></a>ã€‚</li>
<li>AWS SDKï¼š<a href="https://github.com/aws/aws-sdk-go" target="_blank" rel="noopener noreferrer">aws-sdk-go<ExternalLinkIcon/></a>ã€‚</li>
<li>é˜¿é‡Œäº‘SDKï¼š<a href="https://github.com/aliyun/alibaba-cloud-sdk-go" target="_blank" rel="noopener noreferrer">alibaba-cloud-sdk-go<ExternalLinkIcon/></a>ã€‚</li>
<li>äº¬ä¸œäº‘SDKï¼š<a href="https://github.com/jdcloud-api/jdcloud-sdk-go" target="_blank" rel="noopener noreferrer">jdcloud-sdk-go<ExternalLinkIcon/></a>ã€‚</li>
<li>Ucloud SDKï¼š<a href="https://github.com/ucloud/ucloud-sdk-go" target="_blank" rel="noopener noreferrer">ucloud-sdk-go<ExternalLinkIcon/></a>ã€‚</li>
</ul>
<p>IAMå…¬æœ‰äº‘æ–¹å¼çš„SDKå®ç°ä¸º <a href="https://github.com/marmotedu/medu-sdk-go" target="_blank" rel="noopener noreferrer">medu-sdk-go<ExternalLinkIcon/></a>ã€‚</p>
<p>æ­¤å¤–ï¼ŒIAMè¿˜è®¾è®¡å¹¶å®ç°äº†Kubernetes client-goæ–¹å¼çš„Go SDKï¼š<a href="https://github.com/marmotedu/marmotedu-sdk-go" target="_blank" rel="noopener noreferrer">marmotedu-sdk-go<ExternalLinkIcon/></a>ï¼Œmarmotedu-sdk-goä¹Ÿæ˜¯IAM Go SDKæ‰€é‡‡ç”¨çš„SDKã€‚ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘ä¼šå…·ä½“ä»‹ç»marmotedu-sdk-goçš„è®¾è®¡å’Œå®ç°ã€‚</p>
<h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2>
<p>è¿™ä¸€è®²ï¼Œæˆ‘ä¸»è¦ä»‹ç»äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Go SDKã€‚é€šè¿‡æä¾›SDKï¼Œå¯ä»¥æé«˜APIè°ƒç”¨æ•ˆç‡ï¼Œå‡å°‘APIè°ƒç”¨éš¾åº¦ï¼Œæ‰€ä»¥å¤§å‹åº”ç”¨é€šå¸¸éƒ½ä¼šæä¾›SDKã€‚ä¸åŒå›¢é˜Ÿæœ‰ä¸åŒçš„SDKè®¾è®¡æ–¹æ³•ï¼Œä½†ç›®å‰æ¯”è¾ƒå¥½çš„å®ç°æ˜¯å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼ã€‚</p>
<p>å…¬æœ‰äº‘å‚å•†çš„SDKè®¾è®¡æ–¹å¼ä¸­ï¼ŒSDKæŒ‰è°ƒç”¨é¡ºåºä»ä¸Šåˆ°ä¸‹å¯ä»¥åˆ†ä¸º3ä¸ªæ¨¡å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://static001.geekbang.org/resource/image/b9/a9/b9bd3020ae56f6bb49bc3a38bcaf64a9.jpg?wh=1920x878" target="_blank" rel="noopener noreferrer"><img src="https://static001.geekbang.org/resource/image/b9/a9/b9bd3020ae56f6bb49bc3a38bcaf64a9.jpg?wh=1920x878" alt="å›¾ç‰‡"><ExternalLinkIcon/></a></p>
<p>Clientæ„é€ SDKå®¢æˆ·ç«¯ï¼Œåœ¨æ„é€ å®¢æˆ·ç«¯æ—¶ï¼Œä¼šåˆ›å»ºè¯·æ±‚å‚æ•° <code v-pre>req</code> ï¼Œ <code v-pre>req</code> ä¸­ä¼šæŒ‡å®šAPIç‰ˆæœ¬ã€HTTPè¯·æ±‚æ–¹æ³•ã€APIè¯·æ±‚è·¯å¾„ç­‰ä¿¡æ¯ã€‚</p>
<p>Clientä¼šè¯·æ±‚Builderå’ŒSigneræ¥æ„å»ºHTTPè¯·æ±‚çš„å„é¡¹å‚æ•°ï¼šHTTPè¯·æ±‚æ–¹æ³•ã€HTTPè¯·æ±‚è·¯å¾„ã€HTTPè®¤è¯å¤´ã€HTTPè¯·æ±‚Bodyã€‚Builderå’ŒSigneræ˜¯æ ¹æ® <code v-pre>req</code> é…ç½®æ¥æ„é€ è¿™äº›HTTPè¯·æ±‚å‚æ•°çš„ã€‚</p>
<p>æ„é€ å®Œæˆä¹‹åï¼Œä¼šè¯·æ±‚Requestæ¨¡å—ï¼ŒRequestæ¨¡å—é€šè¿‡è°ƒç”¨ <code v-pre>net/http</code> åŒ…ï¼Œæ¥æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œå¹¶è¿”å›è¯·æ±‚ç»“æœã€‚</p>
<h2 id="è¯¾åç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#è¯¾åç»ƒä¹ " aria-hidden="true">#</a> è¯¾åç»ƒä¹ </h2>
<ol>
<li>æ€è€ƒä¸‹ï¼Œå¦‚ä½•å®ç°å¯ä»¥æ”¯æŒå¤šä¸ªAPIç‰ˆæœ¬çš„SDKåŒ…ï¼Œä»£ç å¦‚ä½•å®ç°ï¼Ÿ</li>
<li>è¿™ä¸€è®²ä»‹ç»äº†ä¸€ç§SDKå®ç°æ–¹å¼ï¼Œåœ¨ä½ çš„Goå¼€å‘ç”Ÿæ¶¯ä¸­ï¼Œè¿˜æœ‰æ²¡æœ‰ä¸€äº›æ›´å¥½çš„SDKå®ç°æ–¹æ³•ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</li>
</ol>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '24.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '26.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/projects/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


