<template><div><ul>
<li><a href="https://github.com/cubxxw/iam" target="_blank" rel="noopener noreferrer">ğŸ”¥ å¼€æºåœ°å€<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬29èŠ‚-ä»£ç æµ‹è¯•-ä¸‹-go-è¯­è¨€å…¶ä»–æµ‹è¯•ç±»å‹åŠ-iam-æµ‹è¯•ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ç¬¬29èŠ‚-ä»£ç æµ‹è¯•-ä¸‹-go-è¯­è¨€å…¶ä»–æµ‹è¯•ç±»å‹åŠ-iam-æµ‹è¯•ä»‹ç»" aria-hidden="true">#</a> ç¬¬29èŠ‚ ä»£ç æµ‹è¯•ï¼ˆä¸‹ï¼‰ï¼šGo è¯­è¨€å…¶ä»–æµ‹è¯•ç±»å‹åŠ IAM æµ‹è¯•ä»‹ç»</h1>
<br>
<div><a href = '28.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '30.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<nav class="table-of-contents"><ul><li><router-link to="#ç¤ºä¾‹æµ‹è¯•">ç¤ºä¾‹æµ‹è¯•</router-link><ul><li><router-link to="#ç¤ºä¾‹æµ‹è¯•å‘½åè§„èŒƒ">ç¤ºä¾‹æµ‹è¯•å‘½åè§„èŒƒ</router-link></li><li><router-link to="#å¤§å‹ç¤ºä¾‹">å¤§å‹ç¤ºä¾‹</router-link></li></ul></li><li><router-link to="#testmainå‡½æ•°">TestMainå‡½æ•°</router-link></li><li><router-link to="#mockæµ‹è¯•">Mockæµ‹è¯•</router-link><ul><li><router-link to="#å®‰è£…gomock">å®‰è£…GoMock</router-link></li><li><router-link to="#mockgenå·¥å…·ä»‹ç»">mockgenå·¥å…·ä»‹ç»</router-link></li><li><router-link to="#é€šè¿‡æ³¨é‡Šä½¿ç”¨mockgen">é€šè¿‡æ³¨é‡Šä½¿ç”¨mockgen</router-link></li><li><router-link to="#ä½¿ç”¨mockä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹">ä½¿ç”¨Mockä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹</router-link></li></ul></li><li><router-link to="#fakeæµ‹è¯•">Fakeæµ‹è¯•</router-link></li><li><router-link to="#ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹">ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Ÿ</router-link><ul><li><router-link to="#ç¼–ç å‰-tdd">ç¼–ç å‰ï¼šTDD</router-link></li><li><router-link to="#ä¸ç¼–ç åŒæ­¥è¿›è¡Œ-å¢é‡">ä¸ç¼–ç åŒæ­¥è¿›è¡Œï¼šå¢é‡</router-link></li><li><router-link to="#ç¼–ç å-å­˜é‡">ç¼–ç åï¼šå­˜é‡</router-link></li></ul></li><li><router-link to="#æµ‹è¯•è¦†ç›–ç‡">æµ‹è¯•è¦†ç›–ç‡</router-link></li><li><router-link to="#iamé¡¹ç›®æµ‹è¯•å®æˆ˜">IAMé¡¹ç›®æµ‹è¯•å®æˆ˜</router-link><ul><li><router-link to="#iamé¡¹ç›®æ˜¯å¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„">IAMé¡¹ç›®æ˜¯å¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„ï¼Ÿ</router-link></li><li><router-link to="#iamé¡¹ç›®æµ‹è¯•æ¡ˆä¾‹åˆ†äº«">IAMé¡¹ç›®æµ‹è¯•æ¡ˆä¾‹åˆ†äº«</router-link></li></ul></li><li><router-link to="#å…¶ä»–æµ‹è¯•å·¥å…·-åŒ…">å…¶ä»–æµ‹è¯•å·¥å…·/åŒ…</router-link><ul><li><router-link to="#æµ‹è¯•æ¡†æ¶">æµ‹è¯•æ¡†æ¶</router-link></li><li><router-link to="#mockå·¥å…·">Mockå·¥å…·</router-link></li></ul></li><li><router-link to="#æ€»ç»“">æ€»ç»“</router-link></li><li><router-link to="#è¯¾åä¹ é¢˜">è¯¾åä¹ é¢˜</router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<p>[TOC]</p>
<p><a href="https://time.geekbang.org/column/article/408529" target="_blank" rel="noopener noreferrer">ä¸Šä¸€è®²<ExternalLinkIcon/></a>ï¼Œæˆ‘ä»‹ç»äº†Goä¸­çš„ä¸¤ç±»æµ‹è¯•ï¼šå•å…ƒæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚åœ¨Goä¸­ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æµ‹è¯•ç±»å‹å’Œæµ‹è¯•æ–¹æ³•ï¼Œå€¼å¾—æˆ‘ä»¬å»äº†è§£å’ŒæŒæ¡ã€‚æ­¤å¤–ï¼ŒIAMé¡¹ç›®ä¹Ÿç¼–å†™äº†å¤§é‡æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™äº›æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨äº†ä¸åŒçš„ç¼–å†™æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡å­¦ä¹ IAMçš„æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯ä½ å­¦åˆ°çš„æµ‹è¯•çŸ¥è¯†ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘å°±æ¥ä»‹ç»ä¸‹Go è¯­è¨€ä¸­çš„å…¶ä»–æµ‹è¯•ç±»å‹ï¼šç¤ºä¾‹æµ‹è¯•ã€TestMainå‡½æ•°ã€Mockæµ‹è¯•ã€Fakeæµ‹è¯•ç­‰ï¼Œå¹¶ä¸”ä»‹ç»ä¸‹IAMé¡¹ç›®æ˜¯å¦‚ä½•ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„ã€‚</p>
<h2 id="ç¤ºä¾‹æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹æµ‹è¯•" aria-hidden="true">#</a> ç¤ºä¾‹æµ‹è¯•</h2>
<p>ç¤ºä¾‹æµ‹è¯•ä»¥<code v-pre>Example</code>å¼€å¤´ï¼Œæ²¡æœ‰è¾“å…¥å’Œè¿”å›å‚æ•°ï¼Œé€šå¸¸ä¿å­˜åœ¨<code v-pre>example_test.go</code>æ–‡ä»¶ä¸­ã€‚ç¤ºä¾‹æµ‹è¯•å¯èƒ½åŒ…å«ä»¥<code v-pre>Output:</code>æˆ–è€…<code v-pre>Unordered output:</code>å¼€å¤´çš„æ³¨é‡Šï¼Œè¿™äº›æ³¨é‡Šæ”¾åœ¨å‡½æ•°çš„ç»“å°¾éƒ¨åˆ†ã€‚<code v-pre>Unordered output:</code>å¼€å¤´çš„æ³¨é‡Šä¼šå¿½ç•¥è¾“å‡ºè¡Œçš„é¡ºåºã€‚</p>
<p>æ‰§è¡Œ<code v-pre>go test</code>å‘½ä»¤æ—¶ï¼Œä¼šæ‰§è¡Œè¿™äº›ç¤ºä¾‹æµ‹è¯•ï¼Œå¹¶ä¸”go testä¼šå°†ç¤ºä¾‹æµ‹è¯•è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºçš„å†…å®¹ï¼Œè·Ÿæ³¨é‡Šä½œå¯¹æ¯”ï¼ˆæ¯”è¾ƒæ—¶å°†å¿½ç•¥è¡Œå‰åçš„ç©ºæ ¼ï¼‰ã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™ç¤ºä¾‹æµ‹è¯•é€šè¿‡æµ‹è¯•ï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ç¤ºä¾‹æµ‹è¯•ä¸é€šè¿‡æµ‹è¯•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹æµ‹è¯•ï¼ˆä½äºexample_test.goæ–‡ä»¶ä¸­ï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ExampleMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// Output:</span>
    <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œgo testå‘½ä»¤ï¼Œæµ‹è¯•<code v-pre>ExampleMax</code>ç¤ºä¾‹æµ‹è¯•ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-run</span><span class="token operator">=</span><span class="token string">'Example.*'</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   ExampleMax
--- PASS: ExampleMax <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span>
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    <span class="token number">0</span>.004s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°<code v-pre>ExampleMax</code>æµ‹è¯•é€šè¿‡ã€‚è¿™é‡Œæµ‹è¯•é€šè¿‡æ˜¯å› ä¸º<code v-pre>fmt.Println(Max(1, 2))</code>å‘æ ‡å‡†è¾“å‡ºè¾“å‡ºäº†<code v-pre>2</code>ï¼Œè·Ÿ<code v-pre>// Output:</code>åé¢çš„<code v-pre>2</code>ä¸€è‡´ã€‚</p>
<p>å½“ç¤ºä¾‹æµ‹è¯•ä¸åŒ…å«<code v-pre>Output:</code>æˆ–è€…<code v-pre>Unordered output:</code>æ³¨é‡Šæ—¶ï¼Œæ‰§è¡Œ<code v-pre>go test</code>åªä¼šç¼–è¯‘è¿™äº›å‡½æ•°ï¼Œä½†ä¸ä¼šæ‰§è¡Œè¿™äº›å‡½æ•°ã€‚</p>
<h3 id="ç¤ºä¾‹æµ‹è¯•å‘½åè§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹æµ‹è¯•å‘½åè§„èŒƒ" aria-hidden="true">#</a> ç¤ºä¾‹æµ‹è¯•å‘½åè§„èŒƒ</h3>
<p>ç¤ºä¾‹æµ‹è¯•éœ€è¦éµå¾ªä¸€äº›å‘½åè§„èŒƒï¼Œå› ä¸ºåªæœ‰è¿™æ ·ï¼ŒGodocæ‰èƒ½å°†ç¤ºä¾‹æµ‹è¯•å’ŒåŒ…çº§åˆ«çš„æ ‡è¯†ç¬¦è¿›è¡Œå…³è”ã€‚ä¾‹å¦‚ï¼Œæœ‰ä»¥ä¸‹ç¤ºä¾‹æµ‹è¯•ï¼ˆä½äºexample_test.goæ–‡ä»¶ä¸­ï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> stringutil_test

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>

    <span class="token string">"github.com/golang/example/stringutil"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">ExampleReverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>stringutil<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// Output: olleh</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Godocå°†åœ¨<code v-pre>Reverse</code>å‡½æ•°çš„æ–‡æ¡£æ—è¾¹æä¾›æ­¤ç¤ºä¾‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://sm.nsddd.top/sm202303051046879.png" alt="å›¾ç‰‡"></p>
<p>ç¤ºä¾‹æµ‹è¯•åä»¥<code v-pre>Example</code>å¼€å¤´ï¼Œåé¢å¯ä»¥ä¸è·Ÿä»»ä½•å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è·Ÿå‡½æ•°åã€ç±»å‹åæˆ–è€…<code v-pre>ç±»å‹_æ–¹æ³•å</code>ï¼Œä¸­é—´ç”¨ä¸‹åˆ’çº¿<code v-pre>_</code>è¿æ¥ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token comment">// ä»£è¡¨äº†æ•´ä¸ªåŒ…çš„ç¤ºä¾‹</span>
<span class="token keyword">func</span> <span class="token function">ExampleF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token comment">// å‡½æ•°Fçš„ç¤ºä¾‹</span>
<span class="token keyword">func</span> <span class="token function">ExampleT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token comment">// ç±»å‹Tçš„ç¤ºä¾‹</span>
<span class="token keyword">func</span> <span class="token function">ExampleT_M</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token comment">// æ–¹æ³•T_Mçš„ç¤ºä¾‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æŸä¸ªå‡½æ•°/ç±»å‹/æ–¹æ³•æœ‰å¤šä¸ªç¤ºä¾‹æµ‹è¯•æ—¶ï¼Œå¯ä»¥é€šè¿‡åç¼€æ¥åŒºåˆ†ï¼Œåç¼€å¿…é¡»ä»¥å°å†™å­—æ¯å¼€å¤´ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>func ExampleReverse()
func ExampleReverse_second()
func ExampleReverse_third()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤§å‹ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å¤§å‹ç¤ºä¾‹" aria-hidden="true">#</a> å¤§å‹ç¤ºä¾‹</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå¤§å‹çš„ç¤ºä¾‹æµ‹è¯•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªæ•´æ–‡ä»¶çš„ç¤ºä¾‹ï¼ˆwhole file exampleï¼‰ï¼Œå®ƒæœ‰è¿™å‡ ä¸ªç‰¹ç‚¹ï¼šæ–‡ä»¶åä»¥<code v-pre>_test.go</code>ç»“å°¾ï¼›åªåŒ…å«ä¸€ä¸ªç¤ºä¾‹æµ‹è¯•ï¼Œæ–‡ä»¶ä¸­æ²¡æœ‰å•å…ƒæµ‹è¯•å‡½æ•°å’Œæ€§èƒ½æµ‹è¯•å‡½æ•°ï¼›è‡³å°‘åŒ…å«ä¸€ä¸ªåŒ…çº§åˆ«çš„å£°æ˜ï¼›å½“å±•ç¤ºè¿™ç±»ç¤ºä¾‹æµ‹è¯•æ—¶ï¼Œgodocä¼šç›´æ¥å±•ç¤ºæ•´ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> sort_test

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"sort"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Name <span class="token builtin">string</span>
    Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>p Person<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s: %d"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ByAge implements sort.Interface for []Person based on</span>
<span class="token comment">// the Age field.</span>
<span class="token keyword">type</span> ByAge <span class="token punctuation">[</span><span class="token punctuation">]</span>Person

<span class="token keyword">func</span> <span class="token punctuation">(</span>a ByAge<span class="token punctuation">)</span> <span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span>           <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a ByAge<span class="token punctuation">)</span> <span class="token function">Swap</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>a ByAge<span class="token punctuation">)</span> <span class="token function">Less</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Age <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Age <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    people <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Person<span class="token punctuation">{</span>
        <span class="token punctuation">{</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"Michael"</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span><span class="token string">"Jenny"</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span>
    sort<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token function">ByAge</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span>

    <span class="token comment">// Output:</span>
    <span class="token comment">// [Bob: 31 John: 42 Michael: 17 Jenny: 26]</span>
    <span class="token comment">// [Michael: 17 Jenny: 26 Bob: 31 John: 42]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ªåŒ…å¯ä»¥åŒ…å«å¤šä¸ªwhole file exampleï¼Œä¸€ä¸ªç¤ºä¾‹ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚<code v-pre>example_interface_test.go</code>ã€<code v-pre>example_keys_test.go</code>ã€<code v-pre>example_search_test.go</code>ç­‰ã€‚</p>
<h2 id="testmainå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#testmainå‡½æ•°" aria-hidden="true">#</a> TestMainå‡½æ•°</h2>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨åšæµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šåœ¨æµ‹è¯•ä¹‹å‰åšäº›å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚åˆ›å»ºæ•°æ®åº“è¿æ¥ç­‰ï¼›åœ¨æµ‹è¯•ä¹‹ååšäº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚å…³é—­æ•°æ®åº“è¿æ¥ã€æ¸…ç†æµ‹è¯•æ–‡ä»¶ç­‰ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code v-pre>\*test.go\*</code>æ–‡ä»¶ä¸­æ·»åŠ <code v-pre>TestMain</code>å‡½æ•°ï¼Œå…¶å…¥å‚ä¸º<code v-pre>\*testing.M</code>ã€‚**</p>
<p><code v-pre>TestMain</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ï¼ˆç›¸å½“äºmainå‡½æ•°ï¼‰ï¼Œæµ‹è¯•ç”¨ä¾‹åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆæ‰§è¡Œ<code v-pre>TestMain</code>å‡½æ•°ï¼Œç„¶åå¯ä»¥åœ¨<code v-pre>TestMain</code>ä¸­è°ƒç”¨<code v-pre>m.Run()</code>å‡½æ•°æ‰§è¡Œæ™®é€šçš„æµ‹è¯•å‡½æ•°ã€‚åœ¨<code v-pre>m.Run()</code>å‡½æ•°å‰é¢æˆ‘ä»¬å¯ä»¥ç¼–å†™å‡†å¤‡é€»è¾‘ï¼Œåœ¨<code v-pre>m.Run()</code>åé¢æˆ‘ä»¬å¯ä»¥ç¼–å†™æ¸…ç†é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬åœ¨ç¤ºä¾‹æµ‹è¯•æ–‡ä»¶<a href="https://github.com/marmotedu/gopractise-demo/blob/master/test/math_test.go" target="_blank" rel="noopener noreferrer">math_test.go<ExternalLinkIcon/></a>ä¸­æ·»åŠ å¦‚ä¸‹TestMainå‡½æ•°ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"do some setup"</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"do some cleanup"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰§è¡Œgo testï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</strong></p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>$ <span class="token keyword">go</span> test <span class="token operator">-</span>v
do some setup
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestAbs
<span class="token operator">--</span><span class="token operator">-</span> PASS<span class="token punctuation">:</span> TestAbs <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
<span class="token operator">...</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   ExampleMax
<span class="token operator">--</span><span class="token operator">-</span> PASS<span class="token punctuation">:</span> ExampleMax <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
PASS
do some cleanup
ok    github<span class="token punctuation">.</span>com<span class="token operator">/</span>marmotedu<span class="token operator">/</span>gopractise<span class="token operator">-</span>demo<span class="token operator">/</span><span class="token number">31</span><span class="token operator">/</span>test  <span class="token number">0</span><span class="token punctuation">.</span>006s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ä¹‹å‰ï¼Œæ‰“å°äº†<code v-pre>do some setup</code>ï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹è¿è¡Œå®Œæˆä¹‹åï¼Œæ‰“å°äº†<code v-pre>do some cleanup</code>ã€‚</p>
<p>IAMé¡¹ç›®çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œä½¿ç”¨TestMainå‡½æ•°åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹å‰è¿æ¥äº†ä¸€ä¸ªfakeæ•°æ®åº“ï¼Œä»£ç å¦‚ä¸‹ï¼ˆä½äº<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/user_test.go" target="_blank" rel="noopener noreferrer">internal/apiserver/service/v1/user_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ä¸­ï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fakeStore<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> fake<span class="token punctuation">.</span><span class="token function">NewFakeStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">SetClient</span><span class="token punctuation">(</span>fakeStore<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å•å…ƒæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€ç¤ºä¾‹æµ‹è¯•ã€TestMainå‡½æ•°æ˜¯go testæ”¯æŒçš„æµ‹è¯•ç±»å‹ã€‚æ­¤å¤–ï¼Œä¸ºäº†æµ‹è¯•åœ¨å‡½æ•°å†…ä½¿ç”¨äº†Go Interfaceçš„å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜å»¶ä¼¸å‡ºäº†Mockæµ‹è¯•å’ŒFakeæµ‹è¯•ä¸¤ç§æµ‹è¯•ç±»å‹ã€‚</p>
<h2 id="mockæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#mockæµ‹è¯•" aria-hidden="true">#</a> Mockæµ‹è¯•</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå•å…ƒæµ‹è¯•ä¸­æ˜¯ä¸å…è®¸æœ‰å¤–éƒ¨ä¾èµ–çš„ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›å¤–éƒ¨ä¾èµ–éƒ½éœ€è¦è¢«æ¨¡æ‹Ÿã€‚åœ¨Goä¸­ï¼Œä¸€èˆ¬ä¼šå€ŸåŠ©å„ç±»Mockå·¥å…·æ¥æ¨¡æ‹Ÿä¸€äº›ä¾èµ–ã€‚</p>
<p>GoMockæ˜¯ç”±Golangå®˜æ–¹å¼€å‘ç»´æŠ¤çš„æµ‹è¯•æ¡†æ¶ï¼Œå®ç°äº†è¾ƒä¸ºå®Œæ•´çš„åŸºäºinterfaceçš„MockåŠŸèƒ½ï¼Œèƒ½å¤Ÿä¸Golangå†…ç½®çš„testingåŒ…è‰¯å¥½é›†æˆï¼Œä¹Ÿèƒ½ç”¨äºå…¶ä»–çš„æµ‹è¯•ç¯å¢ƒä¸­ã€‚GoMockæµ‹è¯•æ¡†æ¶åŒ…å«äº†GoMockåŒ…å’Œmockgenå·¥å…·ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­GoMockåŒ…ç”¨æ¥å®Œæˆå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†ï¼Œmockgenå·¥å…·ç”¨æ¥ç”Ÿæˆinterfaceå¯¹åº”çš„Mockç±»æºæ–‡ä»¶ã€‚ä¸‹é¢ï¼Œæˆ‘æ¥åˆ†åˆ«è¯¦ç»†ä»‹ç»ä¸‹GoMockåŒ…å’Œmockgenå·¥å…·ï¼Œä»¥åŠå®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<h3 id="å®‰è£…gomock" tabindex="-1"><a class="header-anchor" href="#å®‰è£…gomock" aria-hidden="true">#</a> <strong>å®‰è£…GoMock</strong></h3>
<p><strong>è¦ä½¿ç”¨GoMockï¼Œé¦–å…ˆéœ€è¦å®‰è£…GoMockåŒ…å’Œmockgenå·¥å…·ï¼Œå®‰è£…æ–¹æ³•å¦‚ä¸‹:</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go get github.com/golang/mock/gomock
$ go <span class="token function">install</span> github.com/golang/mock/mockgen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢ï¼Œæˆ‘é€šè¿‡ä¸€ä¸ªè·å–å½“å‰Golangæœ€æ–°ç‰ˆæœ¬çš„ä¾‹å­ï¼Œæ¥ç»™ä½ æ¼”ç¤ºä¸‹å¦‚ä½•ä½¿ç”¨GoMockã€‚ç¤ºä¾‹ä»£ç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆç›®å½•ä¸‹çš„ä»£ç è§<a href="https://github.com/marmotedu/gopractise-demo/tree/master/gomock" target="_blank" rel="noopener noreferrer">gomock<ExternalLinkIcon/></a>ï¼‰ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>tree .
.
â”œâ”€â”€ go_version.go
â”œâ”€â”€ main.go
â””â”€â”€ spider
    â””â”€â”€ spider.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>spider.go</code>æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª<code v-pre>Spider</code>æ¥å£ï¼Œ<code v-pre>spider.go</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> spider

<span class="token keyword">type</span> Spider <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>Spider</code>æ¥å£ä¸­çš„GetBodyæ–¹æ³•å¯ä»¥æŠ“å–<code v-pre>https://golang.org</code>é¦–é¡µçš„<code v-pre>Build version</code>å­—æ®µï¼Œæ¥è·å–Golangçš„æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬åœ¨<code v-pre>go_version.go</code>æ–‡ä»¶ä¸­ï¼Œè°ƒç”¨<code v-pre>Spider</code>æ¥å£çš„<code v-pre>GetBody</code>æ–¹æ³•ï¼Œ<code v-pre>go_version.go</code>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> gomock

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"github.com/marmotedu/gopractise-demo/gomock/spider"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">GetGoVersion</span><span class="token punctuation">(</span>s spider<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    body <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> body
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>GetGoVersion</code>å‡½æ•°ç›´æ¥è¿”å›è¡¨ç¤ºç‰ˆæœ¬çš„å­—ç¬¦ä¸²ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šå†™å‡ºå¦‚ä¸‹çš„å•å…ƒæµ‹è¯•ä»£ç ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestGetGoVersion</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v <span class="token operator">:=</span> <span class="token function">GetGoVersion</span><span class="token punctuation">(</span>spider<span class="token punctuation">.</span><span class="token function">CreateGoVersionSpider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> v <span class="token operator">!=</span> <span class="token string">"go1.8.3"</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">"Get wrong version %s"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„æµ‹è¯•ä»£ç ï¼Œä¾èµ–<code v-pre>spider.CreateGoVersionSpider()</code>è¿”å›ä¸€ä¸ªå®ç°äº†<code v-pre>Spider</code>æ¥å£çš„å®ä¾‹ï¼ˆçˆ¬è™«ï¼‰ã€‚ä½†å¾ˆå¤šæ—¶å€™ï¼Œ<code v-pre>spider.CreateGoVersionSpider()</code>çˆ¬è™«å¯èƒ½è¿˜æ²¡æœ‰å®ç°ï¼Œæˆ–è€…åœ¨å•å…ƒæµ‹è¯•ç¯å¢ƒä¸‹ä¸èƒ½è¿è¡Œï¼ˆæ¯”å¦‚ï¼Œåœ¨å•å…ƒæµ‹è¯•ç¯å¢ƒä¸­è¿æ¥æ•°æ®åº“ï¼‰ï¼Œè¿™æ—¶å€™<code v-pre>TestGetGoVersion</code>æµ‹è¯•ç”¨ä¾‹å°±æ— æ³•æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•æ‰èƒ½åœ¨è¿™ç§æƒ…å†µä¸‹è¿è¡Œ<code v-pre>TestGetGoVersion</code>æµ‹è¯•ç”¨ä¾‹å‘¢ï¼Ÿè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡Mockå·¥å…·ï¼ŒMockä¸€ä¸ªçˆ¬è™«å®ä¾‹ã€‚æ¥ä¸‹æ¥æˆ‘è®²è®²å…·ä½“æ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œç”¨ GoMock æä¾›çš„mockgenå·¥å…·ï¼Œç”Ÿæˆè¦ Mock çš„æ¥å£çš„å®ç°ï¼Œæˆ‘ä»¬åœ¨gomockç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ mockgen <span class="token parameter variable">-destination</span> spider/mock/mock_spider.go <span class="token parameter variable">-package</span> spider github.com/marmotedu/gopractise-demo/gomock/spider Spider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤ä¼šåœ¨<code v-pre>spider/mock</code>ç›®å½•ä¸‹ç”Ÿæˆ<code v-pre>mock_spider.go</code>æ–‡ä»¶ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ tree <span class="token builtin class-name">.</span>
<span class="token builtin class-name">.</span>
â”œâ”€â”€ go_version.go
â”œâ”€â”€ go_version_test.go
â”œâ”€â”€ go_version_test_traditional_method.go~
â””â”€â”€ spider
    â”œâ”€â”€ mock
    â”‚   â””â”€â”€ mock_spider.go
    â””â”€â”€ spider.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>mock_spider.go</code>æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†ä¸€äº›å‡½æ•°/æ–¹æ³•ï¼Œå¯ä»¥æ”¯æŒæˆ‘ä»¬ç¼–å†™<code v-pre>TestGetGoVersion</code>æµ‹è¯•å‡½æ•°ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼ˆè§<a href="https://github.com/marmotedu/gopractise-demo/blob/master/gomock/go_version_test.go" target="_blank" rel="noopener noreferrer">go_version_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> gomock

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"testing"</span>

  <span class="token string">"github.com/golang/mock/gomock"</span>

  spider <span class="token string">"github.com/marmotedu/gopractise-demo/gomock/spider/mock"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">TestGetGoVersion</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctrl <span class="token operator">:=</span> gomock<span class="token punctuation">.</span><span class="token function">NewController</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
  <span class="token keyword">defer</span> ctrl<span class="token punctuation">.</span><span class="token function">Finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  mockSpider <span class="token operator">:=</span> spider<span class="token punctuation">.</span><span class="token function">NewMockSpider</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">)</span>
  mockSpider<span class="token punctuation">.</span><span class="token function">EXPECT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token string">"go1.8.3"</span><span class="token punctuation">)</span>
  goVer <span class="token operator">:=</span> <span class="token function">GetGoVersion</span><span class="token punctuation">(</span>mockSpider<span class="token punctuation">)</span>

  <span class="token keyword">if</span> goVer <span class="token operator">!=</span> <span class="token string">"go1.8.3"</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"Get wrong version %s"</span><span class="token punctuation">,</span> goVer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€ç‰ˆæœ¬çš„<code v-pre>TestGetGoVersion</code>é€šè¿‡GoMockï¼Œ Mockäº†ä¸€ä¸ª<code v-pre>Spider</code>æ¥å£ï¼Œè€Œä¸ç”¨å»å®ç°ä¸€ä¸ª<code v-pre>Spider</code>æ¥å£ã€‚è¿™å°±å¤§å¤§é™ä½äº†å•å…ƒæµ‹è¯•ç”¨ä¾‹ç¼–å†™çš„å¤æ‚åº¦ã€‚é€šè¿‡Mockï¼Œå¾ˆå¤šä¸èƒ½æµ‹è¯•çš„å‡½æ•°ä¹Ÿå˜å¾—å¯æµ‹è¯•äº†ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒGoMock å’Œ<a href="https://time.geekbang.org/column/article/408529" target="_blank" rel="noopener noreferrer">ä¸Šä¸€è®²<ExternalLinkIcon/></a>ä»‹ç»çš„testingå•å…ƒæµ‹è¯•æ¡†æ¶å¯ä»¥ç´§å¯†åœ°ç»“åˆèµ·æ¥å·¥ä½œã€‚</p>
<h3 id="mockgenå·¥å…·ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#mockgenå·¥å…·ä»‹ç»" aria-hidden="true">#</a> mockgenå·¥å…·ä»‹ç»</h3>
<p>ä¸Šé¢ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ GoMock ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†<code v-pre>mockgen</code>å·¥å…·æ¥ç”Ÿæˆ Mockä»£ç ï¼Œ<code v-pre>mockgen</code>å·¥å…·æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œè¿™é‡Œæˆ‘æ¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚</p>
<p><code v-pre>mockgen</code>å·¥å…·æ˜¯ GoMock æä¾›çš„ï¼Œç”¨æ¥Mockä¸€ä¸ªGoæ¥å£ã€‚å®ƒå¯ä»¥æ ¹æ®ç»™å®šçš„æ¥å£ï¼Œæ¥è‡ªåŠ¨ç”ŸæˆMockä»£ç ã€‚è¿™é‡Œï¼Œæœ‰ä¸¤ç§æ¨¡å¼å¯ä»¥ç”ŸæˆMockä»£ç ï¼Œåˆ†åˆ«æ˜¯æºç æ¨¡å¼å’Œåå°„æ¨¡å¼ã€‚</p>
<ol>
<li><strong>æºç æ¨¡å¼</strong></li>
</ol>
<p><strong>å¦‚æœæœ‰æ¥å£æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ç”ŸæˆMockä»£ç ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ mockgen <span class="token parameter variable">-destination</span> spider/mock/mock_spider.go <span class="token parameter variable">-package</span> spider <span class="token parameter variable">-source</span> spider/spider.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤ï¼ŒMockäº†<code v-pre>spider/spider.go</code>æ–‡ä»¶ä¸­å®šä¹‰çš„<code v-pre>Spider</code>æ¥å£ï¼Œå¹¶å°†Mockä»£ç ä¿å­˜åœ¨<code v-pre>spider/mock/mock_spider.go</code>æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶çš„åŒ…åä¸º<code v-pre>spider</code>ã€‚</p>
<p><strong>mockgenå·¥å…·çš„å‚æ•°è¯´æ˜è§ä¸‹è¡¨ï¼š</strong></p>
<p><img src="http://sm.nsddd.top/sm202303051051183.jpeg" alt="å›¾ç‰‡"></p>
<ol>
<li><strong>åå°„æ¨¡å¼</strong></li>
</ol>
<p>æ­¤å¤–ï¼Œmockgenå·¥å…·è¿˜æ”¯æŒé€šè¿‡ä½¿ç”¨åå°„ç¨‹åºæ¥ç”Ÿæˆ Mock ä»£ç ã€‚å®ƒé€šè¿‡ä¼ é€’ä¸¤ä¸ªéæ ‡å¿—å‚æ•°ï¼Œå³å¯¼å…¥è·¯å¾„å’Œé€—å·åˆ†éš”çš„æ¥å£åˆ—è¡¨æ¥å¯ç”¨ï¼Œå…¶ä»–å‚æ•°å’Œæºç æ¨¡å¼å…±ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ mockgen <span class="token parameter variable">-destination</span> spider/mock/mock_spider.go <span class="token parameter variable">-package</span> spider github.com/marmotedu/gopractise-demo/gomock/spider Spider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="é€šè¿‡æ³¨é‡Šä½¿ç”¨mockgen" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡æ³¨é‡Šä½¿ç”¨mockgen" aria-hidden="true">#</a> é€šè¿‡æ³¨é‡Šä½¿ç”¨mockgen</h3>
<p>å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”åˆ†æ•£åœ¨ä¸åŒçš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ç”ŸæˆMockæ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å¯¹æ¯ä¸ªæ–‡ä»¶æ‰§è¡Œå¤šæ¬¡mockgenå‘½ä»¤ï¼ˆè¿™é‡Œå‡è®¾åŒ…åä¸ç›¸åŒï¼‰ã€‚è¿™ç§æ“ä½œè¿˜æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œmockgenè¿˜æä¾›äº†ä¸€ç§é€šè¿‡æ³¨é‡Šç”ŸæˆMockæ–‡ä»¶çš„æ–¹å¼ï¼Œæ­¤æ—¶éœ€è¦å€ŸåŠ©<code v-pre>go generate</code>å·¥å…·ã€‚</p>
<p>åœ¨æ¥å£æ–‡ä»¶çš„ä»£ç ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹æ³¨é‡Šï¼ˆå…·ä½“ä»£ç è§<a href="https://github.com/marmotedu/gopractise-demo/blob/master/gomock/spider/spider.go#L3" target="_blank" rel="noopener noreferrer">spider.go<ExternalLinkIcon/></a>æ–‡ä»¶ï¼‰ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>//go:generate mockgen -destination mock_spider.go -package spider github.com/cz-it/blog/blog/Go/testing/gomock/example/spider Spider
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨<code v-pre>gomock</code>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±å¯ä»¥è‡ªåŠ¨ç”ŸæˆMockä»£ç ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>$ go generate ./...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨mockä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨mockä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹" aria-hidden="true">#</a> ä½¿ç”¨Mockä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ç”¨ä¾‹</h3>
<p>ç”Ÿæˆäº†Mockä»£ç ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å®ƒä»¬äº†ã€‚è¿™é‡Œæˆ‘ä»¬ç»“åˆ<code v-pre>testing</code>æ¥ç¼–å†™ä¸€ä¸ªä½¿ç”¨äº†Mockä»£ç çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦åœ¨å•å…ƒæµ‹è¯•ä»£ç é‡Œåˆ›å»ºä¸€ä¸ªMockæ§åˆ¶å™¨ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>ctrl <span class="token operator">:=</span> gomock<span class="token punctuation">.</span><span class="token function">NewController</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å°†<code v-pre>\*testing.T</code>ä¼ é€’ç»™GoMock ï¼Œç”Ÿæˆä¸€ä¸ª<code v-pre>Controller</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ§åˆ¶äº†æ•´ä¸ªMockçš„è¿‡ç¨‹ã€‚åœ¨æ“ä½œå®Œåï¼Œè¿˜éœ€è¦è¿›è¡Œå›æ”¶ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šåœ¨<code v-pre>NewController</code>åé¢deferä¸€ä¸ªFinishï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>defer ctrl.Finish()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç„¶åï¼Œå°±å¯ä»¥è°ƒç”¨Mockçš„å¯¹è±¡äº†ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>mockSpider <span class="token operator">:=</span> spider<span class="token punctuation">.</span><span class="token function">NewMockSpider</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™é‡Œçš„<code v-pre>spider</code>æ˜¯mockgenå‘½ä»¤é‡Œé¢ä¼ é€’çš„åŒ…åï¼Œåé¢æ˜¯<code v-pre>NewMockXxxx</code>æ ¼å¼çš„å¯¹è±¡åˆ›å»ºå‡½æ•°ï¼Œ<code v-pre>Xxx</code>æ˜¯æ¥å£åã€‚è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’æ§åˆ¶å™¨å¯¹è±¡è¿›å»ï¼Œè¿”å›ä¸€ä¸ªMockå®ä¾‹ã€‚</p>
<p>æ¥ç€ï¼Œæœ‰äº†Mockå®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨å…¶æ–­è¨€æ–¹æ³•<code v-pre>EXPECT()</code>äº†ã€‚</p>
<p>gomocké‡‡ç”¨äº†é“¾å¼è°ƒç”¨æ³•ï¼Œé€šè¿‡<code v-pre>.</code>è¿æ¥å‡½æ•°è°ƒç”¨ï¼Œå¯ä»¥åƒé“¾æ¡ä¸€æ ·è¿æ¥ä¸‹å»ã€‚ä¾‹å¦‚ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mockSpider.EXPECT().GetBody().Return("go1.8.3")
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Mockä¸€ä¸ªæ¥å£çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦Mockè¯¥æ–¹æ³•çš„å…¥å‚å’Œè¿”å›å€¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‚æ•°åŒ¹é…æ¥Mockå…¥å‚ï¼Œé€šè¿‡Mockå®ä¾‹çš„ <code v-pre>Return</code> æ–¹æ³•æ¥Mockè¿”å›å€¼ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥åˆ†åˆ«çœ‹ä¸‹å¦‚ä½•æŒ‡å®šå…¥å‚å’Œè¿”å›å€¼ã€‚</p>
<p>å…ˆæ¥çœ‹å¦‚ä½•æŒ‡å®šå…¥å‚ã€‚å¦‚æœå‡½æ•°æœ‰å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°åŒ¹é…æ¥æŒ‡ä»£å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>mockSpider<span class="token punctuation">.</span><span class="token function">EXPECT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span>gomock<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gomock<span class="token punctuation">.</span><span class="token function">Eq</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token string">"go1.8.3"</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>gomockæ”¯æŒä»¥ä¸‹å‚æ•°åŒ¹é…ï¼š</p>
<ul>
<li>gomock.Any()ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºä»»æ„çš„å…¥å‚ã€‚</li>
<li>gomock.Eq(value)ï¼Œç”¨æ¥è¡¨ç¤ºä¸ value ç­‰ä»·çš„å€¼ã€‚</li>
<li>gomock.Not(value)ï¼Œç”¨æ¥è¡¨ç¤ºé value ä»¥å¤–çš„å€¼ã€‚</li>
<li>gomock.Nil()ï¼Œç”¨æ¥è¡¨ç¤º None å€¼ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹å¦‚ä½•æŒ‡å®šè¿”å›å€¼ã€‚</p>
<p><code v-pre>EXPECT()</code>å¾—åˆ°Mockçš„å®ä¾‹ï¼Œç„¶åè°ƒç”¨Mockå®ä¾‹çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ç¬¬ä¸€ä¸ª<code v-pre>Call</code>å¯¹è±¡ï¼Œç„¶åå¯ä»¥å¯¹å…¶è¿›è¡Œæ¡ä»¶çº¦æŸï¼Œæ¯”å¦‚ä½¿ç”¨Mockå®ä¾‹çš„ <code v-pre>Return</code> æ–¹æ³•çº¦æŸå…¶è¿”å›å€¼ã€‚<code v-pre>Call</code>å¯¹è±¡è¿˜æä¾›äº†ä»¥ä¸‹æ–¹æ³•æ¥çº¦æŸMockå®ä¾‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token comment">// Afterå£°æ˜è°ƒç”¨åœ¨preReqå®Œæˆåæ‰§è¡Œ</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">After</span><span class="token punctuation">(</span>preReq <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token operator">*</span>Call l 
<span class="token comment">// å…è®¸è°ƒç”¨æ¬¡æ•°ä¸º 0 æ¬¡æˆ–æ›´å¤šæ¬¡</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">AnyTimes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Cal
<span class="token comment">// å£°æ˜åœ¨åŒ¹é…æ—¶è¦è¿è¡Œçš„æ“ä½œ</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">Do</span><span class="token punctuation">(</span>f <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call 
<span class="token comment">// è®¾ç½®æœ€å¤§çš„è°ƒç”¨æ¬¡æ•°ä¸º n æ¬¡</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">MaxTimes</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call 
<span class="token comment">// è®¾ç½®æœ€å°çš„è°ƒç”¨æ¬¡æ•°ä¸º n æ¬¡</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">MinTimes</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call 
<span class="token comment">// å£°æ˜æ¨¡æ‹Ÿå‡½æ•°è°ƒç”¨è¿”å›çš„å€¼</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">Return</span><span class="token punctuation">(</span>rets <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call
<span class="token comment">// å£°æ˜ä½¿ç”¨æŒ‡é’ˆè®¾ç½®ç¬¬ n ä¸ªå‚æ•°çš„å€¼</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">SetArg</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call 
<span class="token comment">// è®¾ç½®è°ƒç”¨æ¬¡æ•°ä¸º n æ¬¡</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>Call<span class="token punctuation">)</span> <span class="token function">Times</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Call
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢åˆ—å‡ºäº†å¤šä¸ª <code v-pre>Call</code> å¯¹è±¡æä¾›çš„çº¦æŸæ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šä»‹ç»3ä¸ªå¸¸ç”¨çš„çº¦æŸæ–¹æ³•ï¼šæŒ‡å®šè¿”å›å€¼ã€æŒ‡å®šæ‰§è¡Œæ¬¡æ•°å’ŒæŒ‡å®šæ‰§è¡Œé¡ºåºã€‚</p>
<ol>
<li>æŒ‡å®šè¿”å›å€¼</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥æä¾›è°ƒç”¨<code v-pre>Call</code>çš„<code v-pre>Return</code>å‡½æ•°ï¼Œæ¥æŒ‡å®šæ¥å£çš„è¿”å›å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>mockSpider<span class="token punctuation">.</span><span class="token function">EXPECT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Return</span><span class="token punctuation">(</span><span class="token string">"go1.8.3"</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol>
<li>æŒ‡å®šæ‰§è¡Œæ¬¡æ•°</li>
</ol>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šå‡½æ•°æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œä¾‹å¦‚ï¼šå¯¹äºæ¥å—ç½‘ç»œè¯·æ±‚çš„å‡½æ•°ï¼Œè®¡ç®—å…¶æ‰§è¡Œäº†å¤šå°‘æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code v-pre>Call</code>çš„<code v-pre>Times</code>å‡½æ•°æ¥æŒ‡å®šæ‰§è¡Œæ¬¡æ•°ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mockSpider.EXPECT().Recv().Return(nil).Times(3)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ï¼Œæ‰§è¡Œäº†ä¸‰æ¬¡Recvå‡½æ•°ï¼Œè¿™é‡Œgomockè¿˜æ”¯æŒå…¶ä»–çš„æ‰§è¡Œæ¬¡æ•°é™åˆ¶ï¼š</p>
<ul>
<li>AnyTimes()ï¼Œè¡¨ç¤ºæ‰§è¡Œ0åˆ°å¤šæ¬¡ã€‚</li>
<li>MaxTimes(n int)ï¼Œè¡¨ç¤ºå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæœ€å¤šæ‰§è¡Œnæ¬¡ã€‚</li>
<li>MinTimes(n int)ï¼Œè¡¨ç¤ºå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œæœ€å°‘æ‰§è¡Œnæ¬¡ã€‚</li>
</ul>
<ol>
<li>æŒ‡å®šæ‰§è¡Œé¡ºåº</li>
</ol>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜è¦æŒ‡å®šæ‰§è¡Œé¡ºåº**ï¼Œ<strong>æ¯”å¦‚è¦å…ˆæ‰§è¡Œ</strong> Init æ“ä½œï¼Œç„¶åæ‰èƒ½æ‰§è¡ŒRecvæ“ä½œï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>initCall <span class="token operator">:=</span> mockSpider<span class="token punctuation">.</span><span class="token function">EXPECT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mockSpider<span class="token punctuation">.</span><span class="token function">EXPECT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>initCall<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code v-pre>go test</code>æ¥æµ‹è¯•ä½¿ç”¨äº†Mockä»£ç çš„å•å…ƒæµ‹è¯•ä»£ç ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-v</span>
<span class="token operator">==</span><span class="token operator">=</span> RUN   TestGetGoVersion
--- PASS: TestGetGoVersion <span class="token punctuation">(</span><span class="token number">0</span>.00s<span class="token punctuation">)</span>
PASS
ok    github.com/marmotedu/gopractise-demo/gomock  <span class="token number">0</span>.002s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fakeæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#fakeæµ‹è¯•" aria-hidden="true">#</a> Fakeæµ‹è¯•</h2>
<p>åœ¨Goé¡¹ç›®å¼€å‘ä¸­ï¼Œå¯¹äºæ¯”è¾ƒå¤æ‚çš„æ¥å£ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥Fakeä¸€ä¸ªæ¥å£å®ç°ï¼Œæ¥è¿›è¡Œæµ‹è¯•ã€‚æ‰€è°“Fakeæµ‹è¯•ï¼Œå…¶å®å°±æ˜¯é’ˆå¯¹æ¥å£å®ç°ä¸€ä¸ªå‡ï¼ˆfakeï¼‰çš„å®ä¾‹ã€‚è‡³äºå¦‚ä½•å®ç°Fakeå®ä¾‹ï¼Œéœ€è¦ä½ æ ¹æ®ä¸šåŠ¡è‡ªè¡Œå®ç°ã€‚ä¾‹å¦‚ï¼šIAMé¡¹ç›®ä¸­iam-apiserverç»„ä»¶å°±å®ç°äº†ä¸€ä¸ªfake storeï¼Œä»£ç è§<a href="https://github.com/marmotedu/iam/tree/v1.0.8/internal/apiserver/store/fake" target="_blank" rel="noopener noreferrer">fake<ExternalLinkIcon/></a>ç›®å½•ã€‚å› ä¸ºè¿™ä¸€è®²åé¢çš„IAMé¡¹ç›®æµ‹è¯•å®æˆ˜éƒ¨åˆ†æœ‰ä»‹ç»ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†å±•å¼€è®²è§£ã€‚</p>
<h2 id="ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹" tabindex="-1"><a class="header-anchor" href="#ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹" aria-hidden="true">#</a> ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Ÿ</h2>
<p>ä¸Šé¢ï¼Œæˆ‘ä»‹ç»äº†Goä»£ç æµ‹è¯•çš„åŸºç¡€çŸ¥è¯†ï¼Œè¿™é‡Œæˆ‘å†æ¥åˆ†äº«ä¸‹åœ¨åšæµ‹è¯•æ—¶ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ç‚¹ï¼šä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h3 id="ç¼–ç å‰-tdd" tabindex="-1"><a class="header-anchor" href="#ç¼–ç å‰-tdd" aria-hidden="true">#</a> ç¼–ç å‰ï¼šTDD</h3>
<p><img src="http://sm.nsddd.top/sm202303051057509.png" alt="å›¾ç‰‡"></p>
<p>Test-Driven Developmentï¼Œä¹Ÿå°±æ˜¯æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œæ˜¯æ•æ·å¼€å‘çš„â¼€é¡¹æ ¸å¿ƒå®è·µå’ŒæŠ€æœ¯ï¼Œä¹Ÿæ˜¯â¼€ç§è®¾è®¡æ–¹æ³•è®ºã€‚ç®€å•æ¥è¯´ï¼ŒTDDåŸç†å°±æ˜¯ï¼šå¼€å‘åŠŸèƒ½ä»£ç ä¹‹å‰ï¼Œå…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ä»£ç ï¼Œç„¶åé’ˆå¯¹æµ‹è¯•ç”¨ä¾‹ç¼–å†™åŠŸèƒ½ä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿé€šè¿‡ã€‚è¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼Œé€šè¿‡æµ‹è¯•çš„æ‰§è¡Œä»£ç è‚¯å®šæ»¡è¶³éœ€æ±‚ï¼Œè€Œä¸”æœ‰åŠ©äºé¢å‘æ¥å£ç¼–ç¨‹ï¼Œé™ä½ä»£ç è€¦åˆï¼Œä¹Ÿæå¤§é™ä½äº†bugçš„å‡ºç°å‡ ç‡ã€‚</p>
<p>ç„¶è€Œï¼ŒTDDçš„åå¤„ä¹Ÿæ˜¾è€Œæ˜“è§ï¼šç”±äºæµ‹è¯•ç”¨ä¾‹æ˜¯åœ¨è¿›è¡Œä»£ç è®¾è®¡ä¹‹å‰å†™çš„ï¼Œå¾ˆæœ‰å¯èƒ½é™åˆ¶å¼€å‘è€…å¯¹ä»£ç çš„æ•´ä½“è®¾è®¡ï¼›å¹¶ä¸”ï¼Œç”±äºTDDå¯¹å¼€å‘â¼ˆå‘˜è¦æ±‚éå¸¸é«˜ï¼Œä½“ç°çš„æ€æƒ³è·Ÿä¼ ç»Ÿå¼€å‘æ€ç»´ä¹Ÿä¸â¼€æ ·ï¼Œå› æ­¤å®æ–½èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼›æ­¤å¤–ï¼Œå› ä¸ºè¦å…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ŒTDDä¹Ÿå¯èƒ½ä¼šå½±å“é¡¹ç›®çš„ç ”å‘è¿›åº¦ã€‚æ‰€ä»¥ï¼Œåœ¨å®¢è§‚æƒ…å†µä¸æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¸åº”è¯¥ç›²ç›®è¿½æ±‚å¯¹ä¸šåŠ¡ä»£ç ä½¿ç”¨TDDçš„å¼€å‘æ¨¡å¼ã€‚</p>
<h3 id="ä¸ç¼–ç åŒæ­¥è¿›è¡Œ-å¢é‡" tabindex="-1"><a class="header-anchor" href="#ä¸ç¼–ç åŒæ­¥è¿›è¡Œ-å¢é‡" aria-hidden="true">#</a> ä¸ç¼–ç åŒæ­¥è¿›è¡Œï¼šå¢é‡</h3>
<p>åŠæ—¶ä¸ºå¢é‡ä»£ç å†™å•æµ‹æ˜¯ä¸€ç§è‰¯å¥½çš„ä¹ æƒ¯ã€‚ä¸€æ–¹é¢æ˜¯å› ä¸ºï¼Œæ­¤æ—¶æˆ‘ä»¬å¯¹éœ€æ±‚æœ‰ä¸€å®šçš„ç†è§£ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å†™å‡ºå•å…ƒæµ‹è¯•æ¥éªŒè¯æ­£ç¡®æ€§ã€‚å¹¶ä¸”ï¼Œåœ¨å•æµ‹é˜¶æ®µå°±å‘ç°é—®é¢˜ï¼Œè€Œä¸æ˜¯ç­‰åˆ°è”è°ƒæµ‹è¯•ä¸­æ‰å‘ç°ï¼Œä¿®å¤çš„æˆæœ¬ä¹Ÿæ˜¯æœ€å°çš„ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œåœ¨å†™å•æµ‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿåæ€ä¸šåŠ¡ä»£ç çš„æ­£ç¡®æ€§ã€åˆç†æ€§ï¼Œæ¨åŠ¨æˆ‘ä»¬åœ¨å®ç°çš„è¿‡ç¨‹ä¸­æ›´å¥½åœ°åæ€ä»£ç çš„è®¾è®¡ï¼Œå¹¶åŠæ—¶è°ƒæ•´ã€‚</p>
<h3 id="ç¼–ç å-å­˜é‡" tabindex="-1"><a class="header-anchor" href="#ç¼–ç å-å­˜é‡" aria-hidden="true">#</a> ç¼–ç åï¼šå­˜é‡</h3>
<p>åœ¨å®Œæˆä¸šåŠ¡éœ€æ±‚åï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µï¼šå› ä¸ºä¸Šçº¿æ—¶é—´æ¯”è¾ƒç´§å¼ ã€æ²¡æœ‰å•æµ‹ç›¸å…³è§„åˆ’ï¼Œå¼€å‘é˜¶æ®µåªæ‰‹åŠ¨æµ‹è¯•äº†ä»£ç æ˜¯å¦ç¬¦åˆåŠŸèƒ½ã€‚</p>
<p>å¦‚æœè¿™éƒ¨åˆ†å­˜é‡ä»£ç å‡ºç°è¾ƒå¤§çš„æ–°éœ€æ±‚ï¼Œæˆ–è€…ç»´æŠ¤å·²ç»æˆä¸ºé—®é¢˜ï¼Œéœ€è¦å¤§è§„æ¨¡é‡æ„ï¼Œè¿™æ­£æ˜¯æ¨åŠ¨è¡¥å…¨å•æµ‹çš„å¥½æ—¶æœºã€‚ä¸ºå­˜é‡ä»£ç è¡¥å……ä¸Šå•æµ‹ï¼Œä¸€æ–¹é¢èƒ½å¤Ÿæ¨è¿›é‡æ„è€…è¿›ä¸€æ­¥ç†è§£åŸå…ˆçš„é€»è¾‘ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½å¤Ÿå¢å¼ºé‡æ„è€…é‡æ„ä»£ç åçš„ä¿¡å¿ƒï¼Œé™ä½é£é™©ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¡¥å……å­˜é‡å•æµ‹å¯èƒ½éœ€è¦å†æ¬¡å›å¿†ç†è§£éœ€æ±‚å’Œé€»è¾‘è®¾è®¡ç­‰ç»†èŠ‚ï¼Œè€Œæœ‰æ—¶å†™å•æµ‹çš„äººå¹¶ä¸æ˜¯åŸç¼–ç çš„è®¾è®¡è€…ï¼Œæ‰€ä»¥ç¼–ç åç¼–å†™å’Œæ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ä¹Ÿæœ‰ä¸€å®šçš„ä¸è¶³ã€‚</p>
<h2 id="æµ‹è¯•è¦†ç›–ç‡" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•è¦†ç›–ç‡" aria-hidden="true">#</a> æµ‹è¯•è¦†ç›–ç‡</h2>
<p>æˆ‘ä»¬å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™åº”è¯¥æƒ³å¾—å¾ˆå…¨é¢ï¼Œèƒ½å¤Ÿè¦†ç›–åˆ°æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä½†æœ‰æ—¶ä¹Ÿä¼šæ¼è¿‡ä¸€äº› caseï¼ŒGoæä¾›äº†coverå·¥å…·æ¥ç»Ÿè®¡æµ‹è¯•è¦†ç›–ç‡ã€‚å…·ä½“å¯ä»¥åˆ†ä¸ºä¸¤å¤§æ­¥éª¤ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æ•°æ®ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go <span class="token builtin class-name">test</span> <span class="token parameter variable">-coverprofile</span><span class="token operator">=</span>coverage.out
<span class="token keyword">do</span> some setup
PASS
coverage: <span class="token number">40.0</span>% of statements
<span class="token keyword">do</span> some cleanup
ok    github.com/marmotedu/gopractise-demo/test  <span class="token number">0</span>.003s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‘½ä»¤åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆäº†<code v-pre>coverage.out</code>è¦†ç›–ç‡æ•°æ®æ–‡ä»¶ã€‚</p>
<p><img src="http://sm.nsddd.top/sm202303051101145.png" alt="å›¾ç‰‡"></p>
<p><strong>ç¬¬äºŒæ­¥ï¼Œåˆ†æè¦†ç›–ç‡æ–‡ä»¶ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go tool cover <span class="token parameter variable">-func</span><span class="token operator">=</span>coverage.out
<span class="token keyword">do</span> some setup
PASS
coverage: <span class="token number">40.0</span>% of statements
<span class="token keyword">do</span> some cleanup
ok    github.com/marmotedu/gopractise-demo/test  <span class="token number">0</span>.003s
<span class="token punctuation">[</span>colin@dev test<span class="token punctuation">]</span>$ go tool cover <span class="token parameter variable">-func</span><span class="token operator">=</span>coverage.out
github.com/marmotedu/gopractise-demo/test/math.go:9:  Abs    <span class="token number">100.0</span>%
github.com/marmotedu/gopractise-demo/test/math.go:14:  Max    <span class="token number">100.0</span>%
github.com/marmotedu/gopractise-demo/test/math.go:19:  Min    <span class="token number">0.0</span>%
github.com/marmotedu/gopractise-demo/test/math.go:24:  RandInt    <span class="token number">0.0</span>%
github.com/marmotedu/gopractise-demo/test/math.go:29:  Floor    <span class="token number">0.0</span>%
total:              <span class="token punctuation">(</span>statements<span class="token punctuation">)</span>  <span class="token number">40.0</span>%
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹åˆ°å“ªäº›å‡½æ•°æ²¡æœ‰æµ‹è¯•ï¼Œå“ªäº›å‡½æ•°å†…éƒ¨çš„åˆ†æ”¯æ²¡æœ‰æµ‹è¯•å®Œå…¨ã€‚coverå·¥å…·ä¼šæ ¹æ®è¢«æ‰§è¡Œä»£ç çš„è¡Œæ•°ä¸æ€»è¡Œæ•°çš„æ¯”ä¾‹è®¡ç®—å‡ºè¦†ç›–ç‡ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒAbså’ŒMaxå‡½æ•°çš„æµ‹è¯•è¦†ç›–ç‡ä¸º100%ï¼ŒMinå’ŒRandIntçš„æµ‹è¯•è¦†ç›–ç‡ä¸º0ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code v-pre>go tool cover -html</code>ç”Ÿæˆ<code v-pre>HTML</code>æ ¼å¼çš„åˆ†ææ–‡ä»¶ï¼Œå¯ä»¥æ›´åŠ æ¸…æ™°åœ°å±•ç¤ºä»£ç çš„æµ‹è¯•æƒ…å†µï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>$ go tool cover -html=coverage.out -o coverage.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸Šè¿°å‘½ä»¤ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª<code v-pre>coverage.html</code>æ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€<code v-pre>coverage.html</code>æ–‡ä»¶ï¼Œå¯ä»¥æ›´åŠ æ¸…æ™°åœ°çœ‹åˆ°ä»£ç çš„æµ‹è¯•æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://sm.nsddd.top/sm202303051102687.png" alt="img"></p>
<p>é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“çº¢è‰²éƒ¨åˆ†çš„ä»£ç æ²¡æœ‰è¢«æµ‹è¯•åˆ°ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¥ä¸‹æ¥æœ‰é’ˆå¯¹æ€§åœ°æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œä¸æ˜¯ä¸€å¤´é›¾æ°´ï¼Œä¸çŸ¥é“éœ€è¦ä¸ºå“ªäº›ä»£ç ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>åœ¨Goé¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šæŠŠæµ‹è¯•è¦†ç›–ç‡ä½œä¸ºä»£ç åˆå¹¶çš„ä¸€ä¸ªå¼ºåˆ¶è¦æ±‚ï¼Œæ‰€ä»¥éœ€è¦åœ¨è¿›è¡Œä»£ç æµ‹è¯•æ—¶ï¼ŒåŒæ—¶ç”Ÿæˆä»£ç è¦†ç›–ç‡æ•°æ®æ–‡ä»¶ã€‚åœ¨è¿›è¡Œä»£ç æµ‹è¯•æ—¶ï¼Œå¯ä»¥é€šè¿‡åˆ†æè¯¥æ–‡ä»¶ï¼Œæ¥åˆ¤æ–­æˆ‘ä»¬çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™ä»£ç æµ‹è¯•å¤±è´¥ã€‚</p>
<h2 id="iamé¡¹ç›®æµ‹è¯•å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#iamé¡¹ç›®æµ‹è¯•å®æˆ˜" aria-hidden="true">#</a> IAMé¡¹ç›®æµ‹è¯•å®æˆ˜</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥ä»‹ç»ä¸‹IAMé¡¹ç›®æ˜¯å¦‚ä½•ç¼–å†™å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„ï¼Œä½ å¯ä»¥é€šè¿‡IAMé¡¹ç›®çš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŠ æ·±å¯¹ä¸Šé¢å†…å®¹çš„ç†è§£ã€‚</p>
<h3 id="iamé¡¹ç›®æ˜¯å¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„" tabindex="-1"><a class="header-anchor" href="#iamé¡¹ç›®æ˜¯å¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„" aria-hidden="true">#</a> IAMé¡¹ç›®æ˜¯å¦‚ä½•è¿è¡Œæµ‹è¯•ç”¨ä¾‹çš„ï¼Ÿ</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹IAMé¡¹ç›®æ˜¯å¦‚ä½•æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹çš„ã€‚</p>
<p>åœ¨IAMé¡¹ç›®çš„æºç æ ¹ç›®å½•ä¸‹ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ<code v-pre>make test</code>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œ<code v-pre>make test</code>ä¼šæ‰§è¡Œ<code v-pre>iam/scripts/make-rules/golang.mk</code>æ–‡ä»¶ä¸­çš„<code v-pre>go.test</code>ä¼ªç›®æ ‡ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<div class="language-makefile ext-makefile line-numbers-mode"><pre v-pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.test
<span class="token target symbol">go.test</span><span class="token punctuation">:</span> tools.verify.go-junit-report
  <span class="token operator">@</span>echo <span class="token string">"===========> Run unit test"</span>
  <span class="token operator">@</span>set -o pipefail<span class="token punctuation">;</span><span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> test -race -cover -coverprofile<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/coverage.out \\
    -timeout<span class="token operator">=</span>10m -short -v `go list ./...<span class="token operator">|</span>\
    egrep -v <span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">subst</span> <span class="token variable">$</span><span class="token punctuation">(</span>SPACE<span class="token punctuation">)</span>,<span class="token string">'|'</span>,<span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">sort</span> <span class="token variable">$</span><span class="token punctuation">(</span>EXCLUDE_TESTS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>` 2>&amp;1 <span class="token operator">|</span> \\
    tee ><span class="token punctuation">(</span>go-junit-report --set-exit-code ><span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/report.xml<span class="token punctuation">)</span>
  <span class="token operator">@</span>sed -i <span class="token string">'/mock_.*.go/d'</span> <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/coverage.out <span class="token comment"># remove mock_.*.go files from test coverage</span>
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> tool cover -html<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/coverage.out -o <span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/coverage.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šè¿°è§„åˆ™ä¸­ï¼Œæˆ‘ä»¬æ‰§è¡Œ<code v-pre>go test</code>æ—¶è®¾ç½®äº†è¶…æ—¶æ—¶é—´ã€ç«æ€æ£€æŸ¥ï¼Œå¼€å¯äº†ä»£ç è¦†ç›–ç‡æ£€æŸ¥ï¼Œè¦†ç›–ç‡æµ‹è¯•æ•°æ®ä¿å­˜åœ¨äº†<code v-pre>coverage.out</code>æ–‡ä»¶ä¸­ã€‚åœ¨Goé¡¹ç›®å¼€å‘ä¸­ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åŒ…éƒ½éœ€è¦å•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥ä¸Šé¢çš„å‘½ä»¤è¿˜è¿‡æ»¤æ‰äº†ä¸€äº›ä¸éœ€è¦æµ‹è¯•çš„åŒ…ï¼Œè¿™äº›åŒ…é…ç½®åœ¨<code v-pre>EXCLUDE_TESTS</code>å˜é‡ä¸­ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token assign-left variable">EXCLUDE_TESTS</span><span class="token operator">=</span>github.com/marmotedu/iam/test github.com/marmotedu/iam/pkg/log github.com/marmotedu/iam/third_party github.com/marmotedu/iam/internal/pump/storage github.com/marmotedu/iam/internal/pump github.com/marmotedu/iam/internal/pkg/logger
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åŒæ—¶ï¼Œä¹Ÿè°ƒç”¨äº†<code v-pre>go-junit-report</code>å°†go testçš„ç»“æœè½¬åŒ–æˆäº†xmlæ ¼å¼çš„æŠ¥å‘Šæ–‡ä»¶ï¼Œè¯¥æŠ¥å‘Šæ–‡ä»¶ä¼šè¢«ä¸€äº›CIç³»ç»Ÿï¼Œä¾‹å¦‚Jenkinsæ‹¿æ¥è§£æå¹¶å±•ç¤ºç»“æœã€‚ä¸Šè¿°ä»£ç ä¹ŸåŒæ—¶ç”Ÿæˆäº†coverage.htmlæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥å­˜æ”¾åœ¨åˆ¶å“åº“ä¸­ï¼Œä¾›æˆ‘ä»¬åæœŸåˆ†ææŸ¥çœ‹ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼ŒMockçš„ä»£ç æ˜¯ä¸éœ€è¦ç¼–å†™æµ‹è¯•ç”¨ä¾‹çš„ï¼Œä¸ºäº†é¿å…å½±å“é¡¹ç›®çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œéœ€è¦å°†Mockä»£ç çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡æ•°æ®ä»<code v-pre>coverage.out</code>æ–‡ä»¶ä¸­åˆ é™¤æ‰ï¼Œ<code v-pre>go.test</code>è§„åˆ™é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ é™¤è¿™äº›æ— ç”¨çš„æ•°æ®ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'/mock_.*.go/d'</span> <span class="token variable"><span class="token variable">$(</span>OUTPUT_DIR<span class="token variable">)</span></span>/coverage.out <span class="token comment"># remove mock_.*.go files from test coverage</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡<code v-pre>make cover</code>æ¥è¿›è¡Œå•å…ƒæµ‹è¯•è¦†ç›–ç‡æµ‹è¯•ï¼Œ<code v-pre>make cover</code>ä¼šæ‰§è¡Œ<code v-pre>iam/scripts/make-rules/golang.mk</code>æ–‡ä»¶ä¸­çš„<code v-pre>go.test.cover</code>ä¼ªç›®æ ‡ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<div class="language-makefile ext-makefile line-numbers-mode"><pre v-pre class="language-makefile"><code><span class="token builtin-target builtin">.PHONY</span><span class="token punctuation">:</span> go.test.cover
<span class="token target symbol">go.test.cover</span><span class="token punctuation">:</span> go.test
  <span class="token operator">@</span><span class="token variable">$</span><span class="token punctuation">(</span>GO<span class="token punctuation">)</span> tool cover -func<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>OUTPUT_DIR<span class="token punctuation">)</span>/coverage.out <span class="token operator">|</span> \\
    awk -v target<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>COVERAGE<span class="token punctuation">)</span> -f <span class="token variable">$</span><span class="token punctuation">(</span>ROOT_DIR<span class="token punctuation">)</span>/scripts/coverage.awk
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ç›®æ ‡ä¾èµ–<code v-pre>go.test</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰§è¡Œå•å…ƒæµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ä¹‹å‰ï¼Œä¼šå…ˆè¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œç„¶åä½¿ç”¨å•å…ƒæµ‹è¯•äº§ç”Ÿçš„è¦†ç›–ç‡æ•°æ®<code v-pre>coverage.out</code>è®¡ç®—å‡ºæ€»çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œè¿™é‡Œæ˜¯é€šè¿‡<a href="https://github.com/marmotedu/iam/blob/v1.0.8/scripts/coverage.awk" target="_blank" rel="noopener noreferrer">coverage.awk<ExternalLinkIcon/></a>è„šæœ¬æ¥è®¡ç®—çš„ã€‚</p>
<p>å¦‚æœå•å…ƒæµ‹è¯•è¦†ç›–ç‡ä¸è¾¾æ ‡ï¼ŒMakefileä¼šæŠ¥é”™å¹¶é€€å‡ºã€‚å¯ä»¥é€šè¿‡Makefileçš„<a href="https://github.com/marmotedu/iam/blob/master/scripts/make-rules/common.mk#L39-L41" target="_blank" rel="noopener noreferrer">COVERAGE<ExternalLinkIcon/></a>å˜é‡æ¥è®¾ç½®å•å…ƒæµ‹è¯•è¦†ç›–ç‡é˜ˆå€¼ã€‚</p>
<p>COVERAGEçš„é»˜è®¤å€¼ä¸º60ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰‹åŠ¨æŒ‡å®šï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token function">make</span> cover <span class="token assign-left variable">COVERAGE</span><span class="token operator">=</span><span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸ºäº†ç¡®ä¿é¡¹ç›®çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡ï¼Œéœ€è¦è®¾ç½®å•å…ƒæµ‹è¯•è¦†ç›–ç‡è´¨é‡çº¢çº¿ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›çº¢çº¿å¾ˆéš¾é å¼€å‘è€…çš„è‡ªè§‰æ€§å»ä¿éšœï¼Œæ‰€ä»¥å¥½çš„æ–¹æ³•æ˜¯å°†è´¨é‡çº¢çº¿åŠ å…¥åˆ°CICDæµç¨‹ä¸­ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨<code v-pre>Makefile</code>æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†<code v-pre>cover</code>æ”¾åœ¨<code v-pre>all</code>ç›®æ ‡çš„ä¾èµ–ä¸­ï¼Œå¹¶ä¸”ä½äºbuildä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯<code v-pre>all: gen add-copyright format lint cover build</code>ã€‚è¿™æ ·æ¯æ¬¡å½“æˆ‘ä»¬æ‰§è¡Œmakeæ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œä»£ç æµ‹è¯•ï¼Œå¹¶è®¡ç®—å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œå¦‚æœè¦†ç›–ç‡ä¸è¾¾æ ‡ï¼Œåˆ™åœæ­¢æ„å»ºï¼›å¦‚æœè¾¾æ ‡ï¼Œç»§ç»­è¿›å…¥ä¸‹ä¸€æ­¥çš„æ„å»ºæµç¨‹ã€‚</p>
<h3 id="iamé¡¹ç›®æµ‹è¯•æ¡ˆä¾‹åˆ†äº«" tabindex="-1"><a class="header-anchor" href="#iamé¡¹ç›®æµ‹è¯•æ¡ˆä¾‹åˆ†äº«" aria-hidden="true">#</a> IAMé¡¹ç›®æµ‹è¯•æ¡ˆä¾‹åˆ†äº«</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šç»™ä½ å±•ç¤ºä¸€äº›IAMé¡¹ç›®çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œå› ä¸ºè¿™äº›æµ‹è¯•æ¡ˆä¾‹çš„å®ç°æ–¹æ³•ï¼Œæˆ‘åœ¨<a href="https://time.geekbang.org/column/article/408529" target="_blank" rel="noopener noreferrer">36è®²<ExternalLinkIcon/></a> å’Œè¿™ä¸€è®²çš„å‰åŠéƒ¨åˆ†å·²æœ‰è¯¦ç»†ä»‹ç»ï¼Œæ‰€ä»¥è¿™é‡Œï¼Œæˆ‘åªåˆ—å‡ºå…·ä½“çš„å®ç°ä»£ç ï¼Œä¸ä¼šå†ä»‹ç»è¿™äº›ä»£ç çš„å®ç°æ–¹æ³•ã€‚</p>
<ol>
<li>å•å…ƒæµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç¼–å†™å•å…ƒæµ‹è¯•ä»£ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨gotestså·¥å…·ç”Ÿæˆå•å…ƒæµ‹è¯•ä»£ç ã€‚</p>
<p>å…ˆæ¥çœ‹æ‰‹åŠ¨ç¼–å†™æµ‹è¯•ä»£ç çš„æ¡ˆä¾‹ã€‚è¿™é‡Œå•å…ƒæµ‹è¯•ä»£ç è§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/pkg/log/log_test.go#L52-L62" target="_blank" rel="noopener noreferrer">Test_Option<ExternalLinkIcon/></a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Test_Option</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs <span class="token operator">:=</span> pflag<span class="token punctuation">.</span><span class="token function">NewFlagSet</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> pflag<span class="token punctuation">.</span>ExitOnError<span class="token punctuation">)</span>
    opt <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">NewOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    opt<span class="token punctuation">.</span><span class="token function">AddFlags</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span>

    args <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">"--log.level=debug"</span><span class="token punctuation">}</span>
    err <span class="token operator">:=</span> fs<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Nil</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>

    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"debug"</span><span class="token punctuation">,</span> opt<span class="token punctuation">.</span>Level<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œä½¿ç”¨äº†<code v-pre>github.com/stretchr/testify/assert</code>åŒ…æ¥å¯¹æ¯”ç»“æœã€‚</p>
<p>å†æ¥çœ‹ä½¿ç”¨gotestså·¥å…·ç”Ÿæˆå•å…ƒæµ‹è¯•ä»£ç çš„æ¡ˆä¾‹ï¼ˆTable-Driven çš„æµ‹è¯•æ¨¡å¼ï¼‰ã€‚å‡ºäºæ•ˆç‡ä¸Šçš„è€ƒè™‘ï¼ŒIAMé¡¹ç›®çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨gotestså·¥å…·ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿ä»£ç ï¼Œå¹¶åŸºäºè¿™äº›æ¨¡æ¿ä»£ç å¡«å……æµ‹è¯•Caseçš„ã€‚ä»£ç è§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/service_test.go" target="_blank" rel="noopener noreferrer">service_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ã€‚</p>
<ol>
<li>æ€§èƒ½æµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>IAMé¡¹ç›®çš„æ€§èƒ½æµ‹è¯•ç”¨ä¾‹ï¼Œè§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/user_test.go#L27-L41" target="_blank" rel="noopener noreferrer">BenchmarkListUser<ExternalLinkIcon/></a>æµ‹è¯•å‡½æ•°ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">BenchmarkListUser</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  opts <span class="token operator">:=</span> metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">{</span>
    Offset<span class="token punctuation">:</span> pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Limit<span class="token punctuation">:</span>  pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  storeIns<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> fake<span class="token punctuation">.</span><span class="token function">GetFakeFactoryOr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  u <span class="token operator">:=</span> <span class="token operator">&amp;</span>userService<span class="token punctuation">{</span>
    store<span class="token punctuation">:</span> storeIns<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> u<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>ç¤ºä¾‹æµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>IAMé¡¹ç›®çš„ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹è§<a href="https://github.com/marmotedu/errors/blob/v1.0.2/example_test.go" target="_blank" rel="noopener noreferrer">example_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ã€‚<code v-pre>example_test.go</code>ä¸­çš„ä¸€ä¸ªç¤ºä¾‹æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ExampleNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  err <span class="token operator">:=</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"whoops"</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>

  <span class="token comment">// Output: whoops</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>TestMainæµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>IAMé¡¹ç›®çš„TestMainæµ‹è¯•æ¡ˆä¾‹ï¼Œè§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/user_test.go" target="_blank" rel="noopener noreferrer">user_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ä¸­çš„<code v-pre>TestMain</code>å‡½æ•°ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> fake<span class="token punctuation">.</span><span class="token function">GetFakeFactoryOr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>TestMain</code>å‡½æ•°åˆå§‹åŒ–äº†fake Factoryï¼Œç„¶åè°ƒç”¨<code v-pre>m.Run</code>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<ol>
<li>Mockæµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>Mockä»£ç è§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/mock_service.go" target="_blank" rel="noopener noreferrer">internal/apiserver/service/v1/mock_service.go<ExternalLinkIcon/></a>ï¼Œä½¿ç”¨Mockçš„æµ‹è¯•ç”¨ä¾‹è§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/controller/v1/user/create_test.go" target="_blank" rel="noopener noreferrer">internal/apiserver/controller/v1/user/create_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ã€‚å› ä¸ºä»£ç æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå»ºè®®ä½ æ‰“å¼€é“¾æ¥ï¼ŒæŸ¥çœ‹æµ‹è¯•ç”¨ä¾‹çš„å…·ä½“å®ç°ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨IAMé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ¥è‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰çš„Mockæ–‡ä»¶ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ go generate ./<span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol>
<li>Fakeæµ‹è¯•æ¡ˆä¾‹</li>
</ol>
<p>fake storeä»£ç å®ç°ä½äº<a href="https://github.com/marmotedu/iam/tree/v1.0.8/internal/apiserver/store/fake" target="_blank" rel="noopener noreferrer">internal/apiserver/store/fake<ExternalLinkIcon/></a>ç›®å½•ä¸‹ã€‚fake storeçš„ä½¿ç”¨æ–¹å¼ï¼Œè§<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/service/v1/user_test.go" target="_blank" rel="noopener noreferrer">user_test.go<ExternalLinkIcon/></a>æ–‡ä»¶ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">TestMain</span><span class="token punctuation">(</span>m <span class="token operator">*</span>testing<span class="token punctuation">.</span>M<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> fake<span class="token punctuation">.</span><span class="token function">GetFakeFactoryOr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">BenchmarkListUser</span><span class="token punctuation">(</span>b <span class="token operator">*</span>testing<span class="token punctuation">.</span>B<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    opts <span class="token operator">:=</span> metav1<span class="token punctuation">.</span>ListOptions<span class="token punctuation">{</span>
        Offset<span class="token punctuation">:</span> pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Limit<span class="token punctuation">:</span>  pointer<span class="token punctuation">.</span><span class="token function">ToInt64</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    storeIns<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> fake<span class="token punctuation">.</span><span class="token function">GetFakeFactoryOr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    u <span class="token operator">:=</span> <span class="token operator">&amp;</span>userService<span class="token punctuation">{</span>
        store<span class="token punctuation">:</span> storeIns<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> u<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç é€šè¿‡<code v-pre>TestMain</code>åˆå§‹åŒ–fakeå®ä¾‹ï¼ˆ<a href="https://github.com/marmotedu/iam/blob/v1.0.8/internal/apiserver/store/store.go#L12-L17" target="_blank" rel="noopener noreferrer">store.Factory<ExternalLinkIcon/></a>æ¥å£ç±»å‹ï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">GetFakeFactoryOr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>store<span class="token punctuation">.</span>Factory<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    once<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fakeFactory <span class="token operator">=</span> <span class="token operator">&amp;</span>datastore<span class="token punctuation">{</span>
            users<span class="token punctuation">:</span>    <span class="token function">FakeUsers</span><span class="token punctuation">(</span>ResourceCount<span class="token punctuation">)</span><span class="token punctuation">,</span>
            secrets<span class="token punctuation">:</span>  <span class="token function">FakeSecrets</span><span class="token punctuation">(</span>ResourceCount<span class="token punctuation">)</span><span class="token punctuation">,</span>
            policies<span class="token punctuation">:</span> <span class="token function">FakePolicies</span><span class="token punctuation">(</span>ResourceCount<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> fakeFactory <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"failed to get mysql store fatory, mysqlFactory: %+v"</span><span class="token punctuation">,</span> fakeFactory<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> fakeFactory<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>GetFakeFactoryOr</code>å‡½æ•°ï¼Œåˆ›å»ºäº†ä¸€äº›fake usersã€secretsã€policiesï¼Œå¹¶ä¿å­˜åœ¨äº†<code v-pre>fakeFactory</code>å˜é‡ä¸­ï¼Œä¾›åé¢çš„æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ï¼Œä¾‹å¦‚BenchmarkListUserã€Test_newUsersç­‰ã€‚</p>
<h2 id="å…¶ä»–æµ‹è¯•å·¥å…·-åŒ…" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–æµ‹è¯•å·¥å…·-åŒ…" aria-hidden="true">#</a> å…¶ä»–æµ‹è¯•å·¥å…·/åŒ…</h2>
<p>æœ€åï¼Œæˆ‘å†æ¥åˆ†äº«ä¸‹Goé¡¹ç›®æµ‹è¯•ä¸­å¸¸ç”¨çš„å·¥å…·/åŒ…ï¼Œå› ä¸ºå†…å®¹è¾ƒå¤šï¼Œæˆ‘å°±ä¸è¯¦ç»†ä»‹ç»äº†ï¼Œå¦‚æœæ„Ÿå…´è¶£ä½ å¯ä»¥ç‚¹è¿›é“¾æ¥è‡ªè¡Œå­¦ä¹ ã€‚æˆ‘å°†è¿™äº›æµ‹è¯•å·¥å…·/åŒ…åˆ†ä¸ºäº†ä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯æµ‹è¯•æ¡†æ¶å’ŒMockå·¥å…·ã€‚</p>
<h3 id="æµ‹è¯•æ¡†æ¶" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ¡†æ¶" aria-hidden="true">#</a> æµ‹è¯•æ¡†æ¶</h3>
<ul>
<li><a href="https://github.com/stretchr/testify" target="_blank" rel="noopener noreferrer">Testifyæ¡†æ¶<ExternalLinkIcon/></a>ï¼šTestifyæ˜¯Go testçš„é¢„åˆ¤å·¥å…·ï¼Œå®ƒèƒ½è®©ä½ çš„æµ‹è¯•ä»£ç å˜å¾—æ›´ä¼˜é›…å’Œé«˜æ•ˆï¼Œæµ‹è¯•ç»“æœä¹Ÿå˜å¾—æ›´è¯¦ç»†ã€‚</li>
<li><a href="https://github.com/smartystreets/goconvey" target="_blank" rel="noopener noreferrer">GoConveyæ¡†æ¶<ExternalLinkIcon/></a>ï¼šGoConveyæ˜¯ä¸€æ¬¾é’ˆå¯¹Golangçš„æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥ç®¡ç†å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„æ–­è¨€å‡½æ•°ï¼Œå¹¶æ”¯æŒå¾ˆå¤š Web ç•Œé¢ç‰¹æ€§ã€‚</li>
</ul>
<h3 id="mockå·¥å…·" tabindex="-1"><a class="header-anchor" href="#mockå·¥å…·" aria-hidden="true">#</a> Mockå·¥å…·</h3>
<p>è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»‹ç»äº†Goå®˜æ–¹æä¾›çš„Mockæ¡†æ¶GoMockï¼Œä¸è¿‡è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¼˜ç§€Mockå·¥å…·å¯ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚è¿™äº›Mockå·¥å…·åˆ†åˆ«ç”¨åœ¨ä¸åŒçš„Mockåœºæ™¯ä¸­ï¼Œæˆ‘åœ¨ <a href="https://time.geekbang.org/column/article/384648" target="_blank" rel="noopener noreferrer">10è®²<ExternalLinkIcon/></a>ä¸­å·²ç»ä»‹ç»è¿‡ã€‚ä¸è¿‡ï¼Œä¸ºäº†ä½¿æˆ‘ä»¬è¿™ä¸€è®²çš„æµ‹è¯•çŸ¥è¯†ä½“ç³»æ›´åŠ å®Œæ•´ï¼Œè¿™é‡Œæˆ‘è¿˜æ˜¯å†æä¸€æ¬¡ï¼Œä½ å¯ä»¥å¤ä¹ ä¸€éã€‚</p>
<ul>
<li><a href="https://github.com/DATA-DOG/go-sqlmock" target="_blank" rel="noopener noreferrer">sqlmock<ExternalLinkIcon/></a>ï¼šå¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥ã€‚æ•°æ®åº“æ˜¯é¡¹ç›®ä¸­æ¯”è¾ƒå¸¸è§çš„ä¾èµ–ï¼Œåœ¨é‡åˆ°æ•°æ®åº“ä¾èµ–æ—¶éƒ½å¯ä»¥ç”¨å®ƒã€‚</li>
<li><a href="https://github.com/jarcoal/httpmock" target="_blank" rel="noopener noreferrer">httpmock<ExternalLinkIcon/></a>ï¼šå¯ä»¥ç”¨æ¥Mock HTTPè¯·æ±‚ã€‚</li>
<li><a href="https://github.com/bouk/monkey" target="_blank" rel="noopener noreferrer">bouk/monkey<ExternalLinkIcon/></a>ï¼šçŒ´å­è¡¥ä¸ï¼Œèƒ½å¤Ÿé€šè¿‡æ›¿æ¢å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼æ¥ä¿®æ”¹ä»»æ„å‡½æ•°çš„å®ç°ã€‚å¦‚æœgolang/mockã€sqlmockå’Œhttpmockè¿™å‡ ç§æ–¹æ³•éƒ½ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç”¨çŒ´å­è¡¥ä¸çš„æ–¹å¼æ¥Mockä¾èµ–ã€‚å¯ä»¥è¿™ä¹ˆè¯´ï¼ŒçŒ´å­è¡¥ä¸æä¾›äº†å•å…ƒæµ‹è¯• Mock ä¾èµ–çš„æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚</li>
</ul>
<h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2>
<p>è¿™ä¸€è®²ï¼Œæˆ‘ä»‹ç»äº†é™¤å•å…ƒæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ä¹‹å¤–çš„å¦ä¸€äº›æµ‹è¯•æ–¹æ³•ã€‚</p>
<p>é™¤äº†ç¤ºä¾‹æµ‹è¯•å’ŒTestMainå‡½æ•°ï¼Œæˆ‘è¿˜è¯¦ç»†ä»‹ç»äº†Mockæµ‹è¯•ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•ä½¿ç”¨GoMockæ¥æµ‹è¯•ä¸€äº›åœ¨å•å…ƒæµ‹è¯•ç¯å¢ƒä¸‹ä¸å¥½å®ç°çš„æ¥å£ã€‚ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨GoMockæ¥Mockæ¥å£ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ä¸šåŠ¡é€»è¾‘æ¯”è¾ƒå¤æ‚çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Fakeä¸€ä¸ªæ¥å£å®ç°ï¼Œæ¥å¯¹ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œè¿™ä¹Ÿç§°ä¸ºFakeæµ‹è¯•ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘è¿˜ä»‹ç»äº†ä½•æ—¶ç¼–å†™å’Œæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ï¼Œé€‰æ‹©åœ¨ç¼–å†™ä»£ç å‰ã€ç¼–å†™ä»£ç ä¸­ã€ç¼–å†™ä»£ç åç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>ä¸ºäº†ä¿è¯å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥ä¸ºæ•´ä¸ªé¡¹ç›®è®¾ç½®å•å…ƒæµ‹è¯•è¦†ç›–ç‡è´¨é‡çº¢çº¿ï¼Œå¹¶å°†è¯¥è´¨é‡çº¢çº¿åŠ å…¥åˆ°CICDæµç¨‹ä¸­ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code v-pre>go test -coverprofile=coverage.out</code> å‘½ä»¤æ¥ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æ•°æ®ï¼Œé€šè¿‡<code v-pre>go tool cover -func=coverage.out</code> å‘½ä»¤æ¥åˆ†æè¦†ç›–ç‡æ–‡ä»¶ã€‚</p>
<p>IAMé¡¹ç›®ä¸­ä½¿ç”¨äº†å¤§é‡çš„æµ‹è¯•æ–¹æ³•å’ŒæŠ€å·§æ¥æµ‹è¯•ä»£ç ï¼Œä¸ºäº†åŠ æ·±ä½ å¯¹æµ‹è¯•çŸ¥è¯†çš„ç†è§£ï¼Œæˆ‘ä¹Ÿåˆ—ä¸¾äº†ä¸€äº›æµ‹è¯•æ¡ˆä¾‹ï¼Œä¾›ä½ å‚è€ƒã€å­¦ä¹ å’ŒéªŒè¯ã€‚å…·ä½“çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œä½ å¯ä»¥è¿”å›å‰é¢æŸ¥çœ‹ä¸‹ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–ä¸€äº›æµ‹è¯•æ¡†æ¶ï¼Œä¾‹å¦‚Testifyæ¡†æ¶å’ŒGoConveyæ¡†æ¶ã€‚åœ¨Goä»£ç æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ˜¯Goå®˜æ–¹æä¾›çš„Mockæ¡†æ¶GoMockï¼Œä½†ä»ç„¶æœ‰å…¶ä»–ä¼˜ç§€çš„Mockå·¥å…·ï¼Œå¯ä¾›æˆ‘ä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚sqlmockã€httpmockã€bouk/monkeyç­‰ã€‚</p>
<h2 id="è¯¾åä¹ é¢˜" tabindex="-1"><a class="header-anchor" href="#è¯¾åä¹ é¢˜" aria-hidden="true">#</a> è¯¾åä¹ é¢˜</h2>
<ol>
<li>è¯·ä½¿ç”¨ <a href="https://github.com/DATA-DOG/go-sqlmock" target="_blank" rel="noopener noreferrer">sqlmock<ExternalLinkIcon/></a> æ¥Mockä¸€ä¸ªGORMæ•°æ®åº“å®ä¾‹ï¼Œå¹¶å®ŒæˆGORMçš„CURDå•å…ƒæµ‹è¯•ç”¨ä¾‹ç¼–å†™ã€‚</li>
<li>æ€è€ƒä¸‹ï¼Œåœ¨Goé¡¹ç›®å¼€å‘ä¸­ï¼Œè¿˜æœ‰å“ªäº›ä¼˜ç§€çš„æµ‹è¯•æ¡†æ¶ã€æµ‹è¯•å·¥å…·ã€Mockå·¥å…·ä»¥åŠæµ‹è¯•æŠ€å·§ï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</li>
</ol>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '28.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '30.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/projects/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


