<template><div><h1 id="tcpç½‘ç»œç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#tcpç½‘ç»œç¼–ç¨‹" aria-hidden="true">#</a> TCPç½‘ç»œç¼–ç¨‹</h1>
<nav class="table-of-contents"><ul><li><router-link to="#ç½‘ç»œç¼–ç¨‹">ç½‘ç»œç¼–ç¨‹</router-link></li><li><router-link to="#ç«¯å£-port">ç«¯å£ï¼ˆport)</router-link></li><li><router-link to="#å¤„ç†æµç¨‹">å¤„ç†æµç¨‹</router-link></li><li><router-link to="#net">net</router-link></li><li><router-link to="#net-parseip">net.ParseIP()</router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<p>[toc]</p>
<p>ğŸ˜¶â€ğŸŒ«ï¸goè¯­è¨€å®˜æ–¹ç¼–ç¨‹æŒ‡å—ï¼š<a href="https://golang.org/#" target="_blank" rel="noopener noreferrer">https://golang.org/#<ExternalLinkIcon/></a></p>
<blockquote>
<p>goè¯­è¨€çš„å®˜æ–¹æ–‡æ¡£å­¦ä¹ ç¬”è®°å¾ˆå…¨ï¼Œæ¨èå»å®˜ç½‘å­¦ä¹ </p>
</blockquote>
<p>ğŸ˜¶â€ğŸŒ«ï¸æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼šgithub: <a href="https://github.com/3293172751/golang-rearn" target="_blank" rel="noopener noreferrer">https://github.com/3293172751/golang-rearn<ExternalLinkIcon/></a></p>
<hr>
<p><strong>åŒºå—é“¾æŠ€æœ¯ï¼ˆä¹Ÿç§°ä¹‹ä¸ºåˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯ï¼‰</strong>ï¼Œæ˜¯ä¸€ç§äº’è”ç½‘æ•°æ®åº“æŠ€æœ¯ï¼Œå…¶ç‰¹ç‚¹æ˜¯å»ä¸­å¿ƒåŒ–ï¼Œå…¬å¼€é€æ˜ï¼Œè®©æ¯ä¸€ä¸ªäººå‡å¯å‚ä¸çš„æ•°æ®åº“è®°å½•</p>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•å…³äºåŒºå—é“¾æŠ€æœ¯ï¼Œå¯ä»¥å…³æ³¨æˆ‘ï¼Œå…±åŒå­¦ä¹ æ›´å¤šçš„åŒºå—é“¾æŠ€æœ¯ã€‚åšå®¢<a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<h2 id="ç½‘ç»œç¼–ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç½‘ç»œç¼–ç¨‹" aria-hidden="true">#</a> ç½‘ç»œç¼–ç¨‹</h2>
<ol>
<li><strong>TCP socketç¼–ç¨‹ï¼šç›®å‰ç½‘ç»œç¼–ç¨‹çš„ä¸»æµï¼Œåº•å±‚ä½¿ç”¨TCP/IPåè®®ï¼ˆipv4/ipv6)çš„ï¼Œæ¯”å¦‚è¯´qq</strong></li>
<li><strong>b/sç»“æ„çš„httpç¼–ç¨‹ï¼šhttpçš„åº•å±‚ä¹Ÿæ˜¯ç”¨tcp socketå®ç°çš„ï¼ˆwebå¼€å‘ï¼‰</strong></li>
</ol>
<blockquote>
<p>ä»¥ååšæœåŠ¡å™¨å¼€å‘ï¼Œæ¨èè‡ªé¡¶å‘ä¸‹</p>
</blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>ipv4ï¼šå››ä¸ªå­—èŠ‚è¡¨ç¤ºçš„åœ°å€      32ä½
ipv6ï¼šåå…­ä½å­—èŠ‚è¡¨ç¤ºçš„åœ°å€		128ä½
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç«¯å£-port" tabindex="-1"><a class="header-anchor" href="#ç«¯å£-port" aria-hidden="true">#</a> ç«¯å£ï¼ˆport)</h2>
<p><strong>æŒ‡çš„æ˜¯TCP/IPåè®®ä¸­çš„ç«¯å£ï¼Œæ˜¯é€»è¾‘æ„ä¹‰ä¸Šçš„ç«¯å£</strong></p>
<p><strong>æœåŠ¡ç¨‹åºå¿…é¡»è¦ç›‘å¬ä¸€ä¸ªç«¯å£</strong></p>
<blockquote>
<p>æˆ‘ä»¬åœ¨åšæœåŠ¡å™¨çš„æ—¶å€™åº”è¯¥å°½å¯èƒ½å°‘å¼€æ”¾ç«¯å£ï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰å±é™©</p>
</blockquote>
<p><strong>ä¸€ä¸ªç«¯å£åªèƒ½è¢«ä¸€ä¸ªç¨‹åºç›‘å¬</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>netstat -an :æŸ¥çœ‹æœ¬æœºæœ‰å“ªäº›ç«¯å£åœ¨ç›‘å¬
netstat -anb:æŸ¥çœ‹ç›‘å¬ç«¯å£çš„pidï¼Œç»“åˆä»»åŠ¡ç®¡ç†å™¨å…³é—­ä¸å®‰å…¨ç«¯å£
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¤„ç†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#å¤„ç†æµç¨‹" aria-hidden="true">#</a> å¤„ç†æµç¨‹</h2>
<p><strong>æœåŠ¡ç«¯ï¼š</strong></p>
<ol>
<li>ç›‘å¬ç«¯å£</li>
<li>æ¥æ”¶tcpé“¾æ¥ï¼Œå»ºç«‹å’Œå®¢æˆ·ç«¯é“¾æ¥</li>
<li>åˆ›å»ºgoroutine,å¤„ç†è¯¥è¿æ¥çš„è¯·æ±‚ï¼ˆ<em>å®¢æˆ·ç«¯é€šè¿‡é“¾æ¥å‘é€è¯·æ±‚åŒ…</em>ï¼‰</li>
</ol>
<p><strong>å®¢æˆ·ç«¯ï¼š</strong></p>
<ol>
<li>å»ºç«‹å’ŒæœåŠ¡ç«¯é“¾æ¥</li>
<li>å‘é€è¯·æ±‚æ•°æ®ï¼Œæ¥æ”¶æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</li>
<li>å…³é—­è¿æ¥</li>
</ol>
<p><strong>åœ¨åšç½‘ç»œä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨çš„åŒ…net</strong></p>
<h2 id="net" tabindex="-1"><a class="header-anchor" href="#net" aria-hidden="true">#</a> net</h2>
<p><strong>æœåŠ¡ç«¯</strong></p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net"</span> <span class="token comment">//åšç½‘ç»œsocketå¼€å‘æ—¶,netåŒ…å«æœ‰æˆ‘ä»¬éœ€è¦æ‰€æœ‰çš„æ–¹æ³•å’Œå‡½æ•°</span>
	<span class="token boolean">_</span><span class="token string">"io"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">process</span><span class="token punctuation">(</span>conn net<span class="token punctuation">.</span>Conn<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">//è¿™é‡Œæˆ‘ä»¬å¾ªç¯çš„æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span>
	<span class="token keyword">defer</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å…³é—­conn</span>

	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		<span class="token comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ‡ç‰‡</span>
		buf <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
		<span class="token comment">//conn.Read(buf)</span>
		<span class="token comment">//1. ç­‰å¾…å®¢æˆ·ç«¯é€šè¿‡connå‘é€ä¿¡æ¯</span>
		<span class="token comment">//2. å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰wrtie[å‘é€]ï¼Œé‚£ä¹ˆåç¨‹å°±é˜»å¡åœ¨è¿™é‡Œ</span>
		<span class="token comment">//fmt.Printf("æœåŠ¡å™¨åœ¨ç­‰å¾…å®¢æˆ·ç«¯%s å‘é€ä¿¡æ¯\n", conn.RemoteAddr().String())</span>
		n <span class="token punctuation">,</span> err <span class="token operator">:=</span> conn<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token comment">//ä»connè¯»å–</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·ç«¯é€€å‡º err=%v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token comment">//!!!</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//3. æ˜¾ç¤ºå®¢æˆ·ç«¯å‘é€çš„å†…å®¹åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯</span>
		fmt<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨å¼€å§‹ç›‘å¬...."</span><span class="token punctuation">)</span>
	<span class="token comment">//net.Listen("tcp", "0.0.0.0:8888")</span>
	<span class="token comment">//1. tcp è¡¨ç¤ºä½¿ç”¨ç½‘ç»œåè®®æ˜¯tcp</span>
	<span class="token comment">//2. 0.0.0.0:8888 è¡¨ç¤ºåœ¨æœ¬åœ°ç›‘å¬ 8888ç«¯å£,æ”¯æŒipv4å’Œipv6</span>
	listen<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">"0.0.0.0:8888"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"listen err="</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> 
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> listen<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å»¶æ—¶å…³é—­listen</span>

	<span class="token comment">//å¾ªç¯ç­‰å¾…å®¢æˆ·ç«¯æ¥é“¾æ¥æˆ‘</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
		<span class="token comment">//ç­‰å¾…å®¢æˆ·ç«¯é“¾æ¥</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"ç­‰å¾…å®¢æˆ·ç«¯æ¥é“¾æ¥...."</span><span class="token punctuation">)</span>
		conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> listen<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Accept() err="</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
			
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Accept() suc con=%v å®¢æˆ·ç«¯ip=%v\n"</span><span class="token punctuation">,</span> conn<span class="token punctuation">,</span> conn<span class="token punctuation">.</span><span class="token function">RemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//è¿™é‡Œå‡†å¤‡å…¶ä¸€ä¸ªåç¨‹ï¼Œä¸ºå®¢æˆ·ç«¯æœåŠ¡</span>
		<span class="token keyword">go</span> <span class="token function">process</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//fmt.Printf("listen suc=%v\n", listen)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®¢æˆ·ç«¯</strong></p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"net"</span>
	<span class="token string">"bufio"</span>
	<span class="token string">"os"</span>
	<span class="token string">"strings"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">"tcp"</span><span class="token punctuation">,</span> <span class="token string">"192.168.20.253:8888"</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"client dial err="</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token keyword">return</span> 
	<span class="token punctuation">}</span>
	<span class="token comment">//åŠŸèƒ½ä¸€ï¼šå®¢æˆ·ç«¯å¯ä»¥å‘é€å•è¡Œæ•°æ®ï¼Œç„¶åå°±é€€å‡º</span>
	reader <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewReader</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span> <span class="token comment">//os.Stdin ä»£è¡¨æ ‡å‡†è¾“å…¥[ç»ˆç«¯]</span>

	<span class="token keyword">for</span> <span class="token punctuation">{</span>

		<span class="token comment">//ä»ç»ˆç«¯è¯»å–ä¸€è¡Œç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‡†å¤‡å‘é€ç»™æœåŠ¡å™¨</span>
		line<span class="token punctuation">,</span> err <span class="token operator">:=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"readString err="</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">//å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯ exitå°±é€€å‡º</span>
		line <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span>line<span class="token punctuation">,</span> <span class="token string">" \r\n"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> line <span class="token operator">==</span> <span class="token string">"exit"</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·ç«¯é€€å‡º.."</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//å†å°†line å‘é€ç»™ æœåŠ¡å™¨</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>line <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"conn.Write err="</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>	
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>net.ResolveIPAddr()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æ ¹æ®åŸŸåæŸ¥æ‰¾IPåœ°å€</strong></p>
<p>ä¸å¾—ä¸æ„Ÿå¹Goä¸ºå¼€å‘è€…è€ƒè™‘è‰¯å¤šï¼Œgodocè¿™ä¸ªå·¥å…·çœŸçš„å¾ˆæ–¹ä¾¿ï¼å…ˆçœ‹ä¸‹æºç ã€‚</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>$ godoc <span class="token operator">-</span>src net<span class="token punctuation">.</span>ResolveIPAddr
<span class="token keyword">func</span> <span class="token function">ResolveIPAddr</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> addr <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>IPAddr<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> net <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">{</span>
        net <span class="token operator">=</span> <span class="token string">"ip"</span>
    <span class="token punctuation">}</span>
    afnet<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">parseNetwork</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> afnet <span class="token punctuation">{</span>          <span class="token comment">//æ£€æµ‹</span>
    <span class="token keyword">case</span> <span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token string">"ip4"</span><span class="token punctuation">,</span> <span class="token string">"ip6"</span><span class="token punctuation">:</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token function">UnknownNetworkError</span><span class="token punctuation">(</span>net<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    addrs<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">internetAddrList</span><span class="token punctuation">(</span>afnet<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> noDeadline<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> addrs<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span>isIPv4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>IPAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åˆä»æºç ä¸­å­¦ä¹ äº†ä¸€æ‹›ï¼š<code v-pre>case &quot;ip&quot;, &quot;ip4&quot;, &quot;ip6&quot;</code>ã€‚switchçš„ä¸€ä¸ªcaseç›´æ¥æ£€æµ‹å¤šä¸ªå€¼çš„æ–¹æ³•ï¼Œå¦‚æœä¸åŒ¹é…åˆ™æ‰§è¡Œdefaultä¸­çš„ä»£ç ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œnetå’Œaddrå½¢å‚éƒ½æ¥å—stringç±»å‹ï¼Œè€Œè¿”å›<strong>IPAddr</strong>çš„æŒ‡é’ˆç±»å‹ï¼Œå’Œerrorç±»å‹çš„å€¼ã€‚</p>
<p>æ¥ä½¿ç”¨ä¸€ä¸‹ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"net"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    addr<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">ResolveIPAddr</span><span class="token punctuation">(</span><span class="token string">"ip"</span><span class="token punctuation">,</span> <span class="token string">"www.baidu.com"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>addr<span class="token punctuation">.</span>IP<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š
<img src="http://img.blog.csdn.net/20160330140849611" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p>
<p>æ³¨æ„çœ‹ResolveIPAddrçš„æºç ï¼Œå¦‚æœä½ ä¼ ç»™netçš„å‚æ•°ä¸æ˜¯<code v-pre>&quot;ip&quot;, &quot;ip4&quot;, &quot;ip6&quot;</code>å…¶ä¸­çš„ä¸€ä¸ªï¼Œé‚£ä¹ˆerrå°±ä¸ä¼šæ˜¯nilï¼Œè€Œæ˜¯<code v-pre>UnknownNetworkError(net)</code>ï¼Œé”™è¯¯çš„è¾“å‡ºä¿¡æ¯ä¼šæ˜¯è¿™æ ·çš„ï¼š
<code v-pre>unknown network tcp</code>ã€‚</p>
<h2 id="net-parseip" tabindex="-1"><a class="header-anchor" href="#net-parseip" aria-hidden="true">#</a> net.ParseIP()</h2>
<p><strong>æ£€æŸ¥IPåœ°å€æ ¼å¼æ˜¯å¦æœ‰æ•ˆ</strong></p>
<p>ä¾ç…§æƒ¯ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç ï¼Œ<code v-pre>$ godoc -src net ParseIP</code>ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">ParseIP</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> IP <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token char">'.'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token function">parseIPv4</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token char">':'</span><span class="token punctuation">:</span>
            ip<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">parseIPv6</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> ip
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IPv4ç”¨<code v-pre>.</code>å·éš”å¼€ï¼ŒIPv6ç”¨<code v-pre>ï¼š</code>å·éš”å¼€ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°çš„å†…éƒ¨åˆè¿›è¡Œäº†åˆ¤æ–­å…¶æ˜¯IPv4è¿˜æ˜¯IPv6ã€‚</p>
<p>æ³¨æ„ï¼šä½ ä¸è¦æ‰‹åŠ¨å»è°ƒç”¨<code v-pre>net.parseIPv4</code>æˆ–è€…<code v-pre>net.parseIPv6</code>ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>cannot refer to unexported name net.parseIPV4
undefined: net.parseIPV4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å› ä¸ºGoåˆ©ç”¨é¦–å­—æ¯çš„å¤§å°å†™æ¥é™åˆ¶åŒ…å¤–æ˜¯å¦å¯è®¿é—®ï¼Œå°å†™çš„å‡½æ•°æˆ–å˜é‡åœ¨åŒ…å¤–æ— æ³•è®¿é—®åˆ°ï¼Œå°±å¦‚åŒJavaçš„<code v-pre>publicï¼Œprivate</code>ä¿®é¥°ç¬¦ã€‚</p>
<p>æŸ¥çœ‹<code v-pre>parseIPv4</code>çš„æºç åˆå‘ç°ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">parseIPv4</span><span class="token punctuation">(</span>s <span class="token builtin">string</span><span class="token punctuation">)</span> IP <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token function">IPv4</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†è¿½æº¯åˆ°<code v-pre>IPv4ä¸Š</code></p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">IPv4</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token builtin">byte</span><span class="token punctuation">)</span> IP <span class="token punctuation">{</span>
    p <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span>IP<span class="token punctuation">,</span> IPv6len<span class="token punctuation">)</span>
    <span class="token function">copy</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> v4InV6Prefix<span class="token punctuation">)</span>
    p<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> a
    p<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> <span class="token operator">=</span> b
    p<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> c
    p<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> <span class="token operator">=</span> d
    <span class="token keyword">return</span> p
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å‘ç°è¿™äº›å‡½æ•°éƒ½è¿”å›äº†<code v-pre>IP</code>å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹IPå¯¹è±¡çš„å®šä¹‰ï¼š
<code v-pre>type IP []byte</code>
å…¶å®å°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ•°ç»„åˆ‡ç‰‡ç±»å‹ã€‚</p>
<p><code v-pre>IPv4</code>å†…éƒ¨ç”¨makeåˆå§‹åŒ–äº†ä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡ï¼Œå¹¶ä¸”æŒ‡å®šäº†å…ƒç´ ä¸ªæ•°ä¸º<code v-pre>IPv6len</code>ã€‚<code v-pre>IPv6len</code>è¢«å®šä¹‰ä¸ºå¸¸é‡ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
    IPv6len <span class="token operator">=</span> <span class="token number">16</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åè¿›è¡Œå°†<code v-pre>v4InV6Prefix</code>å¤åˆ¶åˆ°åˆ°æ•°ç»„åˆ‡ç‰‡<code v-pre>p</code>ä¸­ï¼Œ<code v-pre>copy</code>çš„ç”¨æ³•è¯·è‡ªè¡Œæœç´¢ï¼ˆæ³¨æ„copyçš„è¡Œä¸ºå’Œå¸¸äººçš„ç†è§£ä¸åŒï¼‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">var</span> v4InV6Prefix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">,</span> <span class="token number">0xff</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è‡³äºå‚¨å­˜IPv4çš„æ•°ç»„åˆ‡ç‰‡ä¸ºä»€ä¹ˆè¦åˆ†é…16ä¸ªå…ƒç´ çš„å¤§å°ï¼Œåˆå¤åˆ¶ç»™æœ€åå››ä¸ªç´¢å¼•ï¼Œå¯ä»¥çœ‹<code v-pre>type IP []byte</code>çš„æ³¨é‡Šï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token comment">// An IP is a single IP address, a slice of bytes.</span>
<span class="token comment">// Functions in this package accept either 4-byte (IPv4)</span>
<span class="token comment">// or 16-byte (IPv6) slices as input.</span>
<span class="token comment">//</span>
<span class="token comment">// Note that in this documentation, referring to an</span>
<span class="token comment">// IP address as an IPv4 address or an IPv6 address</span>
<span class="token comment">// is a semantic property of the address, not just the</span>
<span class="token comment">// length of the byte slice: a 16-byte slice can still</span>
<span class="token comment">// be an IPv4 address.</span>
<span class="token keyword">type</span> IP <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™è¯´äº†ï¼Œä¸€ä¸ª<code v-pre>16-byte</code>å¤§å°çš„æ•°ç»„å¯ä»¥ä»ç„¶ä½œä¸ºIPv4åœ°å€ã€‚åˆ›å»ºæ•°ç»„åˆ‡ç‰‡<code v-pre>slice1 := make([]int, 5)</code>å…¶åˆå§‹å€¼éƒ½ä¸º<strong>0</strong>ã€‚</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '19.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—</a><a href = '21.md' style='float: right'>â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© :æœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


