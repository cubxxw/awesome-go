<template><div><h1 id="修改或添加docker镜像的映射端口-如何修改镜像配置文件" tabindex="-1"><a class="header-anchor" href="#修改或添加docker镜像的映射端口-如何修改镜像配置文件" aria-hidden="true">#</a> 修改或添加docker镜像的映射端口（如何修改镜像配置文件）</h1>
<nav class="table-of-contents"><ul><li><router-link to="#前言">前言</router-link></li><li><router-link to="#停止镜像">停止镜像</router-link></li><li><router-link to="#停止docker服务">停止docker服务</router-link></li><li><router-link to="#进入docker容器内部文件目录">进入docker容器内部文件目录</router-link></li><li><router-link to="#备份原有文件-出现问题后可以还原回去。">备份原有文件，出现问题后可以还原回去。</router-link></li><li><router-link to="#修改hostconfig-json">修改hostconfig.json</router-link></li><li><router-link to="#修改config-v2-json">修改config.v2.json</router-link></li><li><router-link to="#启动docker服务">启动docker服务</router-link></li><li><router-link to="#启动docker容器">启动docker容器</router-link></li><li><router-link to="#docker开启多个端口">docker开启多个端口</router-link></li></ul></nav>
<h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2>
<p><strong>由于一些原因，导致自己开启的端口后面需要用到，所以必须要切换端口映射</strong></p>
<p><img src="@source/markdown/images/image-20220917190839148.pngmail3293172751@qq.png" alt="image-20220917190839148"></p>
<p>上面可以看到MySQL的端口是<code v-pre>3306</code>，我们将会在后面对它改一下，再加上我们之间没有对容器镜像的配置文件进行操作。</p>
<blockquote>
<p>下面是修改配置文件 — 修改MySQL的端口映射过程</p>
</blockquote>
<h2 id="停止镜像" tabindex="-1"><a class="header-anchor" href="#停止镜像" aria-hidden="true">#</a> 停止镜像</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@ubuntu:/c# docker stop 846fec372f81
846fec372f81
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="停止docker服务" tabindex="-1"><a class="header-anchor" href="#停止docker服务" aria-hidden="true">#</a> 停止docker服务</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@ubuntu:/c# systemctl stop docker
Warning: Stopping docker.service, but it can still be activated by:
  docker.socket
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进入docker容器内部文件目录" tabindex="-1"><a class="header-anchor" href="#进入docker容器内部文件目录" aria-hidden="true">#</a> 进入docker容器内部文件目录</h2>
<blockquote>
<p>id是容器id开头的那一长串。我的是Ubuntu系统</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@ubuntu:/var/lib/docker/containers# pwd
/var/lib/docker/containers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="@source/markdown/images/image-20220917191657815.pngmail3293172751@qq.png" alt="image-20220917191657815"></p>
</blockquote>
<p><strong>查找位置，进去</strong></p>
<p><img src="https://sm.nsddd.top//typora/image-20220917191755516.png?mail:3293172751@qq.com" alt="image-20220917191755516"></p>
<h2 id="备份原有文件-出现问题后可以还原回去。" tabindex="-1"><a class="header-anchor" href="#备份原有文件-出现问题后可以还原回去。" aria-hidden="true">#</a> 备份原有文件，出现问题后可以还原回去。</h2>
<blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>cp hostconfig.json hostconfig-bak.json

cp config.v2.json config-bak.v2.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://sm.nsddd.top//typora/image-20220917191926113.png?mail:3293172751@qq.com" alt="image-20220917191926113"></p>
</blockquote>
<h2 id="修改hostconfig-json" tabindex="-1"><a class="header-anchor" href="#修改hostconfig-json" aria-hidden="true">#</a> 修改hostconfig.json</h2>
<blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>vim hostconfig.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改成想要的端口（可以用<code v-pre>?</code>或者<code v-pre>/</code>搜索）</p>
</blockquote>
<p><strong>这个文件需要了解下配置</strong></p>
<p>如果之前没有端口映射, 应该有这样的一段:</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>“PortBindings”:{}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>增加一个映射, 这样写:</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>“PortBindings”:{“8888/tcp”:[{“HostIp”:””,“HostPort”:“1888”}]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>**前一个数字是容器端口, 后一个是宿主机端口。**将宿主机的1888端口映射到容器的8888端口
如果增加多个，就是将宿主机的1888和1006端口映射到容器的8888和6006端口</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>“PortBindings”:<span class="token punctuation">{</span>“8888/tcp”:<span class="token punctuation">[</span><span class="token punctuation">{</span>“HostIp”:””,“HostPort”:“1888”<span class="token punctuation">}</span><span class="token punctuation">]</span>，“6006/tcp”:<span class="token punctuation">[</span><span class="token punctuation">{</span>“HostIp”:””,“HostPort”:“1006”<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>而修改现有端口映射更简单, 把端口号改掉就行
如果<code v-pre>config.v2.json</code>里面也记录了端口，也需要修改<code v-pre>config.v2.json</code></p>
<blockquote>
<p>下面就是配置文件，看不清没关系，因为我也看不清<img src="https://sm.nsddd.top//typora/4982f69711dac4c20aa2ad8c5d79af24.gif?mail:3293172751@qq.com" alt="img" style="zoom:25%;" /></p>
</blockquote>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code>ostconfig.json
<span class="token punctuation">{</span><span class="token property">"Binds"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"/mysql/log:/var/log/mysql"</span><span class="token punctuation">,</span><span class="token string">"/mysql/data:/var/lib/mysql"</span><span class="token punctuation">,</span><span class="token string">"/mysql/conf:/etc/mysql/conf.d"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"ContainerIDFile"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"LogConfig"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"Type"</span><span class="token operator">:</span><span class="token string">"json-file"</span><span class="token punctuation">,</span><span class="token property">"Config"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"NetworkMode"</span><span class="token operator">:</span><span class="token string">"default"</span><span class="token punctuation">,</span><span class="token property">"PortBindings"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"3306/tcp"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"HostIp"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"HostPort"</span><span class="token operator">:</span><span class="token string">"3307"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"RestartPolicy"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"Name"</span><span class="token operator">:</span><span class="token string">"always"</span><span class="token punctuation">,</span><span class="token property">"MaximumRetryCount"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"AutoRemove"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">"VolumeDriver"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"VolumesFrom"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"CapAdd"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"CapDrop"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"CgroupnsMode"</span><span class="token operator">:</span><span class="token string">"host"</span><span class="token punctuation">,</span><span class="token property">"Dns"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"DnsOptions"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"DnsSearch"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"ExtraHosts"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"GroupAdd"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"IpcMode"</span><span class="token operator">:</span><span class="token string">"private"</span><span class="token punctuation">,</span><span class="token property">"Cgroup"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"Links"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"OomScoreAdj"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"PidMode"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"Privileged"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token property">"PublishAllPorts"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">"ReadonlyRootfs"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">"SecurityOpt"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"label=disable"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"UTSMode"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"UsernsMode"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"ShmSize"</span><span class="token operator">:</span><span class="token number">67108864</span><span class="token punctuation">,</span><span class="token property">"Runtime"</span><span class="token operator">:</span><span class="token string">"runc"</span><span class="token punctuation">,</span><span class="token property">"ConsoleSize"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"Isolation"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"CpuShares"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"Memory"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"NanoCpus"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CgroupParent"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"BlkioWeight"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"BlkioWeightDevice"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"BlkioDeviceReadBps"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"BlkioDeviceWriteBps"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"BlkioDeviceReadIOps"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"BlkioDeviceWriteIOps"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"CpuPeriod"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CpuQuota"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CpuRealtimePeriod"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CpuRealtimeRuntime"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CpusetCpus"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"CpusetMems"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"Devices"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"DeviceCgroupRules"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"DeviceRequests"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"KernelMemory"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"KernelMemoryTCP"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"MemoryReservation"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"MemorySwap"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"MemorySwappiness"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"OomKillDisable"</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token property">"PidsLimit"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"Ulimits"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"CpuCount"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"CpuPercent"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"IOMaximumIOps"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"IOMaximumBandwidth"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"MaskedPaths"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"ReadonlyPaths"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改config-v2-json" tabindex="-1"><a class="header-anchor" href="#修改config-v2-json" aria-hidden="true">#</a> 修改config.v2.json</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>vim config.v2.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在下面合适的位置，填写端口信息。</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>"Ports":{"443/tcp":[{"HostIp":"0.0.0.0","HostPort":"443"}],"80/tcp":[{"HostIp":"0.0.0.0","HostPort":"80"}]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="启动docker服务" tabindex="-1"><a class="header-anchor" href="#启动docker服务" aria-hidden="true">#</a> 启动docker服务</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>systemctl start docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="启动docker容器" tabindex="-1"><a class="header-anchor" href="#启动docker容器" aria-hidden="true">#</a> 启动docker容器</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code> docker start 1f2f202dab24
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://sm.nsddd.top//typora/image-20220917193830270.png?mail:3293172751@qq.com" alt="image-20220917193830270"></p>
<p>需要注意的是，docker修改完映射端口后，docker的ip可能会发生变化。</p>
<h2 id="docker开启多个端口" tabindex="-1"><a class="header-anchor" href="#docker开启多个端口" aria-hidden="true">#</a> docker开启多个端口</h2>
<p><strong>我在网上找资料的时候，发现docker可以开启多个端口，也是改配置文件多加一行的是主机对应的端口</strong></p>
<p><strong>或者启动的时候映射多个端口</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code> docker run -d -p 5000:23 -p 5001:22 --name telnet_ssh --privileged=true telnet:centos /usr/sbin/init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>规范写法：</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>docker run --name definedName(自定义容器名称) \
-p 8080:8080(端口映射  本机端口: docker端口 ) \
-p 8081:8081 \
-p .... \
-d imagesName(镜像名称)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></template>


