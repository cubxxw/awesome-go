+ [ğŸ”¥ å¼€æºåœ°å€](https://github.com/cubxxw/iam)

# ç¬¬10èŠ‚ å¦‚ä½•ç”Ÿæˆ Swagger API æ–‡æ¡£ 

<br>
<div><a href = '9.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '11.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•During the winter vacation, I followed up and learned two projects: tiktok project and IAM project, and summarized and practiced the CloudNative project and Go language. I learned a lot in the process.Myblog:[http://nsddd.top](http://nsddd.top/)

---
[[TOC]]
[TOC]

## å¼€å§‹

**æˆ‘ä»¬æœ‰äº†è§£åˆ° RUSTful :**

RESTfulæ˜¯ä¸€ç§è®¾è®¡å’Œå¼€å‘WebæœåŠ¡çš„è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå…¶å…¨ç§°ä¸ºRepresentational State Transferã€‚RESTfulæ¶æ„é£æ ¼å¼ºè°ƒä½¿ç”¨ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰æ¥è¡¨ç¤ºèµ„æºï¼Œé€šè¿‡HTTPåè®®ä¸­çš„GETã€POSTã€PUTã€DELETEç­‰æ–¹æ³•å¯¹è¿™äº›èµ„æºè¿›è¡Œæ“ä½œï¼Œä»¥åŠé€šè¿‡HTTPå“åº”è¿”å›æ•°æ®æˆ–çŠ¶æ€ç æ¥è¡¨ç¤ºè¯·æ±‚ç»“æœã€‚

åœ¨RESTfulæ¶æ„ä¸­ï¼Œæ¯ä¸ªURIä»£è¡¨ä¸€ä¸ªèµ„æºï¼Œä¾‹å¦‚ä¸€ä¸ªWebé¡µé¢ã€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æˆ–è€…ä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚é€šè¿‡HTTPæ–¹æ³•å¯¹è¿™äº›èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œå®¢æˆ·ç«¯å‘é€çš„HTTPè¯·æ±‚ä¸­åŒ…å«äº†å¯¹èµ„æºçš„æ ‡è¯†ä»¥åŠæ‰€è¦æ‰§è¡Œçš„æ“ä½œï¼ŒæœåŠ¡ç«¯æ ¹æ®è¯·æ±‚è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¹¶è¿”å›HTTPå“åº”ä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯æ“ä½œç»“æœã€‚

RESTfulæ¶æ„é£æ ¼çš„è®¾è®¡ç†å¿µåŒ…æ‹¬ï¼šèµ„æºçš„æ ‡è¯†æ€§ã€ç»Ÿä¸€æ¥å£ã€æ— çŠ¶æ€ã€å¯ç¼“å­˜æ€§å’Œåˆ†å±‚ç³»ç»Ÿç­‰ã€‚å®ƒå·²ç»æˆä¸ºå½“å‰WebæœåŠ¡å¼€å‘ä¸­çš„ä¸»æµæ¶æ„é£æ ¼ä¹‹ä¸€ï¼Œè¢«å¹¿æ³›åº”ç”¨äºWebæœåŠ¡çš„è®¾è®¡å’Œå¼€å‘ä¸­ã€‚



### ä¸ºä»€ä¹ˆéœ€è¦ Swagger

waggeræ˜¯ä¸€ä¸ªAPIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨ç”Ÿæˆå¯äº¤äº’çš„APIæ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ã€‚ä½¿ç”¨Swaggerå¯ä»¥å¤§å¤§æé«˜APIæ–‡æ¡£çš„å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿å¼€å‘äººå‘˜å¯¹APIè¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ã€‚

**å­¦ä¹ Swaggerå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å…¥æ‰‹ï¼š**

1. äº†è§£Swaggerçš„åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚å¯ä»¥é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£Swaggerçš„åŸºæœ¬ç”¨æ³•å’Œå¸¸ç”¨ç‰¹æ€§ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨Swaggeræ¥å®šä¹‰APIæ¥å£ã€ç”Ÿæˆæ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ç­‰ã€‚

2. å­¦ä¹ Swaggerçš„é«˜çº§ç‰¹æ€§ã€‚é™¤äº†åŸºæœ¬çš„æ–‡æ¡£ç”ŸæˆåŠŸèƒ½ä¹‹å¤–ï¼ŒSwaggerè¿˜æä¾›äº†ä¸€ç³»åˆ—é«˜çº§ç‰¹æ€§ï¼Œå¦‚APIå®‰å…¨è®¤è¯ã€è¯·æ±‚/å“åº”éªŒè¯ã€APIç‰ˆæœ¬ç®¡ç†ç­‰ã€‚å­¦ä¹ è¿™äº›ç‰¹æ€§å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ä½¿ç”¨Swaggeræ¥è®¾è®¡å’Œå¼€å‘APIã€‚

3. å®è·µSwaggerçš„ä½¿ç”¨ã€‚åœ¨å­¦ä¹ Swaggerçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ç»“åˆè‡ªå·±çš„é¡¹ç›®æ¥å®è·µSwaggerçš„ä½¿ç”¨ï¼Œä»è€Œæ›´å¥½åœ°æŒæ¡Swaggerçš„ä½¿ç”¨æ–¹æ³•å’ŒæŠ€å·§ã€‚

ä¸ºä»€ä¹ˆè¦å­¦ä¹ Swaggerå‘¢ï¼Ÿå› ä¸ºSwaggerä½œä¸ºä¸€ç§APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼Œåœ¨ç°ä»£çš„Webå¼€å‘ä¸­ä½¿ç”¨å¹¿æ³›ï¼Œå¯ä»¥å¤§å¤§æé«˜APIæ–‡æ¡£çš„å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ï¼Œå‡å°‘APIæ–‡æ¡£ç¼–å†™çš„å·¥ä½œé‡ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿å¼€å‘äººå‘˜å¯¹APIè¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ã€‚æŒæ¡Swaggerçš„ä½¿ç”¨å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°è®¾è®¡å’Œå¼€å‘APIï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

**ç‰¹æ€§ï¼š**

+ Swagger æ˜¯ä¸€å¥—å›´ç»• OpenAPI è§„èŒƒæ„å»ºçš„å¼€æºå·¥å…·ï¼Œå¯ä»¥è®¾è®¡ã€æ„å»ºã€ç¼–å†™å’Œä½¿ç”¨ REST APIã€‚Swagger åŒ…å«å¾ˆå¤šå·¥å…·ï¼Œå…¶ä¸­ä¸»è¦çš„ Swagger å·¥å…·åŒ…æ‹¬ï¼š
+ Swagger ç¼–è¾‘å™¨ï¼šåŸºäºæµè§ˆå™¨çš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥åœ¨å…¶ä¸­ç¼–å†™ OpenAPI è§„èŒƒï¼Œå¹¶å®æ—¶é¢„è§ˆ API æ–‡æ¡£ã€‚https://editor.swagger.io å°±æ˜¯ä¸€ä¸ª Swagger ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥å°è¯•åœ¨å…¶ä¸­ç¼–è¾‘å’Œé¢„è§ˆ API æ–‡æ¡£ã€‚
+ Swagger UIï¼šå°† OpenAPI è§„èŒƒå‘ˆç°ä¸ºäº¤äº’å¼ API æ–‡æ¡£ï¼Œå¹¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å°è¯• API è°ƒç”¨ã€‚
+ Swagger Codegenï¼šæ ¹æ® OpenAPI è§„èŒƒï¼Œç”ŸæˆæœåŠ¡å™¨å­˜æ ¹å’Œå®¢æˆ·ç«¯ä»£ç åº“ï¼Œç›®å‰å·²æ¶µç›–äº† 40 å¤šç§è¯­è¨€ã€‚



### Swagger å’Œ OpenAPI çš„åŒºåˆ«

æˆ‘ä»¬åœ¨è°ˆåˆ° Swagger æ—¶ï¼Œä¹Ÿç»å¸¸ä¼šè°ˆåˆ° OpenAPIã€‚é‚£ä¹ˆäºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

OpenAPIæ˜¯ä¸€ç§æè¿°RESTful APIçš„è§„èŒƒï¼Œè€ŒSwaggeræ˜¯ä¸€ç§å®ç°OpenAPIè§„èŒƒçš„å·¥å…·ã€‚

> å…·ä½“æ¥è¯´ï¼ŒOpenAPIè§„èŒƒå®šä¹‰äº†ä¸€ç§æ ‡å‡†çš„APIæè¿°è¯­è¨€å’Œæ•°æ®æ ¼å¼ï¼Œç”¨äºæè¿°RESTful APIçš„ç»“æ„ã€å‚æ•°ã€å“åº”ç­‰ä¿¡æ¯ã€‚OpenAPIè§„èŒƒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨YAMLæˆ–JSONæ ¼å¼æ¥å®šä¹‰APIçš„ç»“æ„ï¼Œä½¿å¾—APIçš„æè¿°æ›´åŠ æ¸…æ™°ã€è§„èŒƒã€æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚OpenAPIè§„èŒƒçš„å®šä¹‰å¯ä»¥ä½œä¸ºAPIè®¾è®¡çš„æŒ‡å—ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºç”ŸæˆAPIæ–‡æ¡£å’Œå®¢æˆ·ç«¯ä»£ç ã€‚
>
> è€ŒSwaggeræ˜¯ä¸€ä¸ªå®ç°äº†OpenAPIè§„èŒƒçš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œå¦‚APIæè¿°ã€APIæµ‹è¯•ã€APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆç­‰ã€‚ä½¿ç”¨Swaggerï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡GUIç•Œé¢æˆ–è€…APIæè¿°æ–‡ä»¶æ¥å®šä¹‰APIï¼ŒSwaggerå¯ä»¥æ ¹æ®è¿™äº›å®šä¹‰ç”ŸæˆAPIæ–‡æ¡£ã€å®¢æˆ·ç«¯ä»£ç ã€APIæµ‹è¯•ç­‰ã€‚Swaggerå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£APIçš„ç»“æ„ã€å‚æ•°ã€å“åº”ç­‰ä¿¡æ¯ï¼Œæé«˜APIçš„å¼€å‘æ•ˆç‡å’Œè´¨é‡ã€‚
>
> æ€»çš„æ¥è¯´ï¼ŒOpenAPIå’ŒSwaggeréƒ½æ˜¯ä¸RESTful APIç›¸å…³çš„å·¥å…·å’Œè§„èŒƒï¼ŒOpenAPIè§„èŒƒå®šä¹‰äº†ä¸€ç§æ ‡å‡†çš„APIæè¿°è¯­è¨€å’Œæ•°æ®æ ¼å¼ï¼Œè€ŒSwaggeræ˜¯ä¸€ç§å®ç°äº†OpenAPIè§„èŒƒçš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£ã€æè¿°å’Œä½¿ç”¨RESTful APIã€‚

**OpenAPI æ˜¯ä¸€ä¸ª API è§„èŒƒï¼Œå®ƒçš„å‰èº«å« Swagger è§„èŒƒï¼Œé€šè¿‡å®šä¹‰ä¸€ç§ç”¨æ¥æè¿° API æ ¼å¼æˆ– API å®šä¹‰çš„è¯­è¨€ï¼Œæ¥è§„èŒƒ RESTful æœåŠ¡å¼€å‘è¿‡ç¨‹ï¼Œç›®å‰æœ€æ–°çš„ OpenAPI è§„èŒƒæ˜¯OpenAPI 3.0ï¼ˆä¹Ÿå°±æ˜¯ Swagger 2.0 è§„èŒƒï¼‰ã€‚**

**OpenAPI è§„èŒƒè§„å®šäº†ä¸€ä¸ª API å¿…é¡»åŒ…å«çš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…æ‹¬ï¼š**

+ å¯¹ API çš„æè¿°ï¼Œä»‹ç» API å¯ä»¥å®ç°çš„åŠŸèƒ½ã€‚
+ æ¯ä¸ª API ä¸Šå¯ç”¨çš„è·¯å¾„ï¼ˆ/usersï¼‰å’Œæ“ä½œï¼ˆGET /usersï¼ŒPOST /usersï¼‰ã€‚
+ æ¯ä¸ª API çš„è¾“å…¥ / è¿”å›çš„å‚æ•°ã€‚
+ éªŒè¯æ–¹æ³•ã€‚
+ è”ç³»ä¿¡æ¯ã€è®¸å¯è¯ã€ä½¿ç”¨æ¡æ¬¾å’Œå…¶ä»–ä¿¡æ¯ã€‚

æ‰€ä»¥ï¼Œä½ å¯ä»¥ç®€å•åœ°è¿™ä¹ˆç†è§£ï¼šOpenAPI æ˜¯ä¸€ä¸ª API è§„èŒƒï¼ŒSwagger åˆ™æ˜¯å®ç°è§„èŒƒçš„å·¥å…·ã€‚

å¦å¤–ï¼Œè¦ç¼–å†™ Swagger æ–‡æ¡£ï¼Œé¦–å…ˆè¦ä¼šä½¿ç”¨ Swagger æ–‡æ¡£ç¼–å†™è¯­æ³•ï¼Œå› ä¸ºè¯­æ³•æ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±ä¸å¤šä»‹ç»äº†ï¼Œä½ å¯ä»¥å‚è€ƒ Swagger å®˜æ–¹æä¾›çš„[OpenAPI Specification](https://swagger.io/specification/)æ¥å­¦ä¹ ã€‚



## ç”¨ go-swagger æ¥ç”Ÿæˆ Swagger API æ–‡æ¡£

åœ¨ Go é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹æ³•æ¥ç”Ÿæˆ Swagger API æ–‡æ¡£ï¼š

+ ç¬¬ä¸€ï¼Œå¦‚æœä½ ç†Ÿæ‚‰ Swagger è¯­æ³•çš„è¯ï¼Œå¯ä»¥ç›´æ¥ç¼–å†™ JSON/YAML æ ¼å¼çš„ Swagger æ–‡æ¡£ã€‚å»ºè®®é€‰æ‹© YAML æ ¼å¼ï¼Œå› ä¸ºå®ƒæ¯” JSON æ ¼å¼æ›´ç®€æ´ç›´è§‚ã€‚
+ ç¬¬äºŒï¼Œé€šè¿‡å·¥å…·ç”Ÿæˆ Swagger æ–‡æ¡£ï¼Œç›®å‰å¯ä»¥é€šè¿‡[swag](https://github.com/swaggo/swag)å’Œ[go-swagger](https://github.com/go-swagger/go-swagger)ä¸¤ä¸ªå·¥å…·æ¥ç”Ÿæˆã€‚

å¯¹æ¯”è¿™ä¸¤ç§æ–¹æ³•ï¼Œç›´æ¥ç¼–å†™ Swagger æ–‡æ¡£ï¼Œä¸æ¯”ç¼–å†™ Markdown æ ¼å¼çš„ API æ–‡æ¡£å·¥ä½œé‡å°ï¼Œæˆ‘è§‰å¾—ä¸ç¬¦åˆç¨‹åºå‘˜â€œå·æ‡’â€çš„ä¹ æƒ¯ã€‚æ‰€ä»¥ï¼Œæœ¬ä¸“æ æˆ‘ä»¬å°±ä½¿ç”¨ go-swagger å·¥å…·ï¼ŒåŸºäºä»£ç æ³¨é‡Šæ¥è‡ªåŠ¨ç”Ÿæˆ Swagger æ–‡æ¡£ã€‚ä¸ºä»€ä¹ˆé€‰ go-swagger å‘¢ï¼Ÿæœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼š

+ **go-swagger æ¯” swag åŠŸèƒ½æ›´å¼ºå¤§ï¼š** go-swagger æä¾›äº†æ›´çµæ´»ã€æ›´å¤šçš„åŠŸèƒ½æ¥æè¿°æˆ‘ä»¬çš„ APIã€‚
+ **ä½¿æˆ‘ä»¬çš„ä»£ç æ›´æ˜“è¯»**ï¼šå¦‚æœä½¿ç”¨ swagï¼Œæˆ‘ä»¬æ¯ä¸€ä¸ª API éƒ½éœ€è¦æœ‰ä¸€ä¸ªå†—é•¿çš„æ³¨é‡Šï¼Œæœ‰æ—¶å€™ä»£ç æ³¨é‡Šæ¯”ä»£ç è¿˜è¦é•¿ï¼Œä½†æ˜¯é€šè¿‡ go-swagger æˆ‘ä»¬å¯ä»¥å°†ä»£ç å’Œæ³¨é‡Šåˆ†å¼€ç¼–å†™ï¼Œä¸€æ–¹é¢å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç ä¿æŒç®€æ´ï¼Œæ¸…æ™°æ˜“è¯»ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥åœ¨å¦å¤–ä¸€ä¸ªåŒ…ä¸­ï¼Œç»Ÿä¸€ç®¡ç†è¿™äº› Swagger API æ–‡æ¡£å®šä¹‰ã€‚
+ **æ›´å¥½çš„ç¤¾åŒºæ”¯æŒ**ï¼šgo-swagger ç›®å‰æœ‰éå¸¸å¤šçš„ Github star æ•°ï¼Œå‡ºç° Bug çš„æ¦‚ç‡å¾ˆå°ï¼Œå¹¶ä¸”å¤„åœ¨ä¸€ä¸ªé¢‘ç¹æ›´æ–°çš„æ´»è·ƒçŠ¶æ€ã€‚



### go-swagger

+ [Github Project Address](https://github.com/go-swagger/go-swagger)

ä½ å·²ç»çŸ¥é“äº†ï¼Œgo-swagger æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ã€é«˜æ€§èƒ½çš„ã€å¯ä»¥æ ¹æ®ä»£ç æ³¨é‡Šç”Ÿæˆ Swagger API æ–‡æ¡£çš„å·¥å…·ã€‚

`go-swagger`ä¸º Go ç¤¾åŒºå¸¦æ¥äº†ä¸€å¥—å®Œæ•´çš„åŠŸèƒ½é½å…¨ã€é«˜æ€§èƒ½çš„ API ç»„ä»¶ï¼Œå¯ä¸ Swagger API é…åˆä½¿ç”¨ï¼šæœåŠ¡å™¨ã€å®¢æˆ·ç«¯å’Œæ•°æ®æ¨¡å‹ã€‚

+ ä» swagger è§„èŒƒç”ŸæˆæœåŠ¡å™¨
+ ä» swagger è§„èŒƒç”Ÿæˆå®¢æˆ·ç«¯
+ ä» swagger è§„èŒƒï¼ˆalpha é˜¶æ®µï¼‰ç”Ÿæˆ CLIï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰
+ æ”¯æŒ jsonschema å’Œ swagger æä¾›çš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¤šæ€æ€§
+ ä»å¸¦æ³¨é‡Šçš„ go ä»£ç ç”Ÿæˆ swagger è§„èŒƒ
+ ä½¿ç”¨ swagger è§„èŒƒçš„é™„åŠ å·¥å…·
+ å‡ºè‰²çš„å®šåˆ¶åŠŸèƒ½ï¼Œå…·æœ‰ä¾›åº”å•†æ‰©å±•å’Œå¯å®šåˆ¶æ¨¡æ¿

æˆ‘ä»¬å¯¹ä»£ç ç”Ÿæˆçš„å…³æ³¨ç‚¹æ˜¯ç”Ÿæˆæƒ¯ç”¨çš„ã€å¿«é€Ÿçš„ go ä»£ç ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°ä¸ golintã€go vet ç­‰é…åˆä½¿ç”¨ã€‚

âš ï¸ è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬è¦å¯¹å¤–æä¾› API çš„ Go SDKï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ go-swagger æ¥ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç ã€‚ä½†æ˜¯æˆ‘è§‰å¾— go-swagger ç”Ÿæˆçš„æœåŠ¡ç«¯ä»£ç ä¸å¤Ÿä¼˜é›…ï¼Œæ‰€ä»¥å»ºè®®ä½ è‡ªè¡Œç¼–å†™æœåŠ¡ç«¯ä»£ç ã€‚

ç›®å‰ï¼Œæœ‰å¾ˆå¤šçŸ¥åå…¬å¸å’Œç»„ç»‡çš„é¡¹ç›®éƒ½ä½¿ç”¨äº† go-swaggerï¼Œä¾‹å¦‚ Mobyã€CoreOSã€Kubernetesã€Cilium ç­‰ã€‚



### é¡¹ç›®çŠ¶æ€

`go-swagger`ç°åœ¨åŠŸèƒ½å·²ç»å®Œæˆå¹¶ä¸”å·²ç»ç¨³å®šäº†å®ƒçš„ APIã€‚

å¤§å¤šæ•°åŠŸèƒ½å’Œæ„å»ºå—ç°åœ¨éƒ½å¤„äºç¨³å®šçŠ¶æ€ï¼Œå…·æœ‰ä¸°å¯Œçš„ CI æµ‹è¯•é›†ã€‚

go-openapi ç¤¾åŒºç§¯æåœ°ç»§ç»­ä¸ºè¿™ä¸ªä»£ç åº“å¸¦æ¥ä¿®å¤å’Œå¢å¼ºã€‚



## Swagger ä¸Šæ‰‹

### å®‰è£… Swagger å·¥å…·

go-swagger é€šè¿‡ swagger å‘½ä»¤è¡Œå·¥å…·æ¥å®Œæˆå…¶åŠŸèƒ½ï¼Œswagger å®‰è£…æ–¹æ³•å¦‚ä¸‹ï¼š

```go
$ go get -u github.com/go-swagger/go-swagger/cmd/swagger

$ swagger version
version: v0.30.4
commit: (unknown, mod sum: "h1:cPrWLSXY6ZdcgfRicOj0lANg72TkTHz6uv/OlUdzO5U=")
```



### swagger å‘½ä»¤è¡Œå·¥å…·ä»‹ç»

swagger å‘½ä»¤æ ¼å¼ä¸º`swagger [OPTIONS]` ã€‚å¯ä»¥é€šè¿‡swagger -hæŸ¥çœ‹ swagger ä½¿ç”¨å¸®åŠ©ã€‚swagger æä¾›çš„å­å‘½ä»¤åŠåŠŸèƒ½è§ä¸‹è¡¨ï¼š

<img src="http://sm.nsddd.top/sm202302211206119.png" alt="sadfasfdaijfoaisjfdoisa" style="zoom:33%;" />



## å¦‚ä½•ä½¿ç”¨ swagger å‘½ä»¤ç”Ÿæˆ Swagger æ–‡æ¡£ï¼Ÿ

go-swagger é€šè¿‡è§£ææºç ä¸­çš„æ³¨é‡Šæ¥ç”Ÿæˆ [Swagger æ–‡æ¡£](https://github.com/go-swagger/go-swagger)ï¼Œgo-swagger çš„è¯¦ç»†æ³¨é‡Šè¯­æ³•å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚å¸¸ç”¨çš„æœ‰å¦‚ä¸‹å‡ ç±»æ³¨é‡Šè¯­æ³•ï¼š

go-swagger æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆ RESTful API çš„å·¥å…·ï¼Œå®ƒæ”¯æŒä½¿ç”¨ Swagger è§„èŒƒï¼ˆOpenAPI è§„èŒƒï¼‰æ¥å®šä¹‰ API çš„æ¥å£å’Œæ¨¡å‹ã€‚åœ¨ä½¿ç”¨ go-swagger æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹å®šçš„æ³¨é‡Šè¯­æ³•æ¥å®šä¹‰ API çš„ä¿¡æ¯å’Œå‚æ•°ï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ç±»æ³¨é‡Šè¯­æ³•å’Œç¤ºä¾‹ï¼š

### Swagger æ³¨é‡Š

Swagger æ³¨é‡Šç”¨äºå®šä¹‰ API çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ **API çš„æ ‡é¢˜ã€æè¿°ã€ç‰ˆæœ¬å·** ç­‰ã€‚ä½¿ç”¨ `swagger:xxx` çš„å½¢å¼æ¥æ³¨é‡Šï¼Œå…¶ä¸­ `xxx` è¡¨ç¤ºæ³¨é‡Šçš„å…·ä½“ä¿¡æ¯ã€‚

```go
// swagger:operation GET /books/{id} getBook
//
// ---
// summary: Get book by ID
// description: Returns a single book by its ID.
// parameters:
// - name: id
//   in: path
//   description: ID of the book to retrieve
//   required: true
//   type: string
// responses:
//   "200":
//     description: Book information
//     schema:
//       "$ref": "#/definitions/Book"
```

### Parameter æ³¨é‡Š

Parameter æ³¨é‡Šç”¨äºå®šä¹‰ API æ¥å£çš„å‚æ•°ï¼ŒåŒ…æ‹¬å‚æ•°çš„åç§°ã€ç±»å‹ã€ä½ç½®å’Œæè¿°ç­‰ä¿¡æ¯ã€‚ä½¿ç”¨ `param` çš„å½¢å¼æ¥æ³¨é‡Šï¼Œå…¶ä¸­ `param` è¡¨ç¤ºå‚æ•°çš„å…·ä½“ä¿¡æ¯ã€‚

```go
// GetBookByID returns a single book by its ID.
//
// swagger:operation GET /books/{id} getBook
//
// ---
// summary: Get book by ID
// description: Returns a single book by its ID.
// parameters:
// - name: id
//   in: path
//   description: ID of the book to retrieve
//   required: true
//   type: string
//   format: uuid
//   param: query
// responses:
//   "200":
//     description: Book information
//     schema:
//       "$ref": "#/definitions/Book"
```

### Response æ³¨é‡Š

Response æ³¨é‡Šç”¨äºå®šä¹‰ API çš„å“åº”æ•°æ®ç»“æ„å’Œæ•°æ®ç±»å‹ã€‚ä½¿ç”¨ `response` çš„å½¢å¼æ¥æ³¨é‡Šï¼Œå…¶ä¸­ `response` è¡¨ç¤ºå“åº”çš„å…·ä½“ä¿¡æ¯ã€‚

```go
// GetBookByID returns a single book by its ID.
//
// swagger:operation GET /books/{id} getBook
//
// ---
// summary: Get book by ID
// description: Returns a single book by its ID.
// parameters:
// - name: id
//   in: path
//   description: ID of the book to retrieve
//   required: true
//   type: string
//   format: uuid
// responses:
//   "200":
//     description: Book information
//     schema:
//       "$ref": "#/definitions/Book"
//       response: noContent
//   "404":
//     description: Book not found
```



### è§£ææ³¨é‡Šç”Ÿæˆ Swagger æ–‡æ¡£

`swagger generate` å‘½ä»¤ä¼šæ‰¾åˆ° main å‡½æ•°ï¼Œç„¶åéå†æ‰€æœ‰æºç æ–‡ä»¶ï¼Œè§£ææºç ä¸­ä¸ Swagger ç›¸å…³çš„æ³¨é‡Šï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆ `swagger.json/swagger.yaml` æ–‡ä»¶ã€‚

è¿™ä¸€è¿‡ç¨‹çš„ç¤ºä¾‹ä»£ç ä¸º [gopractise-demo/swagger](https://github.com/marmotedu/gopractise-demo/tree/main/swagger)ã€‚ç›®å½•ä¸‹æœ‰ä¸€ä¸ª `main.go` æ–‡ä»¶ï¼Œå®šä¹‰äº†å¦‚ä¸‹ API æ¥å£ï¼š

```go
package main

import (
    "fmt"
    "log"
    "net/http"

    "github.com/gin-gonic/gin"

    "github.com/marmotedu/gopractise-demo/swagger/api"
    // This line is necessary for go-swagger to find your docs!
    _ "github.com/marmotedu/gopractise-demo/swagger/docs"
)

var users []*api.User

func main() {
    r := gin.Default()
    r.POST("/users", Create)
    r.GET("/users/:name", Get)

    log.Fatal(r.Run(":5555"))
}

// Create create a user in memory.
func Create(c *gin.Context) {
    var user api.User
    if err := c.ShouldBindJSON(&user); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"message": err.Error(), "code": 10001})
        return
    }

    for _, u := range users {
        if u.Name == user.Name {
            c.JSON(http.StatusBadRequest, gin.H{"message": fmt.Sprintf("user %s already exist", user.Name), "code": 10001})
            return
        }
    }

    users = append(users, &user)
    c.JSON(http.StatusOK, user)
}

// Get return the detail information for a user.
func Get(c *gin.Context) {
    username := c.Param("name")
    for _, u := range users {
        if u.Name == username {
            c.JSON(http.StatusOK, u)
            return
        }
    }

    c.JSON(http.StatusBadRequest, gin.H{"message": fmt.Sprintf("user %s not exist", username), "code": 10002})
}
```

main åŒ…ä¸­å¼•å…¥çš„ User struct ä½äº `gopractise-demo/swagger/api` ç›®å½•ä¸‹çš„[user.go](https://github.com/marmotedu/gopractise-demo/blob/main/swagger/api/user.go)æ–‡ä»¶ï¼š

```python
// Package api defines the user model.
package api

// User represents body of User request and response.
type User struct {
    // User's name.
    // Required: true
    Name string `json:"name"`

    // User's nickname.
    // Required: true
    Nickname string `json:"nickname"`

    // User's address.
    Address string `json:"address"`

    // User's email.
    Email string `json:"email"`
}
```

`// Required: true`è¯´æ˜å­—æ®µæ˜¯å¿…é¡»çš„ï¼Œç”Ÿæˆ Swagger æ–‡æ¡£æ—¶ï¼Œä¹Ÿä¼šåœ¨æ–‡æ¡£ä¸­å£°æ˜è¯¥å­—æ®µæ˜¯å¿…é¡»å­—æ®µã€‚

ä¸ºäº†ä½¿ä»£ç ä¿æŒç®€æ´ï¼Œæˆ‘ä»¬åœ¨å¦å¤–ä¸€ä¸ª Go åŒ…ä¸­ç¼–å†™å¸¦ go-swagger æ³¨é‡Šçš„ API æ–‡æ¡£ã€‚å‡è®¾è¯¥ Go åŒ…åå­—ä¸º docsï¼Œåœ¨å¼€å§‹ç¼–å†™ Go API æ³¨é‡Šä¹‹å‰ï¼Œéœ€è¦åœ¨ main.go æ–‡ä»¶ä¸­å¯¼å…¥ docs åŒ…ï¼š

```BASH
_ "github.com/marmotedu/gopractise-demo/swagger/docs"
```

é€šè¿‡å¯¼å…¥ docs åŒ…ï¼Œå¯ä»¥ä½¿ go-swagger åœ¨é€’å½’è§£æ main åŒ…çš„ä¾èµ–åŒ…æ—¶ï¼Œæ‰¾åˆ° docs åŒ…ï¼Œå¹¶è§£æåŒ…ä¸­çš„æ³¨é‡Šã€‚

**åœ¨ gopractise-demo/swagger ç›®å½•ä¸‹ï¼Œåˆ›å»º docs æ–‡ä»¶å¤¹ï¼š**

```bash
$ mkdir docs
$ cd docs
```

**åœ¨ docs ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª doc.go æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­æä¾› API æ¥å£çš„åŸºæœ¬ä¿¡æ¯ï¼š**

```go

// Package docs awesome.
//
// Documentation of our awesome API.
//
//     Schemes: http, https
//     BasePath: /
//     Version: 0.1.0
//     Host: some-url.com
//
//     Consumes:
//     - application/json
//
//     Produces:
//     - application/json
//
//     Security:
//     - basic
//
//    SecurityDefinitions:
//    basic:
//      type: basic
//
// swagger:meta
package docs
```

Package docs åé¢çš„å­—ç¬¦ä¸² awesome ä»£è¡¨æˆ‘ä»¬çš„ HTTP æœåŠ¡åã€‚Documentation of our awesome APIæ˜¯æˆ‘ä»¬ API çš„æè¿°ã€‚å…¶ä»–éƒ½æ˜¯ `go-swagger` å¯è¯†åˆ«çš„æ³¨é‡Šï¼Œä»£è¡¨ä¸€å®šçš„æ„ä¹‰ã€‚æœ€åä»¥`swagger:meta`æ³¨é‡Šç»“æŸã€‚

ç¼–å†™å®Œ doc.go æ–‡ä»¶åï¼Œè¿›å…¥ `gopractise-demo/swagger` ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ Swagger API æ–‡æ¡£ï¼Œå¹¶å¯åŠ¨ HTTP æœåŠ¡ï¼Œåœ¨æµè§ˆå™¨æŸ¥çœ‹ Swaggerï¼š

```bash
$ swagger generate spec -o swagger.yaml
$ swagger serve --no-open -F=swagger --port 36666 swagger.yaml

2020/10/20 23:16:47 serving docs at http://localhost:36666/docs
```

+ `-o`ï¼šæŒ‡å®šè¦è¾“å‡ºçš„æ–‡ä»¶åã€‚swagger ä¼šæ ¹æ®æ–‡ä»¶ååç¼€.yaml æˆ–è€….jsonï¼Œå†³å®šç”Ÿæˆçš„æ–‡ä»¶æ ¼å¼ä¸º YAML æˆ– JSONã€‚
+ `â€“no-open`ï¼šå› ä¸ºæ˜¯åœ¨ Linux æœåŠ¡å™¨ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œæ²¡æœ‰å®‰è£…æµè§ˆå™¨ï¼Œæ‰€ä»¥ä½¿â€“no-open ç¦æ­¢è°ƒç”¨æµè§ˆå™¨æ‰“å¼€ URLã€‚
+ `-F`ï¼šæŒ‡å®šæ–‡æ¡£çš„é£æ ¼ï¼Œå¯é€‰ swagger å’Œ redocã€‚æˆ‘é€‰ç”¨äº† redocï¼Œå› ä¸ºè§‰å¾— redoc æ ¼å¼æ›´åŠ æ˜“è¯»å’Œæ¸…æ™°ã€‚
+ `â€“port`ï¼šæŒ‡å®šå¯åŠ¨çš„ HTTP æœåŠ¡ç›‘å¬ç«¯å£ã€‚







## END é“¾æ¥

<ul><li><div><a href = '9.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '11.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

